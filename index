<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>The Daily Nuthatch Live Desk</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-main: #0a0e14;
            --bg-column: #12161e;
            --bg-card: #1a1f2b;
            --border: #2a3040;
            --text-primary: #e6e8eb;
            --text-secondary: #6B8BA4;
            --text-dim: #5a6070;
            --accent-green: #00ff88;
            --accent-red: #ff4466;
            --accent-yellow: #ffbb33;
            --accent-blue: #3399ff;
            --accent-purple: #bb66ff;
            --accent-moss: #8fbc8f;
            --accent-orange: #D4714A;
        }

        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            overflow: hidden;
            line-height: 1.4;
            height: 100vh;
        }
        
        html {
            overflow: hidden;
            height: 100vh;
            /* Fluid typography - base font scales with viewport width */
            font-size: clamp(11px, calc(10px + 0.35vw), 16px);
        }
        
        /* 17-19 inch screens (1200-1599px) - tighter scaling */
        @media (min-width: 1200px) and (max-width: 1599px) {
            html {
                font-size: clamp(11px, calc(9px + 0.4vw), 14px);
            }
        }
        
        /* Smaller laptops and tablets (768-1199px) */
        @media (min-width: 768px) and (max-width: 1199px) {
            html {
                font-size: clamp(10px, calc(8px + 0.5vw), 13px);
            }
        }
        
        /* Mobile screens */
        @media (max-width: 767px) {
            html {
                font-size: clamp(11.5px, calc(10.5px + 0.6vw), 15.5px);
            }
        }
        
        /* Large screens (1600px+) */
        @media (min-width: 1600px) {
            html {
                font-size: 16px;
            }
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1a1f2b 0%, #0f1319 100%);
            border-bottom: 2px solid var(--accent-orange);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(212, 113, 74, 0.15);
        }

        .logo {
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            color: #ffffff;
            text-transform: uppercase;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Gradient pulsing text for CONNECT */
        .connect-text {
            font-family: 'IBM Plex Sans', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            letter-spacing: 2px;
            background: linear-gradient(90deg, #6b7280, #9ca3af, #d1d5db, #9ca3af, #6b7280);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-pulse-gray 2s ease-in-out infinite;
        }
        
        .connect-text.connected {
            background: linear-gradient(90deg, #22c55e, #4ade80, #86efac, #4ade80, #22c55e);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-pulse-green 1.5s ease-in-out infinite;
        }
        
        @keyframes gradient-pulse-gray {
            0%, 100% { 
                background-position: 0% 50%;
                opacity: 0.5;
            }
            50% { 
                background-position: 100% 50%;
                opacity: 1;
            }
        }
        
        @keyframes gradient-pulse-green {
            0%, 100% { 
                background-position: 0% 50%;
                opacity: 0.8;
            }
            50% { 
                background-position: 100% 50%;
                opacity: 1;
            }
        }

        /* GLOBAL WATCHTOWER CLOCK */
        .global-clock-container {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            min-width: 140px;
        }

        .global-clock-city {
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 0.65rem;
            color: var(--accent-orange);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        .global-clock-time {
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 0.9rem;
            color: var(--text-primary);
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        .clock-visible {
            opacity: 1 !important;
        }

        .time-display {
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 0.9rem;
            color: var(--text-secondary);
            letter-spacing: 1px;
        }

        .info-button {
            background: rgba(212, 113, 74, 0.1);
            border: 1px solid rgba(212, 113, 74, 0.3);
            color: var(--accent-orange);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .info-button:hover {
            background: rgba(212, 113, 74, 0.2);
            border-color: var(--accent-orange);
            transform: translateY(-1px);
        }

        /* Ticker Container - Two Tickers */
        .ticker-container {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
        }

        /* News Ticker (Top) */
        .news-ticker {
            background: var(--bg-card);
            padding: 0.5rem 2rem;
            overflow: hidden;
            position: relative;
            height: 47px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border);
            box-shadow: inset 40px 0 35px -25px rgba(0, 0, 0, 0.8),
                        inset -40px 0 35px -25px rgba(0, 0, 0, 0.8),
                        inset 0 0 40px rgba(107, 139, 164, 0.1);
        }

        .news-ticker-content {
            display: flex;
            gap: 4rem;
            animation: scroll-slow 144s linear infinite;
            white-space: nowrap;
        }

        @keyframes scroll-slow {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .ticker-item {
            display: flex;
            gap: 1rem;
            align-items: center;
            font-size: 1rem;
        }

        .ticker-time {
            color: var(--accent-orange);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .ticker-text {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 1rem;
        }
        
        .ticker-text.top-story {
            color: #ffffff;
            font-weight: 700;
        }
        
        .top-story-badge {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            font-size: 0.8rem;
            font-weight: 800;
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            margin-right: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: topStoryPulse 2s ease-in-out infinite;
        }
        
        @keyframes topStoryPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes highlight-pulse {
            0% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.6); }
            50% { box-shadow: 0 0 20px 5px rgba(168, 85, 247, 0.4); }
            100% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0); }
        }
        
        .ticker-item.top-story {
            background: rgba(255, 68, 68, 0.1);
            border-left: 2px solid #ff4444;
            padding-left: 0.75rem;
        }

        .ticker-impact {
            display: flex;
            gap: 2px;
        }

        .impact-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--text-dim);
        }

        .impact-dot.active {
            background: var(--accent-yellow);
        }

        /* Market Ticker (Bottom) */
        .market-ticker {
            background: var(--bg-card);
            padding: 0.25rem 2rem;
            overflow-x: auto;
            overflow-y: hidden;
            position: relative;
            height: 32px;
            display: flex;
            align-items: center;
            scrollbar-width: none;
            -ms-overflow-style: none;
            cursor: grab;
            box-shadow: inset 40px 0 35px -25px rgba(0, 0, 0, 0.8),
                        inset -40px 0 35px -25px rgba(0, 0, 0, 0.8),
                        inset 0 0 35px rgba(107, 139, 164, 0.12);
            border-bottom: 1px solid var(--accent-orange);
        }

        .market-ticker::-webkit-scrollbar {
            display: none;
        }

        .market-ticker:active {
            cursor: grabbing;
        }

        .ticker-search-popup {
            display: none;
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg);
            border: 1px solid var(--accent-blue);
            border-radius: 6px;
            padding: 0.75rem 1rem;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            min-width: 280px;
        }

        .ticker-search-popup.active {
            display: block;
        }

        .ticker-search-popup input {
            width: 100%;
            background: rgba(42, 48, 64, 0.8);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 0.5rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: 'IBM Plex Sans', sans-serif;
        }

        .ticker-search-popup input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .ticker-search-popup label {
            display: block;
            font-size: 0.7rem;
            color: var(--accent-blue);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ticker-search-popup button {
            margin-top: 0.5rem;
            width: 100%;
            background: var(--accent-blue);
            border: none;
            border-radius: 4px;
            padding: 0.5rem;
            color: var(--bg-primary);
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .ticker-search-popup button:hover {
            background: var(--accent-orange);
        }

        .market-ticker-content {
            display: flex;
            gap: 1rem;
            animation: scroll-fast 144s linear infinite;
            white-space: nowrap;
            cursor: grab;
        }

        .market-ticker-content:active {
            cursor: grabbing;
        }

        .market-ticker-content.dragging {
            animation-play-state: paused;
        }

        @keyframes scroll-fast {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .market-ticker-item {
            display: flex;
            gap: 0.4rem;
            align-items: center;
            font-size: 0.7rem;
        }

        .market-ticker-label {
            color: var(--text-secondary);
            font-weight: 600;
            min-width: 55px;
            text-align: right;
            font-size: 0.65rem;
        }

        .market-ticker-value {
            color: var(--text-primary);
            font-family: 'IBM Plex Sans', sans-serif;
            font-weight: 700;
            margin-left: 0.1rem;
            font-size: 0.7rem;
        }

        .market-ticker-change {
            font-size: 0.6rem;
            font-weight: 600;
            margin-left: 0.1rem;
        }

        .market-ticker-up {
            color: var(--accent-green);
        }

        .market-ticker-down {
            color: var(--accent-red);
        }

        .market-ticker-neutral {
            color: var(--text-dim);
        }

        /* ========================================
           RESPONSIVE TYPOGRAPHY SYSTEM
           Fluid scaling for tickers & dashboards
           ======================================== */
        
        /* Large Desktop 1920px+ (21"+ monitors) */
        @media (min-width: 1920px) {
            /* Column Headers - LARGEST */
            .column-title { font-size: 1.6rem; }
            .column-subtitle { font-size: 0.85rem; }
            /* Tickers */
            .news-ticker { height: 49px; padding: 0.65rem 2.5rem; }
            .ticker-item { font-size: 1.35rem; gap: 1.75rem; }
            .ticker-time { font-size: 1.25rem; }
            .ticker-text { font-size: 1.35rem; }
            .market-ticker { height: 65px; }
            .market-ticker-item { font-size: 1.25rem; gap: 0.85rem; }
            .market-ticker-label { font-size: 1.15rem; min-width: 110px; }
            .market-ticker-value { font-size: 1.25rem; }
            .market-ticker-change { font-size: 1.05rem; }
            /* Card Content - PROMINENT */
            .card-headline { font-size: 1.2rem; font-weight: 700; }
            .card-implications { font-size: 0.95rem; }
            .card-implications li { font-size: 0.95rem; }
            .next-events-title { font-size: 0.85rem; }
            .next-event-item { font-size: 0.88rem; }
            /* Dashboard Titles - SMALLER than column */
            .macro-dashboard-title { font-size: 1rem; }
            .macro-dashboard-subtitle { font-size: 0.85rem; }
            .commodity-dashboard-title { font-size: 1rem; }
            .commodity-dashboard-subtitle { font-size: 0.85rem; }
            .fx-dashboard-title { font-size: 1rem; }
            .fx-dashboard-subtitle { font-size: 0.85rem; }
            .dashboard-title { font-size: 1rem; }
            .dashboard-section-subtitle { font-size: 0.85rem; }
            /* Dashboard Column Titles & Subtitles - Match dashboard-section-subtitle */
            .commodity-column-title { font-size: 0.85rem; }
            .fx-column-title { font-size: 0.85rem; }
            .commodity-column-subtitle { font-size: 0.75rem; }
            .fx-column-subtitle { font-size: 0.75rem; }
            /* Dashboard Values - Readable */
            .macro-item-label { font-size: 0.7rem; }
            .macro-item-value { font-size: 0.95rem; }
            .macro-item-change { font-size: 0.75rem; }
            .commodity-item-label { font-size: 0.7rem; }
            .commodity-item-price { font-size: 0.95rem; }
            .commodity-item-change { font-size: 0.75rem; }
            .fx-pair-label { font-size: 0.7rem; }
            .fx-pair-price { font-size: 0.95rem; }
            .fx-pair-change { font-size: 0.75rem; }
            .cb-rate-item { font-size: 0.7rem; }
        }

        /* Standard Desktop 1600-1919px (19-21" monitors) */
        @media (min-width: 1600px) and (max-width: 1919px) {
            /* Column Headers - LARGEST */
            .column-title { font-size: 1.45rem; }
            .column-subtitle { font-size: 0.78rem; }
            /* Tickers */
            .news-ticker { height: 44px; padding: 0.6rem 2rem; }
            .ticker-item { font-size: 1.2rem; gap: 1.4rem; }
            .ticker-time { font-size: 1.1rem; }
            .ticker-text { font-size: 1.2rem; }
            .market-ticker { height: 58px; }
            .market-ticker-item { font-size: 1.1rem; gap: 0.7rem; }
            .market-ticker-label { font-size: 1rem; min-width: 95px; }
            .market-ticker-value { font-size: 1.1rem; }
            .market-ticker-change { font-size: 0.95rem; }
            /* Card Content - PROMINENT */
            .card-headline { font-size: 1.05rem; font-weight: 700; }
            .card-implications { font-size: 0.85rem; }
            .card-implications li { font-size: 0.85rem; }
            .next-events-title { font-size: 0.78rem; }
            .next-event-item { font-size: 0.8rem; }
            /* Dashboard Titles - SMALLER than column */
            .macro-dashboard-title { font-size: 0.88rem; }
            .macro-dashboard-subtitle { font-size: 0.78rem; }
            .commodity-dashboard-title { font-size: 0.88rem; }
            .commodity-dashboard-subtitle { font-size: 0.78rem; }
            .fx-dashboard-title { font-size: 0.88rem; }
            .fx-dashboard-subtitle { font-size: 0.78rem; }
            .dashboard-title { font-size: 0.88rem; }
            .dashboard-section-subtitle { font-size: 0.78rem; }
            /* Dashboard Column Titles & Subtitles - Match dashboard-section-subtitle */
            .commodity-column-title { font-size: 0.78rem; }
            .fx-column-title { font-size: 0.78rem; }
            .commodity-column-subtitle { font-size: 0.68rem; }
            .fx-column-subtitle { font-size: 0.68rem; }
            /* Dashboard Values - Readable */
            .macro-item-label { font-size: 0.62rem; }
            .macro-item-value { font-size: 0.85rem; }
            .macro-item-change { font-size: 0.68rem; }
            .macro-grid-item { padding: 0.2rem 0.25rem; min-height: 1.6rem; }
            .commodity-item-label { font-size: 0.62rem; }
            .commodity-item-price { font-size: 0.85rem; }
            .commodity-item-change { font-size: 0.68rem; }
            .commodity-item { padding: 0.28rem 0.38rem; }
            .fx-pair-label { font-size: 0.62rem; }
            .fx-pair-price { font-size: 0.85rem; }
            .fx-pair-change { font-size: 0.68rem; }
            .fx-pair-item { padding: 0.28rem 0.38rem; }
            .cb-rate-item { font-size: 0.6rem; }
            .cb-rate-value { font-size: 0.65rem; }
        }

        /* Compact Desktop 1400-1599px (17-19" monitors / 20" screens) */
        @media (min-width: 1400px) and (max-width: 1599px) {
            /* Column Headers - LARGEST - Significantly boosted for 20" screens */
            .column-title { font-size: 1.8rem !important; }
            .column-subtitle { font-size: 1.0rem !important; }
            /* Tickers */
            .news-ticker { height: 40px !important; padding: 0.5rem 1.75rem !important; }
            .ticker-item { font-size: 1.05rem !important; gap: 1.2rem !important; }
            .ticker-time { font-size: 0.95rem !important; }
            .ticker-text { font-size: 1.05rem !important; }
            .market-ticker { height: 52px !important; }
            .market-ticker-item { font-size: 0.95rem !important; gap: 0.6rem !important; }
            .market-ticker-label { font-size: 0.88rem !important; min-width: 85px !important; }
            .market-ticker-value { font-size: 0.95rem !important; }
            .market-ticker-change { font-size: 0.85rem !important; }
            /* Card Content - Headlines MUCH LARGER than bullet points */
            .card-headline { font-size: 1.15rem !important; font-weight: 700 !important; }
            .card-implications { font-size: 0.7rem !important; }
            .card-implications li { font-size: 0.7rem !important; }
            .next-events-title { font-size: 0.72rem !important; }
            .next-event-item { font-size: 0.75rem !important; }
            /* Dashboard Titles - SMALLER than column */
            .macro-dashboard-title { font-size: 0.78rem !important; }
            .macro-dashboard-subtitle { font-size: 0.7rem !important; }
            .commodity-dashboard-title { font-size: 0.78rem !important; }
            .commodity-dashboard-subtitle { font-size: 0.7rem !important; }
            .fx-dashboard-title { font-size: 0.78rem !important; }
            .fx-dashboard-subtitle { font-size: 0.7rem !important; }
            .dashboard-title { font-size: 0.78rem !important; }
            .dashboard-section-subtitle { font-size: 0.7rem !important; }
            /* Dashboard Column Titles & Subtitles - Match dashboard-section-subtitle */
            .commodity-column-title { font-size: 0.7rem !important; }
            .fx-column-title { font-size: 0.7rem !important; }
            .commodity-column-subtitle { font-size: 0.6rem !important; }
            .fx-column-subtitle { font-size: 0.6rem !important; }
            /* Dashboard Values - Compact but Readable */
            .macro-item-label { font-size: 0.58rem !important; }
            .macro-item-value { font-size: 0.78rem !important; }
            .macro-item-change { font-size: 0.62rem !important; }
            .macro-grid-item { padding: 0.18rem 0.22rem !important; min-height: 1.5rem !important; gap: 0.1rem !important; }
            .commodity-item-label { font-size: 0.58rem !important; }
            .commodity-item-price { font-size: 0.78rem !important; }
            .commodity-item-change { font-size: 0.62rem !important; }
            .commodity-item { padding: 0.25rem 0.32rem !important; }
            .fx-pair-label { font-size: 0.58rem !important; }
            .fx-pair-price { font-size: 0.78rem !important; }
            .fx-pair-change { font-size: 0.62rem !important; }
            .fx-pair-item { padding: 0.25rem 0.32rem !important; }
            .cb-rate-item { font-size: 0.55rem !important; }
            .cb-rate-value { font-size: 0.58rem !important; }
        }

        /* Small Desktop 1200-1399px (15-17" monitors) */
        @media (min-width: 1200px) and (max-width: 1399px) {
            /* Column Headers - LARGEST - Significantly boosted */
            .column-title { font-size: 1.45rem; }
            .column-subtitle { font-size: 0.82rem; }
            /* Tickers */
            .news-ticker { height: 36px; padding: 0.45rem 1.5rem; }
            .ticker-item { font-size: 0.95rem; gap: 1rem; }
            .ticker-time { font-size: 0.85rem; }
            .ticker-text { font-size: 0.95rem; }
            .market-ticker { height: 48px; }
            .market-ticker-item { font-size: 0.85rem; gap: 0.5rem; }
            .market-ticker-label { font-size: 0.78rem; min-width: 75px; }
            .market-ticker-value { font-size: 0.85rem; }
            .market-ticker-change { font-size: 0.75rem; }
            /* Card Content - Headlines MUCH LARGER than bullet points */
            .card-headline { font-size: 1.05rem; font-weight: 700; }
            .card-implications { font-size: 0.65rem; }
            .card-implications li { font-size: 0.65rem; }
            .next-events-title { font-size: 0.65rem; }
            .next-event-item { font-size: 0.68rem; }
            /* Dashboard Titles - SMALLER than column */
            .macro-dashboard-title { font-size: 0.72rem; }
            .macro-dashboard-subtitle { font-size: 0.62rem; }
            .commodity-dashboard-title { font-size: 0.72rem; }
            .commodity-dashboard-subtitle { font-size: 0.62rem; }
            .fx-dashboard-title { font-size: 0.72rem; }
            .fx-dashboard-subtitle { font-size: 0.62rem; }
            .dashboard-title { font-size: 0.72rem; }
            .dashboard-section-subtitle { font-size: 0.62rem; }
            /* Dashboard Column Titles & Subtitles - Match dashboard-section-subtitle */
            .commodity-column-title { font-size: 0.62rem; }
            .fx-column-title { font-size: 0.62rem; }
            .commodity-column-subtitle { font-size: 0.55rem; }
            .fx-column-subtitle { font-size: 0.55rem; }
            /* Dashboard Values - Compact but Readable */
            .macro-item-label { font-size: 0.55rem; }
            .macro-item-value { font-size: 0.72rem; }
            .macro-item-change { font-size: 0.58rem; }
            .macro-grid-item { padding: 0.15rem 0.18rem; min-height: 1.4rem; gap: 0.08rem; }
            .commodity-item-label { font-size: 0.55rem; }
            .commodity-item-price { font-size: 0.72rem; }
            .commodity-item-change { font-size: 0.58rem; }
            .commodity-item { padding: 0.22rem 0.28rem; }
            .fx-pair-label { font-size: 0.55rem; }
            .fx-pair-price { font-size: 0.72rem; }
            .fx-pair-change { font-size: 0.58rem; }
            .fx-pair-item { padding: 0.22rem 0.28rem; }
            .cb-rate-item { font-size: 0.5rem; }
            .cb-rate-value { font-size: 0.55rem; }
        }

        /* Tablet Landscape 768-1199px */
        @media (min-width: 768px) and (max-width: 1199px) {
            /* Column Headers */
            .column-title { font-size: 1.15rem; }
            .column-subtitle { font-size: 0.62rem; }
            /* Tickers */
            .news-ticker { height: 34px; padding: 0.4rem 1.25rem; }
            .ticker-item { font-size: 0.88rem; gap: 0.9rem; }
            .ticker-time { font-size: 0.78rem; }
            .ticker-text { font-size: 0.88rem; }
            .top-story-badge { font-size: 0.65rem; padding: 0.2rem 0.4rem; }
            .market-ticker { height: 44px; }
            .market-ticker-item { font-size: 0.78rem; gap: 0.4rem; }
            .market-ticker-label { font-size: 0.7rem; min-width: 65px; }
            .market-ticker-value { font-size: 0.78rem; }
            .market-ticker-change { font-size: 0.68rem; }
            /* Card Content - PROMINENT */
            .card-headline { font-size: 0.92rem; font-weight: 700; }
            .card-implications { font-size: 0.75rem; }
            .card-implications li { font-size: 0.75rem; }
            .next-events-title { font-size: 0.65rem; }
            .next-event-item { font-size: 0.68rem; }
            /* Dashboard Titles - SMALLER than column */
            .macro-dashboard-title { font-size: 0.75rem; }
            .macro-dashboard-subtitle { font-size: 0.62rem; }
            .commodity-dashboard-title { font-size: 0.75rem; }
            .commodity-dashboard-subtitle { font-size: 0.62rem; }
            .fx-dashboard-title { font-size: 0.75rem; }
            .fx-dashboard-subtitle { font-size: 0.62rem; }
            .dashboard-title { font-size: 0.75rem; }
            .dashboard-section-subtitle { font-size: 0.62rem; }
            /* Dashboard Column Titles & Subtitles - Match dashboard-section-subtitle */
            .commodity-column-title { font-size: 0.62rem; }
            .fx-column-title { font-size: 0.62rem; }
            .commodity-column-subtitle { font-size: 0.55rem; }
            .fx-column-subtitle { font-size: 0.55rem; }
            /* Dashboard Values - Readable for tablet */
            .macro-item-label { font-size: 0.62rem; }
            .macro-item-value { font-size: 0.8rem; }
            .macro-item-change { font-size: 0.65rem; }
            .commodity-item-label { font-size: 0.62rem; }
            .commodity-item-price { font-size: 0.8rem; }
            .commodity-item-change { font-size: 0.65rem; }
            .fx-pair-label { font-size: 0.62rem; }
            .fx-pair-price { font-size: 0.8rem; }
            .fx-pair-change { font-size: 0.65rem; }
        }

        /* Mobile Portrait <768px */
        @media (max-width: 767px) {
            /* Column Headers */
            .column-title { font-size: 1.25rem; }
            .column-subtitle { font-size: 0.72rem; }
            /* Tickers */
            .news-ticker { height: 31px; padding: 0.35rem 1rem; }
            .ticker-item { font-size: 0.82rem; gap: 0.8rem; }
            .ticker-time { font-size: 0.72rem; }
            .ticker-text { font-size: 0.82rem; }
            .top-story-badge { font-size: 0.6rem; padding: 0.15rem 0.35rem; }
            .market-ticker { height: 40px; padding: 0.5rem 1rem; }
            .market-ticker-item { font-size: 0.72rem; gap: 0.35rem; }
            .market-ticker-label { font-size: 0.65rem; min-width: 55px; }
            .market-ticker-value { font-size: 0.72rem; }
            .market-ticker-change { font-size: 0.62rem; }
            /* Card Content - PROMINENT */
            .card-headline { font-size: 1.05rem; font-weight: 700; }
            .card-implications { font-size: 0.85rem; }
            .card-implications li { font-size: 0.85rem; }
            .next-events-title { font-size: 0.75rem; }
            .next-event-item { font-size: 0.78rem; }
            /* Dashboard Titles - SMALLER than column */
            .macro-dashboard-title { font-size: 0.92rem; }
            .macro-dashboard-subtitle { font-size: 0.72rem; }
            .commodity-dashboard-title { font-size: 0.92rem; }
            .commodity-dashboard-subtitle { font-size: 0.72rem; }
            .fx-dashboard-title { font-size: 0.92rem; }
            .fx-dashboard-subtitle { font-size: 0.72rem; }
            .dashboard-title { font-size: 0.92rem; }
            .dashboard-section-subtitle { font-size: 0.72rem; }
            /* Dashboard Column Titles & Subtitles - Match dashboard-section-subtitle */
            .commodity-column-title { font-size: 0.72rem; }
            .fx-column-title { font-size: 0.72rem; }
            .commodity-column-subtitle { font-size: 0.62rem; }
            .fx-column-subtitle { font-size: 0.62rem; }
            /* Dashboard Values - larger on mobile */
            .macro-item-label { font-size: 0.72rem; }
            .macro-item-value { font-size: 0.88rem; }
            .macro-item-change { font-size: 0.68rem; }
            .commodity-item-label { font-size: 0.72rem; }
            .commodity-item-price { font-size: 0.88rem; }
            .commodity-item-change { font-size: 0.68rem; }
            .fx-pair-label { font-size: 0.72rem; }
            .fx-pair-price { font-size: 0.88rem; }
            .fx-pair-change { font-size: 0.68rem; }
        }

        /* Small Mobile <480px */
        @media (max-width: 479px) {
            /* Column Headers */
            .column-title { font-size: 1.15rem; }
            .column-subtitle { font-size: 0.65rem; }
            /* Tickers */
            .news-ticker { height: 29px; padding: 0.25rem 0.75rem; }
            .ticker-item { font-size: 0.75rem; gap: 0.6rem; }
            .ticker-time { font-size: 0.65rem; }
            .ticker-text { font-size: 0.75rem; }
            .top-story-badge { font-size: 0.55rem; padding: 0.12rem 0.3rem; }
            .market-ticker { height: 36px; padding: 0.4rem 0.75rem; }
            .market-ticker-item { font-size: 0.65rem; gap: 0.3rem; }
            .market-ticker-label { font-size: 0.58rem; min-width: 48px; }
            .market-ticker-value { font-size: 0.65rem; }
            .market-ticker-change { font-size: 0.55rem; }
            /* Card Content - PROMINENT */
            .card-headline { font-size: 0.95rem; font-weight: 700; }
            .card-implications { font-size: 0.78rem; }
            .card-implications li { font-size: 0.78rem; }
            .next-events-title { font-size: 0.68rem; }
            .next-event-item { font-size: 0.72rem; }
            /* Dashboard Titles - SMALLER than column */
            .macro-dashboard-title { font-size: 0.85rem; }
            .macro-dashboard-subtitle { font-size: 0.65rem; }
            .commodity-dashboard-title { font-size: 0.85rem; }
            .commodity-dashboard-subtitle { font-size: 0.65rem; }
            .fx-dashboard-title { font-size: 0.85rem; }
            .fx-dashboard-subtitle { font-size: 0.65rem; }
            .dashboard-title { font-size: 0.85rem; }
            .dashboard-section-subtitle { font-size: 0.65rem; }
            /* Dashboard Column Titles & Subtitles - Match dashboard-section-subtitle */
            .commodity-column-title { font-size: 0.65rem; }
            .fx-column-title { font-size: 0.65rem; }
            .commodity-column-subtitle { font-size: 0.58rem; }
            .fx-column-subtitle { font-size: 0.58rem; }
        }

        /* Main Grid - 4 Columns */
        .main-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1px;
            background: var(--border);
            padding: 1px;
            height: calc(100vh - 150px);
            overflow: hidden;
        }

        .column {
            background: var(--bg-column);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            max-height: 100%;
        }

        .column-header {
            padding: 1rem;
            border-bottom: 2px solid var(--border);
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 10;
        }

        .column-title {
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            margin-bottom: 0.25rem;
            text-align: center;
        }

        .column-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
        }

        .col-breaking .column-title { color: var(--accent-red); }
        .col-macro .column-title { color: var(--accent-blue); }
        .col-geo .column-title { color: var(--accent-purple); }
        .col-commodity .column-title { color: var(--accent-yellow); }
        .col-fx .column-title { color: #00D9FF; }
        .col-prediction .column-title { color: var(--accent-moss); }
        .col-market .column-title { color: var(--accent-green); }

        /* Refresh button */
        .refresh-btn {
            cursor: pointer;
            font-size: 1rem;
            opacity: 0.6;
            transition: all 0.2s ease;
            margin-left: 8px;
        }
        
        .refresh-btn:hover {
            opacity: 1;
            transform: rotate(180deg);
        }
        
        .refresh-btn.spinning {
            animation: spin 0.5s linear;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Live pulse indicator */
        .live-pulse {
            display: inline-block;
            width: 6px;
            height: 6px;
            background: #D4714A;
            border-radius: 50%;
            margin-right: 4px;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(212, 113, 74, 0.7); }
            50% { opacity: 0.6; box-shadow: 0 0 0 4px rgba(212, 113, 74, 0); }
        }

        .column-content {
            padding: 1rem;
            padding-bottom: 4rem;
            overflow-y: auto;
            overflow-x: hidden;
            flex: 1;
            /* Thin CSS3 scrollbars */
            scrollbar-width: thin;
            scrollbar-color: rgba(212, 113, 74, 0.3) transparent;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 1rem;
            animation: slideIn 0.4s ease-out;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: var(--accent-orange);
            transform: translateX(2px);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-timestamp {
            font-size: 0.65rem;
            color: var(--text-dim);
            margin-bottom: 0.5rem;
        }

        .card-source {
            font-size: 0.7rem;
            color: var(--accent-blue);
            margin-bottom: 0.5rem;
        }

        .card-headline {
            /* font-size and font-weight set by responsive breakpoints */
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .card-implications {
            /* font-size set by responsive breakpoints */
            color: var(--text-secondary);
            line-height: 1.3;
            margin-bottom: 0.5rem;
        }

        .card-implications li {
            margin-left: 1rem;
            margin-bottom: 0.15rem;
        }

        /* Card Meta */
        .card-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            font-size: 0.65rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .meta-label {
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .meta-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .impact-indicator {
            display: flex;
            gap: 2px;
        }

        /* Tripwire Section - Key Levels */
        .tripwire-section {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.12) 0%, rgba(255, 152, 0, 0.06) 100%);
            border: 1px solid rgba(255, 193, 7, 0.4);
            border-left: 4px solid #FFC107;
            border-radius: 6px;
            padding: 0.6rem 0.8rem;
            margin-top: 0.8rem;
        }

        .tripwire-title {
            font-size: 0.7rem;
            color: #FFC107;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            margin-bottom: 0.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }

        .tripwire-item {
            font-size: 0.75rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            line-height: 1.4;
            font-family: 'IBM Plex Sans', sans-serif;
            background: rgba(0, 0, 0, 0.3);
            padding: 0.35rem 0.5rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            border-left: 2px solid rgba(255, 193, 7, 0.5);
        }
        
        .tripwire-item::before {
            content: "âš¡";
            margin-right: 0.5rem;
            font-size: 0.65rem;
        }

        /* Macro Plumbing Grid - 2x4 Layout (Rates Dashboard) */
        .macro-grid-container {
            background: linear-gradient(135deg, rgba(51, 153, 255, 0.1) 0%, rgba(51, 153, 255, 0.05) 100%);
            border: 1px solid var(--accent-blue);
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 1rem;
            max-width: 100%;
            overflow: hidden;
            box-sizing: border-box;
        }

        .macro-dashboard-title {
            font-family: 'IBM Plex Sans', sans-serif;
            /* font-size set by responsive breakpoints */
            font-weight: 700;
            color: var(--accent-blue);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.3rem;
            text-align: center;
        }
        .macro-dashboard-subtitle {
            /* font-size set by responsive breakpoints */
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            text-align: center;
        }

        .macro-grid {
            display: grid;
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            gap: 0.5rem;
            max-width: 100%;
        }

        .macro-grid-column {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            min-width: 0;
            overflow: hidden;
        }

        .macro-grid-item {
            background: rgba(42, 48, 64, 0.3);
            border: 1px solid rgba(51, 153, 255, 0.25);
            border-radius: 4px;
            padding: 0.3rem 0.4rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            gap: 0.25rem;
            min-height: 2.2rem;
            min-width: 0;
            overflow: hidden;
        }

        .macro-grid-item:hover {
            border-color: var(--accent-blue);
            background: rgba(51, 153, 255, 0.15);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(51, 153, 255, 0.2);
        }

        .macro-grid-item.tripwire-hit {
            border-left: 3px solid var(--accent-red);
            background: rgba(255, 68, 102, 0.05);
        }

        .macro-item-left {
            display: flex;
            flex-direction: column;
            gap: 0.1rem;
            min-width: 0;
            flex-shrink: 1;
        }

        .macro-item-label {
            /* font-size set by responsive breakpoints */
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.2px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .macro-item-value {
            /* font-size set by responsive breakpoints */
            font-family: 'IBM Plex Sans', sans-serif;
            font-weight: 700;
            color: var(--accent-blue);
            white-space: nowrap;
        }

        .macro-item-right {
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.1rem;
            flex-shrink: 0;
        }

        .macro-item-change {
            /* font-size set by responsive breakpoints */
            font-weight: 600;
            white-space: nowrap;
        }

        .macro-up {
            color: var(--accent-green);
        }

        .macro-down {
            color: var(--accent-red);
        }

        .macro-neutral {
            color: var(--text-dim);
        }


        /* Commodities Dashboard - Yellow/Gold Theme */
        .commodity-dashboard-container {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 152, 0, 0.1) 100%);
            border: 1px solid var(--accent-yellow);
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            max-width: 100%;
            overflow: hidden;
            box-sizing: border-box;
        }

        .commodity-dashboard-title {
            font-family: 'IBM Plex Sans', sans-serif;
            /* font-size set by responsive breakpoints */
            font-weight: 700;
            color: var(--accent-yellow);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.3rem;
            text-align: center;
        }
        
        .commodity-dashboard-subtitle {
            /* font-size set by responsive breakpoints */
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .commodity-grid-3col {
            display: grid;
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            grid-template-rows: auto auto;
            gap: 0.5rem;
            max-width: 100%;
        }

        .commodity-grid-3col .commodity-grid-column:nth-child(3) {
            grid-column: 1 / -1;
        }

        .commodity-grid-3col .commodity-grid-column:nth-child(3) #commodityAgriculture {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .commodity-grid-column {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 0;
            overflow: hidden;
        }

        .commodity-column-title {
            /* font-size set by responsive breakpoints */
            color: var(--accent-yellow);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-weight: 700;
            margin-bottom: 0.25rem;
            text-align: center;
        }

        .commodity-column-subtitle {
            /* font-size set by responsive breakpoints - matches .dashboard-section-subtitle */
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 193, 7, 0.25);
        }

        .commodity-item {
            background: rgba(42, 48, 64, 0.4);
            border: 1px solid rgba(255, 193, 7, 0.35);
            border-radius: 5px;
            padding: 0.6rem 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            min-width: 0;
            word-break: keep-all;
        }

        .commodity-item:hover {
            border-color: var(--accent-yellow);
            background: rgba(255, 193, 7, 0.18);
        }

        .commodity-item-left {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .commodity-item-label {
            /* font-size set by responsive breakpoints */
            color: var(--text-secondary);
            font-weight: 600;
        }

        .commodity-ticker {
            font-size: 0.6rem;
            color: rgba(255, 193, 7, 0.6);
            font-weight: 400;
            margin-left: 0.25rem;
        }

        .commodity-item-price {
            /* font-size set by responsive breakpoints */
            font-family: 'IBM Plex Sans', sans-serif;
            font-weight: 700;
            color: var(--accent-yellow);
        }

        .commodity-item-right {
            text-align: right;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .commodity-item-change {
            /* font-size set by responsive breakpoints */
            font-weight: 600;
        }

        .commodity-up {
            color: var(--accent-green);
        }

        .commodity-down {
            color: var(--accent-red);
        }

        .commodity-neutral {
            color: var(--text-dim);
        }

        /* FX Pairs Dashboard - Cyan/Teal Theme */
        .fx-dashboard-container {
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(0, 180, 216, 0.1) 100%);
            border: 1px solid #00D9FF;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            max-width: 100%;
            overflow: hidden;
            box-sizing: border-box;
        }

        .fx-dashboard-title {
            font-family: 'IBM Plex Sans', sans-serif;
            /* font-size set by responsive breakpoints */
            font-weight: 700;
            color: #00D9FF;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.3rem;
            text-align: center;
        }
        
        .fx-dashboard-subtitle {
            /* font-size set by responsive breakpoints */
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .fx-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .fx-grid-3col {
            display: grid;
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            grid-template-rows: auto auto;
            gap: 0.5rem;
            max-width: 100%;
        }
        
        .fx-grid-3col .fx-grid-column:nth-child(3) {
            grid-column: 1 / -1;
        }
        
        .fx-grid-3col .fx-grid-column:nth-child(3) #fxCommodity {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .fx-grid-column {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 0;
            overflow: hidden;
        }

        .fx-column-title {
            /* font-size set by responsive breakpoints */
            color: #00D9FF;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-weight: 700;
            margin-bottom: 0.25rem;
            text-align: center;
        }

        .fx-column-subtitle {
            /* font-size set by responsive breakpoints - matches .dashboard-section-subtitle */
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(0, 217, 255, 0.25);
        }

        .fx-pair-item {
            background: rgba(42, 48, 64, 0.4);
            border: 1px solid rgba(0, 217, 255, 0.35);
            border-radius: 5px;
            padding: 0.6rem 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            cursor: pointer;
            min-width: 0;
            word-break: keep-all;
        }

        .fx-pair-item:hover {
            border-color: #00D9FF;
            background: rgba(0, 217, 255, 0.18);
            transform: translateY(-1px);
        }

        .fx-pair-left {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .fx-pair-label {
            /* font-size set by responsive breakpoints */
            color: var(--text-secondary);
            font-weight: 600;
        }

        .fx-pair-price {
            /* font-size set by responsive breakpoints */
            font-family: 'IBM Plex Sans', sans-serif;
            font-weight: 700;
            color: #00D9FF;
        }

        .fx-pair-right {
            text-align: right;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .fx-pair-change {
            /* font-size set by responsive breakpoints */
            font-weight: 600;
        }

        .fx-up {
            color: var(--accent-green);
        }

        .fx-down {
            color: var(--accent-red);
        }

        .fx-neutral {
            color: var(--text-dim);
        }

        /* Central Bank Rates Section */
        .cb-rates-container {
            background: rgba(42, 48, 64, 0.2);
            border: 1px solid rgba(0, 217, 255, 0.2);
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 1rem;
        }

        .cb-rates-title {
            font-size: 0.65rem;
            color: #00D9FF;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            font-weight: 700;
            text-align: center;
        }

        .cb-rate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0;
            border-bottom: 1px solid rgba(0, 217, 255, 0.1);
            font-size: 0.65rem;
        }

        .cb-rate-item:last-child {
            border-bottom: none;
        }

        .cb-rate-left {
            display: flex;
            gap: 0.3rem;
            align-items: center;
        }

        .cb-rate-bank {
            font-weight: 700;
            color: var(--text-secondary);
        }

        .cb-rate-currency {
            color: var(--text-dim);
            font-size: 0.6rem;
        }

        .cb-rate-right {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .cb-rate-value {
            font-family: 'IBM Plex Sans', sans-serif;
            font-weight: 700;
            color: #00D9FF;
        }

        .cb-rate-next {
            color: var(--text-dim);
            font-size: 0.6rem;
        }

        /* Probability Nudge */
        .probability-nudge {
            display: flex;
            gap: 0.75rem;
            margin-top: 0.75rem;
            font-size: 0.7rem;
        }

        .prob-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .prob-arrow {
            font-weight: 700;
        }

        .prob-up { color: var(--accent-green); }
        .prob-down { color: var(--accent-red); }

        /* News Tags - Minimalist Style */
        .news-tags {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border);
        }

        .news-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
            padding: 0.2rem 0.45rem;
            background: rgba(42, 48, 64, 0.4);
            border: 1px solid var(--border);
            border-radius: 3px;
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .news-tag:hover {
            border-color: var(--accent-orange);
            background: rgba(212, 113, 74, 0.05);
        }

        /* Tag Type Colors */
        .news-tag.flash {
            border-color: var(--accent-red);
            color: var(--accent-red);
            background: rgba(255, 68, 102, 0.05);
        }

        .news-tag.risk-on {
            border-color: #22c55e;
            color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }

        .news-tag.risk-off {
            border-color: var(--accent-red);
            color: var(--accent-red);
            background: rgba(255, 68, 102, 0.05);
        }

        .news-tag.multi-asset {
            border-color: var(--accent-purple);
            color: var(--accent-purple);
            background: rgba(187, 102, 255, 0.05);
        }

        .news-tag.rates,
        .news-tag.equities,
        .news-tag.commodities,
        .news-tag.fx,
        .news-tag.credit {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            background: rgba(51, 153, 255, 0.05);
        }

        /* Horizon Tags - Time to Impact */
        .news-tag.horizon-now {
            border-color: #ff4466;
            color: #ff4466;
            background: rgba(255, 68, 102, 0.15);
            font-weight: 700;
            animation: pulse-now 1.5s ease-in-out infinite;
        }
        @keyframes pulse-now {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 68, 102, 0.4); }
            50% { box-shadow: 0 0 8px 2px rgba(255, 68, 102, 0.3); }
        }
        .news-tag.horizon-intraday {
            border-color: #ff9933;
            color: #ff9933;
            background: rgba(255, 153, 51, 0.1);
        }
        .news-tag.horizon-days {
            border-color: #ffcc00;
            color: #ffcc00;
            background: rgba(255, 204, 0, 0.08);
        }
        .news-tag.horizon-weeks {
            border-color: #3399ff;
            color: #3399ff;
            background: rgba(51, 153, 255, 0.08);
        }
        .news-tag.horizon-na {
            border-color: #6a7585;
            color: #6a7585;
            background: rgba(106, 117, 133, 0.08);
        }

        /* Regime Badge */
        .regime-badge {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            margin-bottom: 0.5rem;
            background: rgba(187, 102, 255, 0.1);
            border: 1px solid var(--accent-purple);
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--accent-purple);
        }

        /* Market Risk Indicator */
        .confidence-bar {
            margin-top: 1rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border);
        }

        .confidence-label {
            font-size: 0.6rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 0.3rem;
        }

        .confidence-track {
            height: 4px;
            background: rgba(42, 48, 64, 0.5);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        /* Dynamic risk colors set via inline style from JS */
        .confidence-fill.risk-low {
            background: linear-gradient(90deg, #00ff88 0%, #33ff99 100%);
        }
        .confidence-fill.risk-medium {
            background: linear-gradient(90deg, #00ff88 0%, #88cc44 40%, #ffbb33 100%);
        }
        .confidence-fill.risk-elevated {
            background: linear-gradient(90deg, #00ff88 0%, #ffbb33 50%, #ff8833 100%);
        }
        .confidence-fill.risk-high {
            background: linear-gradient(90deg, #00ff88 0%, #ffbb33 30%, #ff8833 60%, #ff4466 100%);
        }
        .confidence-fill.risk-critical {
            background: linear-gradient(90deg, #00ff88 0%, #ffbb33 20%, #ff8833 40%, #ff4466 70%, #dd2244 100%);
        }

        /* Next Events Section */
        .next-events {
            margin-top: 1rem;
            padding: 0.5rem 0.6rem;
            background: rgba(51, 153, 255, 0.05);
            border: 1px solid rgba(51, 153, 255, 0.2);
            border-radius: 4px;
        }

        .next-events-title {
            /* font-size set by responsive breakpoints */
            color: var(--accent-blue);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
            font-weight: 700;
        }

        .next-event-item {
            /* font-size set by responsive breakpoints */
            color: var(--text-secondary);
            margin-left: 0.5rem;
            margin-bottom: 0.1rem;
            line-height: 1.3;
        }

        .next-event-item:before {
            content: "â†’ ";
            color: var(--accent-blue);
            font-weight: 700;
        }

        /* Market Cards */
        .market-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .market-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .market-value {
            font-size: 1rem;
            font-weight: 700;
            font-family: 'IBM Plex Sans', sans-serif;
        }

        .market-change {
            font-size: 0.7rem;
            margin-top: 0.2rem;
        }

        .market-up { color: var(--accent-green); }
        .market-down { color: var(--accent-red); }
        .market-neutral { color: var(--text-dim); }

        /* Thin CSS3 Scrollbars for columns */
        .column-content::-webkit-scrollbar {
            width: 5px;
        }

        .column-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .column-content::-webkit-scrollbar-thumb {
            background: rgba(212, 113, 74, 0.25);
            border-radius: 3px;
        }

        .column-content::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 113, 74, 0.5);
        }
        
        /* Column-specific scrollbar colors */
        .col-breaking .column-content { scrollbar-color: rgba(255, 68, 102, 0.3) transparent; }
        .col-breaking .column-content::-webkit-scrollbar-thumb { background: rgba(255, 68, 102, 0.25); }
        .col-breaking .column-content::-webkit-scrollbar-thumb:hover { background: rgba(255, 68, 102, 0.5); }
        
        .col-macro .column-content { scrollbar-color: rgba(51, 153, 255, 0.3) transparent; }
        .col-macro .column-content::-webkit-scrollbar-thumb { background: rgba(51, 153, 255, 0.25); }
        .col-macro .column-content::-webkit-scrollbar-thumb:hover { background: rgba(51, 153, 255, 0.5); }
        
        .col-geo .column-content { scrollbar-color: rgba(187, 102, 255, 0.3) transparent; }
        .col-geo .column-content::-webkit-scrollbar-thumb { background: rgba(187, 102, 255, 0.25); }
        .col-geo .column-content::-webkit-scrollbar-thumb:hover { background: rgba(187, 102, 255, 0.5); }
        
        .col-commodity .column-content { scrollbar-color: rgba(255, 187, 51, 0.3) transparent; }
        .col-commodity .column-content::-webkit-scrollbar-thumb { background: rgba(255, 187, 51, 0.25); }
        .col-commodity .column-content::-webkit-scrollbar-thumb:hover { background: rgba(255, 187, 51, 0.5); }
        
        .col-fx .column-content { scrollbar-color: rgba(0, 217, 255, 0.3) transparent; }
        .col-fx .column-content::-webkit-scrollbar-thumb { background: rgba(0, 217, 255, 0.25); }
        .col-fx .column-content::-webkit-scrollbar-thumb:hover { background: rgba(0, 217, 255, 0.5); }
        
        .col-prediction .column-content { scrollbar-color: rgba(143, 188, 143, 0.3) transparent; }
        .col-prediction .column-content::-webkit-scrollbar-thumb { background: rgba(143, 188, 143, 0.25); }
        .col-prediction .column-content::-webkit-scrollbar-thumb:hover { background: rgba(143, 188, 143, 0.5); }

        /* Prediction Dashboard - Mossy Green Theme */
        .prediction-dashboard {
            background: linear-gradient(135deg, rgba(143, 188, 143, 0.12) 0%, rgba(85, 120, 85, 0.08) 100%);
            border: 1px solid #8fbc8f;
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        .dashboard-section {
            padding: 10px;
            border-bottom: 1px solid rgba(143, 188, 143, 0.15);
        }
        .dashboard-section:last-child {
            border-bottom: none;
        }
        .dashboard-title {
            font-family: 'IBM Plex Sans', sans-serif;
            /* font-size set by responsive breakpoints */
            font-weight: 700;
            color: var(--accent-moss);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            margin-bottom: 0.3rem;
            text-align: center;
        }
        .dashboard-section-subtitle {
            font-size: 0.65rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        /* Sentiment Dashboard Grid */
        .sentiment-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }
        .sentiment-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 6px 8px;
            text-align: center;
            border-left: 3px solid rgba(143, 188, 143, 0.6);
        }
        .sentiment-label {
            font-size: 0.6rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .sentiment-value {
            font-size: 0.85rem;
            font-weight: 700;
            line-height: 1.2;
        }
        .sentiment-sub {
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-top: 2px;
        }
        .sentiment-loading {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-align: center;
            padding: 16px;
        }
        
        /* Polymarket Container - no scrollbar, show all */
        .polymarket-container {
            max-height: none;
            overflow-y: visible;
        }
        .polymarket-empty {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-align: center;
            padding: 16px;
        }
        
        /* Game Theory Dashboard Container - for GEOPOLITICS column */
        .game-theory-dashboard-container {
            background: linear-gradient(135deg, rgba(187, 102, 255, 0.12) 0%, rgba(139, 92, 246, 0.08) 100%);
            border: 1px solid #a855f7;
            border-radius: 8px;
            margin-bottom: 12px;
            padding: 10px;
        }
        /* Game Theory Engine Styles */
        .game-theory-section {
            margin-top: 1rem;
            border-top: 1px solid rgba(187, 102, 255, 0.3);
            padding-top: 1rem;
        }
        .game-theory-container {
            max-height: none;
            overflow-y: visible;
        }
        .game-theory-loading {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-align: center;
            padding: 16px;
        }
        .game-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 6px;
            padding: 10px 12px;
            margin-bottom: 10px;
            border-left: 3px solid;
        }
        .game-card.status-green { border-left-color: #22c55e; }
        .game-card.status-yellow { border-left-color: #f59e0b; }
        .game-card.status-red { border-left-color: #ef4444; }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }
        .game-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #fff;
        }
        .game-phase {
            font-size: 0.65rem;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
        }
        .game-phase.phase-green { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .game-phase.phase-yellow { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .game-phase.phase-red { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        
        .game-players {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 6px;
        }
        
        .game-last-move {
            background: rgba(255, 255, 255, 0.05);
            padding: 6px 8px;
            border-radius: 4px;
            margin-bottom: 6px;
        }
        .game-move-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 2px;
        }
        .game-move-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        .game-move-type {
            font-size: 0.6rem;
            font-weight: 600;
            padding: 1px 4px;
            border-radius: 2px;
            margin-left: 4px;
        }
        .move-type-defect { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .move-type-cooperate { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .move-type-signal { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        
        .game-equilibrium {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
        }
        .equilibrium-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .equilibrium-dot.eq-green { background: #22c55e; box-shadow: 0 0 6px #22c55e; }
        .equilibrium-dot.eq-yellow { background: #f59e0b; box-shadow: 0 0 6px #f59e0b; }
        .equilibrium-dot.eq-red { background: #ef4444; box-shadow: 0 0 6px #ef4444; animation: pulse-red 1.5s infinite; }
        
        @keyframes pulse-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .equilibrium-text {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .game-next-move {
            font-size: 0.7rem;
            color: var(--accent-orange);
            font-style: italic;
        }
        .game-next-move::before {
            content: "â†’ ";
        }
        
        /* Strategic Intelligence Panel Styles */
        
        /* Full-width legend buttons */
        .statecraft-legend-btn {
            width: 100%;
            background: rgba(168, 85, 247, 0.15);
            border: 1px solid rgba(168, 85, 247, 0.4);
            border-radius: 4px;
            padding: 8px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            animation: purplePulse 3s ease-in-out infinite;
        }
        .statecraft-legend-btn:hover {
            background: rgba(168, 85, 247, 0.25);
            border-color: rgba(168, 85, 247, 0.6);
            box-shadow: 0 0 8px rgba(168, 85, 247, 0.3);
            transform: translateY(-1px);
        }
        .statecraft-legend-btn .legend-text {
            font-size: 0.75rem;
            font-weight: 600;
            color: #a78bfa;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Statecraft Section Labels - centered, bigger */
        .statecraft-section-label {
            font-size: 0.8rem;
            font-weight: 700;
            color: #a78bfa;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
            padding: 8px 0 12px 0;
            margin-top: 8px;
        }
        .statecraft-section-label:first-of-type {
            margin-top: 0;
        }
        
        .strategic-intel-container {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.12) 0%, rgba(168, 85, 247, 0.08) 100%);
            border: 1px solid rgba(168, 85, 247, 0.35);
            border-radius: 8px;
            margin-bottom: 12px;
            padding: 10px;
        }
        .strategic-intel-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: #a855f7;
            text-align: center;
            margin-bottom: 2px;
            letter-spacing: 0.5px;
        }
        .strategic-intel-subtitle {
            font-size: 0.65rem;
            color: #6a7585;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 10px;
        }
        .strategic-intel-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .intel-widget {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(168, 85, 247, 0.25);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .intel-widget:hover {
            border-color: rgba(168, 85, 247, 0.6);
            background: rgba(168, 85, 247, 0.15);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(168, 85, 247, 0.3);
        }
        .intel-widget-header {
            font-size: 0.6rem;
            color: #6a7585;
            font-weight: 700;
            letter-spacing: 0.03em;
            margin-bottom: 4px;
            text-transform: uppercase;
        }
        .intel-widget-value {
            font-size: 0.75rem;
            font-weight: 700;
            color: #e6e8eb;
            margin-bottom: 2px;
            font-family: 'IBM Plex Sans', sans-serif;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        .intel-widget-sub {
            font-size: 0.55rem;
            color: #5a6070;
            text-transform: uppercase;
        }
        .intel-meter {
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            margin-top: 6px;
            border-radius: 2px;
        }
        .intel-meter-fill {
            height: 100%;
            width: 0%;
            background: #22c55e;
            transition: width 0.5s ease, background 0.5s ease;
            border-radius: 2px;
        }
        .intel-fragmentation {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
            padding: 6px 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            font-size: 0.7rem;
            cursor: pointer;
            border: 1px solid rgba(168, 85, 247, 0.4);
            transition: all 0.3s ease;
        }
        .intel-fragmentation:hover {
            background: rgba(168, 85, 247, 0.15);
            box-shadow: 0 2px 8px rgba(168, 85, 247, 0.3);
        }
        .intel-frag-label {
            color: #6a7585;
            font-weight: 600;
            text-transform: uppercase;
        }
        .intel-frag-value {
            color: #22c55e;
            font-weight: 700;
        }
        .intel-frag-hits {
            color: #5a6070;
            font-size: 0.6rem;
        }
        
        .game-analyze-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            background: linear-gradient(135deg, rgba(212, 113, 74, 0.2), rgba(212, 113, 74, 0.1));
            border: 1px solid rgba(212, 113, 74, 0.4);
            border-radius: 4px;
            padding: 6px 10px;
            margin-top: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--accent-orange);
            text-transform: uppercase;
            animation: orangePulse 3s ease-in-out infinite;
            letter-spacing: 0.5px;
            width: 100%;
            box-sizing: border-box;
        }
        @keyframes orangePulse {
            0%, 100% {
                border-color: rgba(212, 113, 74, 0.4);
                box-shadow: 0 0 3px rgba(212, 113, 74, 0.15);
            }
            50% {
                border-color: rgba(212, 113, 74, 0.6);
                box-shadow: 0 0 6px rgba(212, 113, 74, 0.25);
            }
        }
        .game-analyze-btn:hover {
            background: linear-gradient(135deg, rgba(212, 113, 74, 0.3), rgba(212, 113, 74, 0.2));
            border-color: var(--accent-orange);
            box-shadow: 0 0 8px rgba(212, 113, 74, 0.3);
            transform: translateY(-1px);
        }
        
        /* Blue pulse for KNOW MORE button */
        @keyframes bluePulse {
            0%, 100% {
                border-color: rgba(59, 130, 246, 0.4);
                box-shadow: 0 0 3px rgba(59, 130, 246, 0.15);
            }
            50% {
                border-color: rgba(59, 130, 246, 0.6);
                box-shadow: 0 0 6px rgba(59, 130, 246, 0.25);
            }
        }
        .know-more-btn {
            background: transparent;
            border: 1px solid #3b82f6;
            color: #3b82f6;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 9px;
            cursor: pointer;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 4px;
            animation: bluePulse 3s ease-in-out infinite;
            transition: all 0.2s ease;
        }
        .know-more-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.3);
            transform: translateY(-1px);
        }
        .game-analyze-btn-icon {
            font-size: 0.8rem;
        }
        
        .polymarket-item {
            cursor: pointer;
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid rgba(143, 188, 143, 0.6);
            border-radius: 6px;
            padding: 8px 10px;
            transition: all 0.2s ease;
        }
        .polymarket-item:hover {
            border-left-color: var(--accent-orange);
            background: rgba(212, 113, 74, 0.15);
        }
        .polymarket-item:last-child {
            margin-bottom: 0;
        }
        .polymarket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }
        .polymarket-category {
            font-size: 0.6rem;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
        }
        .cat-macro { background: rgba(143, 188, 143, 0.25); color: #93c5fd; }
        .cat-crypto { background: rgba(143, 188, 143, 0.25); color: #fcd34d; }
        .cat-politics { background: rgba(143, 188, 143, 0.25); color: #fca5a5; }
        .cat-geo { background: rgba(143, 188, 143, 0.25); color: #c4b5fd; }
        .cat-commodity { background: rgba(143, 188, 143, 0.25); color: #fde68a; }
        .cat-other { background: rgba(143, 188, 143, 0.25); color: #d1d5db; }
        .polymarket-prob {
            font-size: 0.85rem;
            font-weight: 700;
        }
        .polymarket-question {
            font-size: 0.7rem;
            color: var(--text-secondary);
            line-height: 1.3;
        }

        /* TradingView Chart Modal */
        .chart-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(12px);
            animation: fadeIn 0.2s ease;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .chart-modal-content {
            width: 95%;
            height: 85%;
            max-width: 1400px;
            background: #131722;
            border: 2px solid #00D9FF;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 0 40px rgba(0, 217, 255, 0.3);
            animation: slideIn 0.3s ease;
        }
        
        /* Mobile chart - X button visible at top */
        @media (max-width: 768px) {
            .chart-modal-content {
                width: 95%;
                height: 75%;
                max-height: 500px;
            }
            
            .chart-close-btn {
                top: 8px;
                right: 8px;
                width: 44px;
                height: 44px;
                font-size: 28px;
                background: rgba(0, 0, 0, 0.9);
                z-index: 10;
            }
        }
        
        /* Portrait mode on phones */
        @media (max-width: 480px) and (orientation: portrait) {
            .chart-modal-content {
                width: 95%;
                height: 70%;
                max-height: 450px;
            }
        }

        /* Info Modal specific styles */
        #infoModal .chart-modal-content {
            height: auto;
            max-height: 85vh;
            padding: 1rem;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-orange) var(--bg-column);
            border-color: var(--accent-orange);
        }

        #infoModal .chart-close-btn {
            border-color: var(--accent-orange);
            color: var(--accent-orange);
        }

        #infoModal .chart-modal-content::-webkit-scrollbar {
            width: 6px;
        }

        #infoModal .chart-modal-content::-webkit-scrollbar-track {
            background: var(--bg-column);
            border-radius: 3px;
        }

        #infoModal .chart-modal-content::-webkit-scrollbar-thumb {
            background: var(--accent-orange);
            border-radius: 3px;
        }

        #infoModal .chart-modal-content::-webkit-scrollbar-thumb:hover {
            background: #e08050;
        }

        /* Game Theory Legend Modal specific styles */
        #gameLegendModal .chart-modal-content {
            height: auto;
            max-height: 85vh;
            padding: 1rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-color: #9333ea;
        }

        #gameLegendModal .modal-title {
            flex-shrink: 0;
            padding-bottom: 0.5rem;
        }

        #gameLegendModal .modal-analysis {
            flex: 1;
            overflow-y: auto;
            max-height: none;
            scrollbar-width: thin;
            scrollbar-color: #a855f7 var(--bg-column);
        }

        #gameLegendModal .modal-analysis::-webkit-scrollbar {
            width: 6px;
        }

        #gameLegendModal .modal-analysis::-webkit-scrollbar-track {
            background: var(--bg-column);
            border-radius: 3px;
        }

        #gameLegendModal .modal-analysis::-webkit-scrollbar-thumb {
            background: #a855f7;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            #gameLegendModal .chart-modal-content {
                width: 94%;
                max-height: 80vh;
                padding: 0.75rem;
                margin: 1rem;
            }

            #gameLegendModal .modal-analysis {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            #gameLegendModal .chart-modal-content {
                width: 96%;
                max-height: 85vh;
                padding: 0.5rem;
            }

            #gameLegendModal .modal-analysis {
                font-size: 0.8rem;
                padding: 0.25rem;
            }

            #gameLegendModal .modal-title {
                font-size: 1rem;
            }
        }

        /* Intel Legend Modal specific styles - match Games Legend */
        #intelLegendModal .chart-modal-content {
            height: auto;
            max-height: 85vh;
            padding: 1rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-color: #9333ea;
        }

        #intelLegendModal .modal-title {
            flex-shrink: 0;
            padding-bottom: 0.5rem;
        }

        #intelLegendModal .modal-analysis {
            flex: 1;
            overflow-y: auto;
            max-height: none;
            scrollbar-width: thin;
            scrollbar-color: #a855f7 var(--bg-column);
            padding: 0 0.5rem;
        }

        #intelLegendModal .modal-analysis::-webkit-scrollbar {
            width: 6px;
        }

        #intelLegendModal .modal-analysis::-webkit-scrollbar-track {
            background: var(--bg-column);
            border-radius: 3px;
        }

        #intelLegendModal .modal-analysis::-webkit-scrollbar-thumb {
            background: #a855f7;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            #intelLegendModal .chart-modal-content {
                width: 94%;
                max-height: 80vh;
                padding: 0.75rem;
                margin: 1rem;
            }

            #intelLegendModal .modal-analysis {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            #intelLegendModal .chart-modal-content {
                width: 96%;
                max-height: 85vh;
                padding: 0.5rem;
            }

            #intelLegendModal .modal-analysis {
                font-size: 0.8rem;
                padding: 0.25rem;
            }

            #intelLegendModal .modal-title {
                font-size: 1rem;
            }
        }

        /* Individual Intel Widget Modal styles */
        #revRiskModal .chart-modal-content,
        #liarModal .chart-modal-content,
        #paperRockModal .chart-modal-content,
        #mercantilismModal .chart-modal-content,
        #vassalModal .chart-modal-content {
            height: auto;
            max-height: 85vh;
            width: 90%;
            max-width: 650px;
            padding: 1.5rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #revRiskModal .modal-title,
        #liarModal .modal-title,
        #paperRockModal .modal-title,
        #mercantilismModal .modal-title,
        #vassalModal .modal-title {
            flex-shrink: 0;
            padding-bottom: 0.5rem;
            font-size: 1.2rem;
            font-weight: 700;
            text-align: center;
        }

        #revRiskModal .modal-analysis,
        #liarModal .modal-analysis,
        #paperRockModal .modal-analysis,
        #mercantilismModal .modal-analysis,
        #vassalModal .modal-analysis {
            flex: 1;
            overflow-y: auto;
            max-height: none;
            scrollbar-width: thin;
            padding: 0 0.5rem;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #e2e8f0;
        }

        #revRiskModal .modal-analysis::-webkit-scrollbar,
        #liarModal .modal-analysis::-webkit-scrollbar,
        #paperRockModal .modal-analysis::-webkit-scrollbar,
        #mercantilismModal .modal-analysis::-webkit-scrollbar,
        #vassalModal .modal-analysis::-webkit-scrollbar {
            width: 6px;
        }

        #revRiskModal .modal-analysis::-webkit-scrollbar-track,
        #liarModal .modal-analysis::-webkit-scrollbar-track,
        #paperRockModal .modal-analysis::-webkit-scrollbar-track,
        #mercantilismModal .modal-analysis::-webkit-scrollbar-track,
        #vassalModal .modal-analysis::-webkit-scrollbar-track {
            background: var(--bg-column);
            border-radius: 3px;
        }

        #revRiskModal .modal-analysis::-webkit-scrollbar-thumb { background: #ef4444; border-radius: 3px; }
        #liarModal .modal-analysis::-webkit-scrollbar-thumb { background: #f59e0b; border-radius: 3px; }
        #paperRockModal .modal-analysis::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 3px; }
        #mercantilismModal .modal-analysis::-webkit-scrollbar-thumb { background: #22c55e; border-radius: 3px; }
        #vassalModal .modal-analysis::-webkit-scrollbar-thumb { background: #a855f7; border-radius: 3px; }

        @media (max-width: 768px) {
            #revRiskModal .chart-modal-content,
            #liarModal .chart-modal-content,
            #paperRockModal .chart-modal-content,
            #mercantilismModal .chart-modal-content,
            #vassalModal .chart-modal-content {
                width: 94%;
                max-height: 80vh;
                padding: 1rem;
            }
            
            #revRiskModal .modal-analysis,
            #liarModal .modal-analysis,
            #paperRockModal .modal-analysis,
            #mercantilismModal .modal-analysis,
            #vassalModal .modal-analysis {
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            #revRiskModal .chart-modal-content,
            #liarModal .chart-modal-content,
            #paperRockModal .chart-modal-content,
            #mercantilismModal .chart-modal-content,
            #vassalModal .chart-modal-content {
                width: 96%;
                max-height: 85vh;
                padding: 0.75rem;
            }
            
            #revRiskModal .modal-title,
            #liarModal .modal-title,
            #paperRockModal .modal-title,
            #mercantilismModal .modal-title,
            #vassalModal .modal-title {
                font-size: 1rem;
            }
            
            #revRiskModal .modal-analysis,
            #liarModal .modal-analysis,
            #paperRockModal .modal-analysis,
            #mercantilismModal .modal-analysis,
            #vassalModal .modal-analysis {
                font-size: 0.8rem;
            }
        }

        /* Rates Dashboard Legend Modal specific styles */
        #ratesLegendModal .chart-modal-content {
            height: auto;
            max-height: 85vh;
            padding: 1rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-color: #3b82f6;
        }

        #ratesLegendModal .modal-title {
            flex-shrink: 0;
            padding-bottom: 0.5rem;
        }

        #ratesLegendModal .modal-analysis {
            flex: 1;
            overflow-y: auto;
            max-height: none;
            scrollbar-width: thin;
            scrollbar-color: #3b82f6 var(--bg-column);
            padding: 0 0.5rem;
        }

        #ratesLegendModal .modal-analysis::-webkit-scrollbar {
            width: 6px;
        }

        #ratesLegendModal .modal-analysis::-webkit-scrollbar-track {
            background: var(--bg-column);
            border-radius: 3px;
        }

        #ratesLegendModal .modal-analysis::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            #ratesLegendModal .chart-modal-content {
                width: 94%;
                max-height: 80vh;
                padding: 0.75rem;
                margin: 1rem;
            }

            #ratesLegendModal .modal-analysis {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            #ratesLegendModal .chart-modal-content {
                width: 96%;
                max-height: 85vh;
                padding: 0.5rem;
            }

            #ratesLegendModal .modal-analysis {
                font-size: 0.8rem;
                padding: 0.25rem;
            }

            #ratesLegendModal .modal-title {
                font-size: 1rem;
            }
        }

        #infoModal .modal-title {
            padding-right: 2rem;
        }

        #infoModal .modal-analysis {
            padding: 0 0.5rem;
        }
        
        /* Legend item styling for aligned bullets */
        .legend-item {
            display: grid;
            grid-template-columns: 2.5rem 1fr;
            gap: 0.5rem;
            margin-bottom: 0.35rem;
            align-items: start;
        }
        
        .legend-item .legend-icon {
            text-align: center;
            flex-shrink: 0;
        }
        
        .legend-item .legend-text {
            line-height: 1.4;
        }

        .info-modal-scroll {
            scrollbar-width: thin;
            scrollbar-color: var(--accent-orange) var(--bg-column);
        }

        .info-modal-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .info-modal-scroll::-webkit-scrollbar-track {
            background: var(--bg-column);
            border-radius: 3px;
        }

        .info-modal-scroll::-webkit-scrollbar-thumb {
            background: var(--accent-orange);
            border-radius: 3px;
        }

        .info-modal-scroll::-webkit-scrollbar-thumb:hover {
            background: #e08050;
        }

        @media (max-width: 768px) {
            #infoModal .chart-modal-content {
                width: 92%;
                max-width: 100%;
                max-height: 80vh;
                padding: 0.75rem;
                margin: 1rem;
            }

            #infoModal .modal-analysis {
                max-height: 65vh !important;
                padding: 0;
                font-size: 0.85rem;
            }

            #infoModal .modal-analysis p {
                margin-bottom: 0.5rem;
            }

            #infoModal .modal-analysis h3 {
                font-size: 0.9rem;
                margin-top: 1rem !important;
            }
        }

        @media (max-width: 480px) and (orientation: portrait) {
            #infoModal .chart-modal-content {
                width: 94%;
                max-height: 75vh;
                padding: 0.5rem;
                margin: 0.5rem;
            }

            #infoModal .modal-analysis {
                max-height: 60vh !important;
                font-size: 0.8rem;
            }

            #infoModal .modal-title {
                font-size: 1rem;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .chart-close-btn {
            position: absolute;
            top: -45px;
            right: 0;
            background: transparent;
            border: 2px solid #00D9FF;
            color: #00D9FF;
            font-size: 28px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: 300;
            line-height: 1;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-close-btn:hover {
            background: var(--accent-orange);
            color: #000;
            transform: rotate(90deg);
        }

        #tradingview_widget {
            width: 100%;
            height: 100%;
            border-radius: 6px;
            overflow: hidden;
        }

        /* Mobile Tab Navigation */
        .mobile-tabs {
            display: none;
            background: var(--bg-card);
            border-bottom: 2px solid var(--border);
            padding: 0.5rem;
            gap: 0.25rem;
            position: sticky;
            top: 60px;
            z-index: 999;
        }

        .mobile-tab {
            flex: 1;
            padding: 0.5rem 0.25rem;
            background: var(--bg-column);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 0.55rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mobile-tab:active {
            transform: scale(0.98);
        }

        .mobile-tab.active {
            background: var(--accent-red);
            color: #ffffff;
            border-color: var(--accent-red);
            font-size: 0.63rem;
        }
        
        /* Column-specific mobile tab colors */
        .mobile-tab[data-column="breaking"].active {
            background: var(--accent-red);
            border-color: var(--accent-red);
        }
        .mobile-tab[data-column="macro"].active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
        }
        .mobile-tab[data-column="geo"].active {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
        }
        .mobile-tab[data-column="commodity"].active {
            background: var(--accent-yellow);
            border-color: var(--accent-yellow);
        }
        .mobile-tab[data-column="fx"].active {
            background: #00D9FF;
            border-color: #00D9FF;
        }
        .mobile-tab[data-column="prediction"].active {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
        }

        /* Responsive - Force 6 columns on larger screens */
        
        /* Large desktop (1600px+): Full 6 columns with normal spacing */
        @media (min-width: 1600px) {
            .main-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }
        
        /* Medium desktop (1200-1600px): Compact 6 columns */
        @media (min-width: 1200px) and (max-width: 1599px) {
            .main-grid {
                grid-template-columns: repeat(6, 1fr);
                gap: 1px;
            }
            
            .column-title { font-size: 0.65rem; }
            .column-subtitle { font-size: 0.5rem; }
            .card { padding: 0.5rem; margin-bottom: 0.4rem; }
            .card-headline { font-size: 0.7rem; }
            .card-timestamp { font-size: 0.55rem; }
            .card-implications { font-size: 0.55rem; }
            .news-tags { font-size: 0.5rem; }
        }
        
        /* Medium screens (768-1199px) - use accordion row toggle */
        @media (min-width: 768px) and (max-width: 1199px) {
            /* Hide mobile tabs, show accordion row buttons */
            .mobile-tabs {
                display: none !important;
            }
            
            .accordion-toggle-row {
                display: flex !important;
            }
            
            .main-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            /* Hide second row by default in accordion mode */
            .column.accordion-collapsed {
                display: none;
            }
            
            .column.accordion-expanded {
                display: flex;
            }
        }
        
        /* Accordion toggle row (hidden by default, shown on medium screens) */
        .accordion-toggle-row {
            display: none;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            padding: 0.5rem;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .accordion-toggle-btn {
            background: var(--bg-column);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 0.65rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
        }
        
        .accordion-toggle-btn.active {
            background: var(--accent-orange);
            color: #fff;
            border-color: var(--accent-orange);
        }
        
        .accordion-toggle-btn:hover {
            border-color: var(--accent-orange);
        }

        @media (max-width: 767px) {
            .mobile-tabs {
                display: flex;
            }
            
            .accordion-toggle-row {
                display: none !important;
            }

            .main-grid {
                grid-template-columns: 1fr;
            }
            
            /* Mobile prediction market fixes */
            .risk-grid-4 {
                grid-template-columns: 1fr 1fr;
                gap: 0.5rem;
            }
            
            .risk-grid-column {
                padding: 0.3rem;
                gap: 0.15rem;
            }
            
            .risk-item {
                padding: 0.2rem 0.3rem;
            }
            
            .risk-item-label {
                font-size: 0.45rem;
                max-width: 60px;
            }
            
            .risk-item-odds {
                font-size: 0.55rem;
            }
            
            .risk-item-change {
                font-size: 0.4rem;
            }
            
            .risk-column-title {
                font-size: 0.5rem;
                padding-bottom: 0.2rem;
            }

            /* Reset accordion classes for mobile - mobile-active takes precedence */
            .column {
                display: none;
            }
            
            .column.accordion-expanded,
            .column.accordion-collapsed {
                display: none;
            }

            .column.mobile-active {
                display: flex !important;
            }

            .column-header {
                display: none;
            }

            .header {
                padding: 0.75rem 1rem;
            }

            .logo {
                font-size: 0.9rem;
            }

            .time-display {
                display: none;
            }
        }
        
        /* Mobile landscape mode - keep tabs visible */
        @media (max-width: 900px) and (orientation: landscape) {
            /* Boost base font size for landscape */
            html {
                font-size: clamp(14px, 2.5vw, 20px) !important;
            }
            
            .mobile-tabs {
                display: flex !important;
                padding: 0.3rem;
                gap: 0.2rem;
            }
            
            /* Hide row toggle buttons in landscape - only show 6 tabs */
            .accordion-toggle-row {
                display: none !important;
            }
            
            .mobile-tab {
                padding: 0.4rem 0.3rem;
                font-size: 12px !important;
            }
            
            /* AGGRESSIVE font sizes for landscape reading - use px not rem */
            .card-headline {
                font-size: 15px !important;
                line-height: 1.4 !important;
            }
            
            .card-source {
                font-size: 12px !important;
            }
            
            .card-timestamp {
                font-size: 11px !important;
            }
            
            .card-implications {
                font-size: 13px !important;
                line-height: 1.4 !important;
            }
            
            .news-tags {
                font-size: 10px !important;
            }
            
            /* Dashboard/sentiment cards - LARGE for readability */
            .dashboard-card {
                padding: 10px !important;
            }
            
            .dashboard-title {
                font-size: 14px !important;
                font-weight: 700 !important;
            }
            
            .sentiment-label {
                font-size: 12px !important;
            }
            
            .sentiment-value {
                font-size: 18px !important;
                font-weight: 700 !important;
            }
            
            .sentiment-sub {
                font-size: 11px !important;
            }
            
            .polymarket-category {
                font-size: 10px !important;
            }
            
            .polymarket-prob {
                font-size: 18px !important;
                font-weight: 700 !important;
            }
            
            .polymarket-question {
                font-size: 13px !important;
                line-height: 1.3 !important;
            }
            
            /* Key levels dashboard */
            .key-level-item {
                font-size: 13px !important;
            }
            
            .key-level-value {
                font-size: 16px !important;
                font-weight: 600 !important;
            }
            
            /* Sentiment dashboard grid */
            .sentiment-item {
                padding: 8px !important;
            }
            
            /* Collapsible header in landscape */
            .header {
                padding: 0.25rem 0.5rem;
                transition: transform 0.3s ease, opacity 0.3s ease;
            }
            
            .header.header-hidden {
                transform: translateY(-100%);
                opacity: 0;
                pointer-events: none;
            }
            
            .header .title {
                font-size: 14px !important;
            }
            
            /* Compact super ticker in landscape */
            .super-ticker-wrapper {
                padding: 0.15rem 0;
                transition: transform 0.3s ease, opacity 0.3s ease;
            }
            
            .super-ticker-wrapper.ticker-hidden {
                transform: translateY(-100%);
                height: 0;
                padding: 0;
                opacity: 0;
                overflow: hidden;
            }
            
            .super-ticker-item {
                font-size: 10px !important;
                padding: 0 0.4rem;
            }
            
            .main-grid {
                grid-template-columns: 1fr;
            }

            .column {
                display: none;
                max-height: calc(100vh - 80px);
                overflow-y: auto;
            }

            .column.mobile-active {
                display: flex;
            }

            .column-header {
                display: none;
            }
            
            .header {
                padding: 0.5rem 1rem;
            }
            
            .logo {
                font-size: 14px !important;
            }
            
            .time-display {
                display: none;
            }
            
            /* Global clock centered on mobile */
            .global-clock-container {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-width: auto;
            }
            
            .global-clock-city {
                font-size: 0.55rem;
                letter-spacing: 1.5px;
            }
            
            .global-clock-time {
                font-size: 0.75rem;
            }
            
            .info-button {
                padding: 0.35rem 0.6rem;
                font-size: 11px !important;
            }
        }

        @media (max-width: 900px) and (min-width: 769px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Clickable Headlines */
        .card-headline {
            text-decoration: none;
            display: block;
        }
        
        a.card-headline {
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        a.card-headline:hover {
            color: var(--accent-orange);
        }

        /* Deep Analysis Button - Full width, centered like Game Theory Legend */
        .deep-analysis-btn {
            cursor: pointer;
            background: linear-gradient(135deg, rgba(32, 178, 170, 0.15), rgba(32, 178, 170, 0.05));
            border: 1px solid rgba(32, 178, 170, 0.4);
            border-radius: 4px;
            padding: 6px 10px;
            margin-top: 8px;
            transition: all 0.2s ease;
            animation: borderPulse 3s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
            box-sizing: border-box;
        }
        
        @keyframes borderPulse {
            0%, 100% {
                border-color: rgba(32, 178, 170, 0.4);
                box-shadow: 0 0 3px rgba(32, 178, 170, 0.15);
            }
            50% {
                border-color: rgba(0, 217, 255, 0.5);
                box-shadow: 0 0 6px rgba(0, 217, 255, 0.25);
            }
        }
        
        .deep-analysis-btn:hover {
            background: linear-gradient(135deg, rgba(32, 178, 170, 0.3), rgba(32, 178, 170, 0.15));
            box-shadow: 0 0 8px rgba(32, 178, 170, 0.3);
            transform: translateY(-1px);
        }
        
        .analysis-text {
            color: #20b2aa;
            font-weight: 700;
            font-size: 0.65rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* Game Theory Legend Button - Purple/Violet */
        .game-legend-btn {
            cursor: pointer;
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.15), rgba(139, 92, 246, 0.05));
            border: 1px solid;
            border-image: linear-gradient(90deg, #9333ea, #a855f7, #9333ea) 1;
            border-radius: 4px;
            padding: 6px 10px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
            animation: purplePulse 3s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        @keyframes purplePulse {
            0%, 100% {
                border-image: linear-gradient(90deg, #9333ea, #a855f7, #9333ea) 1;
                box-shadow: 0 0 3px rgba(147, 51, 234, 0.15);
            }
            50% {
                border-image: linear-gradient(90deg, #a855f7, #9333ea, #a855f7) 1;
                box-shadow: 0 0 6px rgba(168, 85, 247, 0.25);
            }
        }
        
        .game-legend-btn:hover {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.3), rgba(139, 92, 246, 0.15));
            box-shadow: 0 0 8px rgba(147, 51, 234, 0.3);
            transform: translateY(-1px);
        }
        
        .game-legend-text {
            color: #a855f7;
            font-weight: 700;
            font-size: 0.65rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* Dashboard Section Subtitles */
        .dashboard-subtitle {
            font-size: 0.6rem;
            color: #6a7585;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: -2px;
            margin-bottom: 8px;
        }

        /* AI Analysis Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 20, 0.95);
            z-index: 2000;
            overflow-y: auto;
            backdrop-filter: blur(8px);
        }

        .modal-overlay.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 2rem;
        }

        @media (max-width: 768px) {
            .modal-overlay.active {
                padding: 1rem;
            }
            
            .modal-content {
                max-height: 95vh;
            }
            
            .modal-header {
                padding: 1rem;
            }
            
            .modal-body {
                padding: 1rem;
            }
        }

        .modal-content {
            background: var(--bg-card);
            border: 2px solid var(--accent-orange);
            border-radius: 8px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(212, 113, 74, 0.2);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 10;
        }

        .modal-title {
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 0.8rem;
            color: var(--accent-orange);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .modal-headline {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .modal-close {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            width: 36px;
            height: 36px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
            margin-left: 1rem;
        }

        .modal-close:hover {
            border-color: var(--accent-red);
            color: var(--accent-red);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            gap: 1rem;
        }

        .modal-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .modal-loading-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .thinking-status {
            margin-top: 1.5rem;
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 0.7rem;
            color: #00ff00;
            line-height: 1.6;
            opacity: 0.8;
        }

        .thinking-status::before {
            content: '> ';
            color: #00ff00;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        .modal-analysis {
            font-size: 0.85rem;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .modal-analysis h1, .modal-analysis h2, .modal-analysis h3 {
            color: var(--accent-orange);
            font-family: 'IBM Plex Sans', sans-serif;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-analysis h1:first-child, .modal-analysis h2:first-child {
            margin-top: 0;
        }

        .modal-analysis ul, .modal-analysis ol {
            margin-left: 0;
            margin-bottom: 0.75rem;
            padding-left: 1.5rem;
            list-style-position: outside;
        }

        .modal-analysis li {
            margin-bottom: 0.35rem;
            padding-left: 0.3rem;
            line-height: 1.5;
        }
        
        .modal-analysis ul li {
            list-style-type: disc;
        }
        
        .modal-analysis ol li {
            list-style-type: decimal;
        }

        .modal-analysis strong {
            color: var(--text-primary);
        }
        
        /* Section headers - IMPACT, TRADE, etc. */
        .analysis-section-header {
            display: block;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-orange);
            margin-top: 1.5rem;
            margin-bottom: 0.6rem;
            margin-left: 0;
            padding-left: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'IBM Plex Sans', sans-serif;
        }
        
        .analysis-section-header:first-of-type {
            margin-top: 0;
        }
        
        /* Asset and price highlights */
        .asset-highlight {
            color: #ffffff;
            font-weight: 600;
        }

        .modal-analysis p {
            margin-bottom: 1rem;
        }

        .modal-error {
            color: var(--accent-red);
            text-align: center;
            padding: 2rem;
        }

        .modal-source {
            font-size: 0.75rem;
            color: var(--text-dim);
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            background: rgba(42, 48, 64, 0.3);
        }

        .modal-source-label {
            color: var(--accent-blue);
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">THE DAILY NUTHATCH // NEWSDESK</div>
        <div class="connection-status">
            <span class="connect-text" id="statusText">CONNECTED</span>
        </div>
        <div class="global-clock-container">
            <div class="global-clock-city clock-visible" id="clockCity">ZULU</div>
            <div class="global-clock-time clock-visible" id="clockTime">--:--:--</div>
        </div>
        <button class="info-button" onclick="openInfoModal()">INFO</button>
    </div>

    <!-- Dual Ticker System -->
    <div class="ticker-container">
        <!-- News Ticker (Top) -->
        <div class="news-ticker">
            <div class="news-ticker-content" id="newsTickerContent">
            </div>
        </div>
        
        <!-- Market Ticker (Bottom) -->
        <div class="market-ticker" id="marketTicker">
            <div class="market-ticker-content" id="marketTickerContent">
            </div>
            <div class="ticker-search-popup" id="tickerSearchPopup">
                <label>Looking for another symbol?</label>
                <input type="text" id="symbolSearchInput" placeholder="Enter symbol (e.g., AAPL, TSLA, BTC)" />
                <button onclick="searchSymbol()">Open TradingView Chart</button>
            </div>
        </div>
    </div>

    <!-- Mobile Tab Navigation (hidden on desktop) -->
    <div class="mobile-tabs" id="mobileTabs">
        <button class="mobile-tab active" data-column="breaking">WIRE</button>
        <button class="mobile-tab" data-column="macro">RISK</button>
        <button class="mobile-tab" data-column="geo">GEO</button>
        <button class="mobile-tab" data-column="commodity">COMMOD</button>
        <button class="mobile-tab" data-column="fx">FX</button>
        <button class="mobile-tab" data-column="prediction">PRED</button>
    </div>

    <!-- Accordion Toggle Row (for medium screens 768-1199px) -->
    <div class="accordion-toggle-row" id="accordionToggle">
        <button class="accordion-toggle-btn active" data-row="1">ROW 1: WIRE / RISK / GEO</button>
        <button class="accordion-toggle-btn" data-row="2">ROW 2: COMMOD / FX / PRED</button>
    </div>

    <!-- Main Grid - 6 Columns -->
    <div class="main-grid">
        <div class="column col-breaking accordion-expanded" data-accordion-row="1">
            <div class="column-header">
                <div class="column-title">THE WIRE <span class="refresh-btn" onclick="manualRefresh()" title="Refresh now">â†»</span></div>
                <div class="column-subtitle">Signal â€¢ Velocity â€¢ Filter</div>
            </div>
            <div class="column-content" id="breakingColumn"></div>
        </div>

        <div class="column col-macro accordion-expanded" data-accordion-row="1">
            <div class="column-header">
                <div class="column-title">SYSTEMIC RISK</div>
                <div class="column-subtitle">Collateral â€¢ Plumbing</div>
            </div>
            <div class="column-content" id="macroColumn"></div>
        </div>

        <div class="column col-geo accordion-expanded" data-accordion-row="1">
            <div class="column-header">
                <div class="column-title">GEOPOLITICS</div>
                <div class="column-subtitle">Friction â€¢ Alliances</div>
            </div>
            <div class="column-content" id="geoColumn">
                <!-- Unified STATECRAFT Section -->
                <div class="game-theory-dashboard-container" id="statecraftDashboard">
                    <div class="dashboard-title" style="color: #a855f7;">STATECRAFT</div>
                    <div class="dashboard-section-subtitle">Strategic Intel â€¢ Active Games</div>
                    
                    <!-- Intel Legend Button (full width) -->
                    <div class="statecraft-legend-btn" onclick="openIntelLegend()">
                        <span class="legend-text">INTEL LEGEND</span>
                    </div>
                    
                    <!-- Strategic Intelligence Widgets (Top) -->
                    <div class="statecraft-section-label">SIGNALS â€¢ RISK METRICS</div>
                    <div class="strategic-intel-grid">
                        <div class="intel-widget" id="widget-rev-risk" onclick="openIntelDetailModal('revRiskModal')">
                            <div class="intel-widget-header">REVOLUTION RISK</div>
                            <div class="intel-widget-value" id="val-rev-risk">CALCULATING</div>
                            <div class="intel-widget-sub">Bread + Fuel x DXY</div>
                            <div class="intel-meter"><div class="intel-meter-fill" id="meter-rev"></div></div>
                        </div>
                        <div class="intel-widget" id="widget-liar" onclick="openIntelDetailModal('liarModal')">
                            <div class="intel-widget-header">LIAR'S POKER</div>
                            <div class="intel-widget-value" id="val-liar">CALCULATING</div>
                            <div class="intel-widget-sub">Narrative vs Money</div>
                        </div>
                        <div class="intel-widget" id="widget-war-eco" onclick="openIntelDetailModal('paperRockModal')">
                            <div class="intel-widget-header">PAPER VS ROCK</div>
                            <div class="intel-widget-value" id="val-war-eco">CALCULATING</div>
                            <div class="intel-widget-sub">Stocks / Commodities</div>
                        </div>
                        <div class="intel-widget" id="widget-vassal" onclick="openIntelDetailModal('vassalModal')">
                            <div class="intel-widget-header">VASSAL DETECTOR</div>
                            <div class="intel-widget-value" id="val-vassal">CALCULATING</div>
                            <div class="intel-widget-sub">KRW Correlation</div>
                        </div>
                    </div>
                    <div class="intel-fragmentation" id="widget-frag" onclick="openIntelDetailModal('mercantilismModal')">
                        <span class="intel-frag-label">MERCANTILISM:</span>
                        <span class="intel-frag-value" id="val-frag">OPEN TRADE</span>
                        <span class="intel-frag-hits" id="val-frag-hits">(0 signals)</span>
                    </div>
                    <div style="display:flex;align-items:center;gap:6px;margin-top:8px;font-size:9px;color:#6a7585;">
                        <span>ðŸŽ¯</span>
                        <span>Click "Revolution Risk" for deep-dive details</span>
                    </div>
                    
                    <!-- Section Divider -->
                    <div style="border-top: 1px solid rgba(168, 85, 247, 0.25); margin: 12px 0;"></div>
                    
                    <!-- Games Legend Button (full width) -->
                    <div class="statecraft-legend-btn" onclick="openGameLegend()">
                        <span class="legend-text">GAMES LEGEND</span>
                    </div>
                    
                    <!-- Game Theory Section (Below) -->
                    <div class="statecraft-section-label">GAME THEORY â€¢ CONFLICTS</div>
                    <div id="gameTheoryList" class="game-theory-container">
                        <div class="game-theory-loading">Loading strategic games...</div>
                    </div>
                </div>
                <!-- Geo cards appear below -->
            </div>
        </div>

        <div class="column col-commodity accordion-collapsed" data-accordion-row="2">
            <div class="column-header">
                <div class="column-title">COMMODITIES</div>
                <div class="column-subtitle">Energy â€¢ Inputs â€¢ Metals</div>
            </div>
            <div class="column-content" id="commodityColumn">
                <!-- Commodities Dashboard Pinned at Top - 32 COMMODITIES -->
                <div class="commodity-dashboard-container" id="commodityDashboard">
                    <div class="commodity-dashboard-title">SCARCITY GAUGE</div>
                    <div class="commodity-grid-3col">
                        <!-- Column 1: METALS (8) -->
                        <div class="commodity-grid-column">
                            <div class="commodity-column-title">METALS</div>
                            <div class="commodity-column-subtitle">Base & Precious</div>
                            <div id="commodityMetals"></div>
                        </div>
                        <!-- Column 2: ENERGY (8) -->
                        <div class="commodity-grid-column">
                            <div class="commodity-column-title">ENERGY</div>
                            <div class="commodity-column-subtitle">Flow & Storage</div>
                            <div id="commodityEnergy"></div>
                        </div>
                        <!-- Column 3: AGRICULTURE (16) -->
                        <div class="commodity-grid-column">
                            <div class="commodity-column-title">AGRICULTURE</div>
                            <div class="commodity-column-subtitle">Grains, Calories & Proteins</div>
                            <div id="commodityAgriculture"></div>
                        </div>
                    </div>
                    <div style="display:flex;align-items:center;gap:6px;margin-top:8px;padding:4px 8px;font-size:9px;color:#6a7585;border-top:1px solid rgba(255,255,255,0.05);">
                        <span>ðŸ“ˆ</span>
                        <span>Click for TradingView chart (e.g. Silver)</span>
                    </div>
                </div>
                <!-- Commodity news cards appear below -->
            </div>
        </div>

        <div class="column col-fx accordion-collapsed" data-accordion-row="2">
            <div class="column-header">
                <div class="column-title">SOVEREIGN FX</div>
                <div class="column-subtitle">Flows â€¢ Devaluation</div>
            </div>
            <div class="column-content" id="fxColumn">
                <!-- FX Pairs Dashboard Pinned at Top - 30 PAIRS -->
                <div class="fx-dashboard-container" id="fxDashboard">
                    <div class="fx-dashboard-title">VALUE DASHBOARD</div>
                    <div class="fx-grid-3col">
                        <!-- Column 1: RESERVES (10 pairs) -->
                        <div class="fx-grid-column">
                            <div class="fx-column-title">RESERVES</div>
                            <div class="fx-column-subtitle">Core â€¢ Liquidity</div>
                            <div id="fxMacro"></div>
                        </div>
                        <!-- Column 2: FRICTION ZONES (10 pairs) -->
                        <div class="fx-grid-column">
                            <div class="fx-column-title">FRICTION ZONES</div>
                            <div class="fx-column-subtitle">Conflict Proxies</div>
                            <div id="fxGeo"></div>
                        </div>
                        <!-- Column 3: RESOURCE BLOC (10 pairs) -->
                        <div class="fx-grid-column">
                            <div class="fx-column-title">RESOURCE BLOC</div>
                            <div class="fx-column-subtitle">Commodity Currencies</div>
                            <div id="fxCommodity"></div>
                        </div>
                    </div>
                    <div style="display:flex;align-items:center;gap:6px;margin-top:8px;padding:4px 8px;font-size:9px;color:#6a7585;border-top:1px solid rgba(255,255,255,0.05);">
                        <span>ðŸ“ˆ</span>
                        <span>Click pair for TradingView chart (e.g. EUR/USD)</span>
                    </div>
                </div>
                <!-- FX news cards appear below -->
            </div>
        </div>

        <div class="column col-prediction accordion-collapsed" data-accordion-row="2">
            <div class="column-header">
                <div class="column-title">PREDICTIONS</div>
                <div class="column-subtitle">Probabilities â€¢ Tail Risk</div>
            </div>
            <div class="column-content" id="predictionColumn">
                <!-- Sentiment Dashboard -->
                <div class="prediction-dashboard" id="predictionsDashboard">
                    <div class="dashboard-section">
                        <div class="dashboard-title">MARKET SENTIMENT</div>
                        <div class="dashboard-section-subtitle">VIX â€¢ Fear/Greed â€¢ Yields</div>
                        <div id="sentimentDashboard">
                            <div class="sentiment-loading">Loading sentiment data...</div>
                        </div>
                        <div style="display:flex;align-items:center;gap:6px;margin-top:6px;font-size:9px;color:#6a7585;">
                            <span>ðŸ“Š</span>
                            <span>Live indicators (e.g. VIX CALM <20)</span>
                        </div>
                    </div>
                    <div class="dashboard-section">
                        <div class="dashboard-title">POLYMARKET ODDS</div>
                        <div class="dashboard-section-subtitle">Macro â€¢ Crypto â€¢ Politics â€¢ Geo</div>
                        <div id="polymarketList" class="polymarket-container">
                            <div class="polymarket-empty">Loading prediction markets...</div>
                        </div>
                        <div style="display:flex;align-items:center;gap:6px;margin-top:6px;font-size:9px;color:#6a7585;">
                            <span>ðŸŽ¯</span>
                            <span>Click for Polymarket (e.g. Fed Cut 65%)</span>
                        </div>
                    </div>
                </div>
                <!-- Prediction cards appear here -->
            </div>
        </div>
    </div>

    <!-- AI Analysis Modal -->
    <div class="modal-overlay" id="analysisModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <div class="modal-title">GEMINI AI DEEP ANALYSIS</div>
                    <div class="modal-headline" id="modalHeadline"></div>
                </div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <div class="modal-loading" id="modalLoading">
                    <div class="modal-spinner"></div>
                    <div class="modal-loading-text" id="loadingText">Analyzing with Gemini AI...<br><span style="font-size: 0.85em; opacity: 0.8;">Something great is about to happen - just a moment!</span></div>
                    <div class="thinking-status" id="thinkingStatus"></div>
                </div>
            </div>
            <div class="modal-source" id="modalSource"></div>
        </div>
    </div>

    <script>
        // ========================================================================
        // CARD DATA STORE (for AI analysis)
        // ========================================================================
        const cardDataStore = {};

        // ========================================================================
        // GLOBAL WATCHTOWER ENGINE
        // ========================================================================

        const GLOBAL_CITIES = [
            // EAST -> WEST (Following the Sun)
            { label: 'AUCKLAND', timeZone: 'Pacific/Auckland' },
            { label: 'SYDNEY', timeZone: 'Australia/Sydney' },
            { label: 'TOKYO', timeZone: 'Asia/Tokyo' },
            { label: 'HONG KONG', timeZone: 'Asia/Hong_Kong' },
            { label: 'BANGKOK', timeZone: 'Asia/Bangkok' },
            { label: 'DELHI', timeZone: 'Asia/Kolkata' },
            { label: 'TEHRAN', timeZone: 'Asia/Tehran' },
            { label: 'MOSCOW', timeZone: 'Europe/Moscow' },
            { label: 'CAIRO', timeZone: 'Africa/Cairo' },
            { label: 'CAPE TOWN', timeZone: 'Africa/Johannesburg' },
            { label: 'BERLIN', timeZone: 'Europe/Berlin' },
            { label: 'LONDON', timeZone: 'Europe/London' },
            { label: 'SAO PAULO', timeZone: 'America/Sao_Paulo' },
            { label: 'NEW YORK', timeZone: 'America/New_York' },
            { label: 'CHICAGO', timeZone: 'America/Chicago' },
            { label: 'LOS ANGELES', timeZone: 'America/Los_Angeles' },
            { label: 'HAWAII', timeZone: 'Pacific/Honolulu' }
        ];

        let cityIndex = 0;

        function initGlobalClock() {
            const cityEl = document.getElementById('clockCity');
            const timeEl = document.getElementById('clockTime');
            
            // Update time every second for current city
            setInterval(() => {
                const city = GLOBAL_CITIES[cityIndex];
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', {
                    timeZone: city.timeZone,
                    hour12: false,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                if (cityEl.classList.contains('clock-visible')) {
                    timeEl.textContent = timeString;
                }
            }, 1000);

            // City cycle loop
            function cycleCity() {
                // Fade out
                cityEl.classList.remove('clock-visible');
                timeEl.classList.remove('clock-visible');

                setTimeout(() => {
                    // Swap city
                    cityIndex = (cityIndex + 1) % GLOBAL_CITIES.length;
                    const city = GLOBAL_CITIES[cityIndex];
                    
                    cityEl.textContent = city.label;
                    
                    const now = new Date();
                    timeEl.textContent = now.toLocaleTimeString('en-US', {
                        timeZone: city.timeZone,
                        hour12: false, 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        second: '2-digit'
                    });

                    // Fade in
                    cityEl.classList.add('clock-visible');
                    timeEl.classList.add('clock-visible');

                    setTimeout(cycleCity, 3500);
                    
                }, 1500);
            }

            // Start first cycle
            const city = GLOBAL_CITIES[cityIndex];
            cityEl.textContent = city.label;
            const now = new Date();
            timeEl.textContent = now.toLocaleTimeString('en-US', {
                timeZone: city.timeZone,
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            setTimeout(cycleCity, 3500);
        }

        document.addEventListener('DOMContentLoaded', initGlobalClock);

        // ========================================================================
        // CENTRAL BANK MEETING DATE AUTO-UPDATER
        // ========================================================================
        
        const CENTRAL_BANK_MEETINGS = {
            Fed: ['2026-01-29', '2026-03-18', '2026-04-29', '2026-06-17', '2026-07-29', '2026-09-16', '2026-10-28', '2026-12-09'],
            ECB: ['2026-01-22', '2026-01-30', '2026-03-12', '2026-04-16', '2026-06-04', '2026-07-23', '2026-09-10', '2026-10-29', '2026-12-17'],
            BOE: ['2026-02-05', '2026-02-06', '2026-03-19', '2026-04-30', '2026-06-18', '2026-07-30', '2026-09-17', '2026-11-05', '2026-12-17'],
            BOJ: ['2026-01-23', '2026-03-19', '2026-04-28', '2026-06-16', '2026-07-31', '2026-09-18', '2026-10-30', '2026-12-18'],
            RBA: ['2026-02-03', '2026-04-01', '2026-05-20', '2026-07-08', '2026-08-19', '2026-10-07', '2026-11-25', '2026-12-09']
        };

        function getNextMeetingDate(bank) {
            const now = new Date();
            const meetings = CENTRAL_BANK_MEETINGS[bank] || [];
            for (const date of meetings) {
                const meetingDate = new Date(date);
                if (meetingDate >= now) {
                    const month = meetingDate.toLocaleString('en-US', { month: 'short' });
                    const day = meetingDate.getDate();
                    return `${month} ${day}`;
                }
            }
            return 'TBD';
        }

        function updateCentralBankDates() {
            const bankMapping = {
                'fed': 'Fed',
                'ecb': 'ECB',
                'boe': 'BOE',
                'boj': 'BOJ',
                'rba': 'RBA'
            };
            
            Object.entries(bankMapping).forEach(([domId, bankKey]) => {
                const element = document.getElementById(`${domId}-next`);
                if (element) {
                    const nextDate = getNextMeetingDate(bankKey);
                    element.textContent = `â†’ ${nextDate}`;
                }
            });
        }

        updateCentralBankDates();
        setInterval(updateCentralBankDates, 3600000);

        // ========================================================================
        // MOBILE TAB NAVIGATION
        // ========================================================================
        
        const columnMap = {
            'breaking': '.col-breaking',
            'macro': '.col-macro',
            'geo': '.col-geo',
            'commodity': '.col-commodity',
            'fx': '.col-fx',
            'prediction': '.col-prediction'
        };

        function initMobileTabs() {
            const tabs = document.querySelectorAll('.mobile-tab');
            const columns = document.querySelectorAll('.column');
            
            // Set initial active column (Breaking)
            document.querySelector('.col-breaking').classList.add('mobile-active');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const columnKey = this.dataset.column;
                    
                    // Update tab states
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update column visibility
                    columns.forEach(c => c.classList.remove('mobile-active'));
                    document.querySelector(columnMap[columnKey]).classList.add('mobile-active');
                    
                    // Scroll to top of content
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            });
        }

        // Initialize accordion toggle for medium screens
        function initAccordionToggle() {
            const toggleBtns = document.querySelectorAll('.accordion-toggle-btn');
            const columns = document.querySelectorAll('.column');
            
            toggleBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetRow = this.dataset.row;
                    
                    // Update button states
                    toggleBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update column visibility for accordion mode
                    columns.forEach(col => {
                        const colRow = col.dataset.accordionRow;
                        if (colRow === targetRow) {
                            col.classList.remove('accordion-collapsed');
                            col.classList.add('accordion-expanded');
                        } else {
                            col.classList.remove('accordion-expanded');
                            col.classList.add('accordion-collapsed');
                        }
                    });
                });
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initMobileTabs();
            initAccordionToggle();
            initLandscapeScrollHide();
        });
        
        // Landscape scroll-to-hide header
        function initLandscapeScrollHide() {
            let lastScrollY = 0;
            const header = document.querySelector('.header');
            const ticker = document.querySelector('.super-ticker-wrapper');
            
            function isLandscapeMobile() {
                return window.innerWidth <= 900 && window.innerHeight < window.innerWidth;
            }
            
            // Listen for scroll on active column
            document.addEventListener('scroll', handleScroll, true);
            
            function handleScroll(e) {
                if (!isLandscapeMobile()) {
                    // Reset visibility when not in landscape mobile
                    if (header) header.classList.remove('header-hidden');
                    if (ticker) ticker.classList.remove('ticker-hidden');
                    return;
                }
                
                const target = e.target;
                if (!target.classList || !target.classList.contains('column-content')) return;
                
                const currentScrollY = target.scrollTop;
                
                if (currentScrollY > lastScrollY && currentScrollY > 50) {
                    // Scrolling down - hide header
                    if (header) header.classList.add('header-hidden');
                    if (ticker) ticker.classList.add('ticker-hidden');
                } else if (currentScrollY < lastScrollY) {
                    // Scrolling up - show header
                    if (header) header.classList.remove('header-hidden');
                    if (ticker) ticker.classList.remove('ticker-hidden');
                }
                
                lastScrollY = currentScrollY;
            }
        }

        // ========================================================================
        // DUAL TICKER SYSTEM
        // ========================================================================
        
        let newsTickerItems = [];
        let marketTickerData = [];
        const seenTickerHeadlines = new Set();

        // HTML Sanitization - Prevent XSS attacks
        function sanitizeHTML(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // URL Sanitization - Block javascript: protocol
        function sanitizeURL(url) {
            if (!url) return '#';
            const urlStr = String(url).toLowerCase().trim();
            if (urlStr.startsWith('javascript:') || urlStr.startsWith('data:') || urlStr.startsWith('vbscript:')) {
                return '#';
            }
            return url;
        }

        // Convert ALL CAPS text to Title Case
        function toTitleCase(str) {
            if (!str) return str;
            // Check if string is mostly uppercase (>70% caps)
            const upperCount = (str.match(/[A-Z]/g) || []).length;
            const letterCount = (str.match(/[A-Za-z]/g) || []).length;
            if (letterCount > 0 && upperCount / letterCount > 0.7) {
                // Convert to title case - lowercase everything then capitalize first letter of each word
                return str.toLowerCase().replace(/(?:^|\s|[-"'(])\w/g, match => match.toUpperCase());
            }
            return str;
        }

        // TOP BADGE TRIGGER WORDS - Must match at least one
        const TOP_TRIGGERS = [
            // Tier 1 - Immediate Alerts
            /\bBREAKING\b/i, /\bFLASH\b/i, /\bURGENT\b/i, /\bALERT\b/i, /\bJUST IN\b/i, 
            /\bDEVELOPING\b/i, /\bBULLETIN\b/i, /\bNEWSWIRE\b/i,
            // Tier 2 - Major Event Verbs
            /\bEXPLODES?\b/i, /\bERUPTS?\b/i, /\bATTACK(?:ED|S)?\b/i, /\bINVASION\b/i, 
            /\bCOUP\b/i, /\bMOBILIZES?\b/i, /\bASSASSINAT(?:ED|ION)\b/i, /\bKILLED\b/i,
            /\bMASS RESIGNATION\b/i, /\bOVERTHROWN\b/i, /\bSEIZED\b/i,
            // Tier 3 - Market Structure Shocks
            /\bLIMIT DOWN\b/i, /\bLIMIT UP\b/i, /\bHALTED\b/i, /\bCIRCUIT BREAKER\b/i,
            /\bPLUNGE[DS]?\b/i, /\bPLUMMET[S]?\b/i, /\bSURGE[DS]?\b/i, /\bSOAR[S]?\b/i,
            /\bSPIKE[DS]?\b/i, /\bCOLLAPSE[DS]?\b/i, /\bFREEFALL\b/i, /\bCRASH(?:ES|ED)?\b/i, 
            /\bTUMBLE[DS]?\b/i,
            // Tier 4 - Central Bank / Credit Actions
            /\bEMERGENCY MEETING\b/i, /\bEMERGENCY CUT\b/i, /\bINTERVEN(?:TION|ES)\b/i,
            /\bQE\b/i, /\bLIQUIDITY INJECTION\b/i, /\bBAILOUT\b/i, /\bRATE HIKE\b/i, 
            /\bRATE CUT\b/i, /\bSTABILIZATION FUND\b/i,
            // Tier 5 - Corporate Bombshells
            /\bBANKRUPTCY\b/i, /\bDEFAULT[S]?\b/i, /\bCHAPTER 11\b/i, /\bLIQUIDATION\b/i,
            /\bCEO OUSTED\b/i, /\bFIRES CEO\b/i, /\bRESTATEMENT\b/i, /\bSEC PROBE\b/i,
            /\bSEC CHARGES\b/i, /\bDOJ CHARGES\b/i, /\bFRAUD\b/i, /\bTRADING HALTED\b/i, 
            /\bDELISTED\b/i,
            // Tier 6 - Geopolitical Escalation
            /\bMISSILE[S]?\b/i, /\bAIRSTRIKE[S]?\b/i, /\bMARTIAL LAW\b/i, 
            /\bSTATE OF EMERGENCY\b/i, /\bTERROR(?:IST|ISM)?\b/i, /\bHOSTILITIES\b/i,
            /\bBORDER CLOSED\b/i, /\bEVACUATION ORDER\b/i, /\bNUCLEAR\b/i,
            /\bSANCTIONS?\b/i, /\bEMBARGO\b/i, /\bBLOCKADE\b/i
        ];
        
        // EXCLUSION PATTERNS - If any match, no TOP badge
        const TOP_EXCLUSIONS = [
            // Future/Speculative Language
            /\bset to\b/i, /\bexpected to\b/i, /\bforecast\b/i, /\bprojection\b/i, 
            /\boutlook\b/i, /\blooking ahead\b/i,
            // Soft Probability
            /\bmay\b/i, /\bcould\b/i, /\bmight\b/i, /\blikely to\b/i, 
            /\bpossibly\b/i, /\bpotentially\b/i,
            // Attribution Hedges
            /\baccording to\b/i, /\breport says\b/i, /\bsources say\b/i, 
            /\bpeople familiar\b/i, /\banalysts say\b/i,
            // Long-Horizon Markers
            /\bby 202[5-9]\b/i, /\bin 202[5-9]\b/i, /\bover the next decade\b/i,
            // Routine Corporate
            /\bguidance\b/i, /\bcapex\b/i, /\bearnings call\b/i, 
            /\binvestor presentation\b/i, /\bannual report\b/i,
            // Opinion/Analysis
            /\banalysis\b/i, /\bop-ed\b/i, /\bcommentary\b/i, /\breview\b/i, 
            /\bperspective\b/i, /\bopinion\b/i
        ];
        
        function isTopStoryHeadline(headline, impact) {
            // Must have impact 3
            if (impact < 3) return false;
            
            // Must match at least one trigger
            const hasTrigger = TOP_TRIGGERS.some(regex => regex.test(headline));
            if (!hasTrigger) return false;
            
            // Must NOT match any exclusion
            const hasExclusion = TOP_EXCLUSIONS.some(regex => regex.test(headline));
            if (hasExclusion) return false;
            
            return true;
        }

        function addToNewsTicker(headline, impact, assets, link) {
            // Deduplicate - normalize headline for comparison
            const normalizedHeadline = headline.toLowerCase().trim().substring(0, 60);
            if (seenTickerHeadlines.has(normalizedHeadline)) {
                return; // Skip duplicate
            }
            seenTickerHeadlines.add(normalizedHeadline);
            
            // Limit seen headlines cache
            if (seenTickerHeadlines.size > 100) {
                const firstItem = seenTickerHeadlines.values().next().value;
                seenTickerHeadlines.delete(firstItem);
            }
            
            const time = new Date().toISOString().substr(11, 5);
            
            // Detect top stories - strict criteria
            const isTopStory = isTopStoryHeadline(headline, impact);
            
            newsTickerItems.unshift({
                time: time,
                text: headline.substring(0, 100),
                impact: impact,
                assets: assets,
                link: link || '',
                isTopStory: isTopStory
            });
            
            if (newsTickerItems.length > 20) {
                newsTickerItems = newsTickerItems.slice(0, 20);
            }
            
            updateNewsTicker();
        }

        function updateNewsTicker() {
            const ticker = document.getElementById('newsTickerContent');
            const doubled = [...newsTickerItems, ...newsTickerItems];

            ticker.innerHTML = doubled.map(item => {
                const topStoryBadge = item.isTopStory ? '<span class="top-story-badge">TOP</span>' : '';
                const topStoryClass = item.isTopStory ? 'top-story' : '';
                const displayText = sanitizeHTML(toTitleCase(item.text));
                const safeLink = sanitizeURL(item.link);
                const tickerContent = `
                    <span class="ticker-time">${sanitizeHTML(item.time)} UTC</span>
                    ${topStoryBadge}
                    <span class="ticker-text ${topStoryClass}">${displayText}</span>
                    <div class="ticker-impact">
                        ${Array(3).fill(0).map((_, i) =>
                            `<div class="impact-dot ${i < item.impact ? 'active' : ''}"></div>`
                        ).join('')}
                    </div>
                `;
                return item.link
                    ? `<a href="${safeLink}" target="_blank" rel="noopener noreferrer" class="ticker-item ${topStoryClass}" style="text-decoration: none; color: inherit;">${tickerContent}</a>`
                    : `<div class="ticker-item ${topStoryClass}">${tickerContent}</div>`;
            }).join('');
        }

        let fxDataStore = { macro: [], geo: [], commodity: [] };

        function updateMarketTicker(marketData) {
            marketTickerData = marketData;
            updateSuperTicker();
        }

        function updateSuperTicker() {
            const ticker = document.getElementById('marketTickerContent');
            if (!ticker) return;

            let allItems = [];
            
            if (marketTickerData && marketTickerData.length > 0) {
                allItems = allItems.concat(marketTickerData.map(item => ({
                    label: item.label,
                    value: item.value,
                    change: item.change,
                    dir: item.dir,
                    tvSymbol: item.symbol || item.label,
                    type: 'market'
                })));
            }
            
            if (fxDataStore.macro) {
                allItems = allItems.concat(fxDataStore.macro.map(item => ({
                    label: item.label,
                    value: item.price,
                    change: item.change + '%',
                    dir: item.dir,
                    tvSymbol: item.tvSymbol || item.label,
                    type: 'fx'
                })));
            }
            if (fxDataStore.geo) {
                allItems = allItems.concat(fxDataStore.geo.map(item => ({
                    label: item.label,
                    value: item.price,
                    change: item.change + '%',
                    dir: item.dir,
                    tvSymbol: item.tvSymbol || item.label,
                    type: 'fx'
                })));
            }
            if (fxDataStore.commodity) {
                allItems = allItems.concat(fxDataStore.commodity.map(item => ({
                    label: item.label,
                    value: item.price,
                    change: item.change + '%',
                    dir: item.dir,
                    tvSymbol: item.tvSymbol || item.label,
                    type: 'fx'
                })));
            }
            
            const allCommodities = [
                ...(commodityDataStore.metals || []),
                ...(commodityDataStore.energy || []),
                ...(commodityDataStore.agriculture || [])
            ];
            allItems = allItems.concat(allCommodities.map(item => ({
                label: item.label,
                value: item.price,
                change: item.change + '%',
                dir: item.dir,
                tvSymbol: item.tvSymbol || item.ticker || item.label,
                type: 'commodity'
            })));

            const doubled = [...allItems, ...allItems];

            ticker.innerHTML = doubled.map(item => `
                <div class="market-ticker-item" onclick="openChart('${sanitizeHTML(item.tvSymbol)}')" style="cursor: pointer;">
                    <span class="market-ticker-label">${sanitizeHTML(item.label)}</span>
                    <span class="market-ticker-value">${sanitizeHTML(item.value)}</span>
                    <span class="market-ticker-change ${getMarketTickerClass(item.dir)}">
                        ${sanitizeHTML(item.change)}
                    </span>
                </div>
            `).join('');
        }

        function getMarketTickerClass(dir) {
            return dir === 'up' ? 'market-ticker-up' : 
                   dir === 'down' ? 'market-ticker-down' : 
                   'market-ticker-neutral';
        }

        // ========================================================================
        // TICKER MOUSE/TOUCH SCROLL
        // ========================================================================
        
        function initTickerScroll() {
            const ticker = document.getElementById('marketTicker');
            const tickerContent = document.getElementById('marketTickerContent');
            if (!ticker || !tickerContent) return;
            
            let isDown = false;
            let startX;
            let scrollLeft;
            
            ticker.addEventListener('mousedown', (e) => {
                isDown = true;
                tickerContent.classList.add('dragging');
                startX = e.pageX - ticker.offsetLeft;
                scrollLeft = ticker.scrollLeft;
            });
            
            ticker.addEventListener('mouseleave', () => {
                if (isDown) {
                    isDown = false;
                    tickerContent.classList.remove('dragging');
                }
            });
            
            ticker.addEventListener('mouseup', () => {
                isDown = false;
                tickerContent.classList.remove('dragging');
            });
            
            ticker.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - ticker.offsetLeft;
                const walk = (x - startX) * 3;
                ticker.scrollLeft = scrollLeft - walk;
            });
            
            ticker.addEventListener('touchstart', (e) => {
                isDown = true;
                tickerContent.classList.add('dragging');
                startX = e.touches[0].pageX - ticker.offsetLeft;
                scrollLeft = ticker.scrollLeft;
            }, { passive: true });
            
            ticker.addEventListener('touchend', () => {
                isDown = false;
                tickerContent.classList.remove('dragging');
            });
            
            ticker.addEventListener('touchmove', (e) => {
                if (!isDown) return;
                const x = e.touches[0].pageX - ticker.offsetLeft;
                const walk = (x - startX) * 3;
                ticker.scrollLeft = scrollLeft - walk;
            }, { passive: true });
        }
        
        document.addEventListener('DOMContentLoaded', initTickerScroll);

        // ========================================================================
        // WEBSOCKET CONNECTION
        // ========================================================================
        
        let ws;
        let reconnectInterval;

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}`;
            
            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                console.log('WebSocket connected');
                document.getElementById('statusText').classList.add('connected');
                document.getElementById('statusText').textContent = 'CONNECTED';
                if (reconnectInterval) {
                    clearInterval(reconnectInterval);
                    reconnectInterval = null;
                }
            };

            ws.onmessage = (event) => {
                try {
                    const message = JSON.parse(event.data);
                    handleMessage(message);
                } catch (error) {
                    console.error('Error parsing message:', error);
                }
            };

            ws.onclose = () => {
                console.log('WebSocket disconnected');
                document.getElementById('statusText').classList.remove('connected');
                document.getElementById('statusText').textContent = 'CONNECTING';
                
                if (!reconnectInterval) {
                    reconnectInterval = setInterval(connectWebSocket, 5000);
                }
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };
        }

        connectWebSocket();

        // ========================================================================
        // MESSAGE HANDLERS
        // ========================================================================

        function handleMessage(message) {
            switch (message.type) {
                case 'initial':
                    handleInitialData(message);
                    break;
                case 'new_card':
                    handleNewCard(message);
                    break;
                case 'market_update':
                    updateMarketData(message.data);
                    break;
                case 'macro_update':
                    updateMacroData(message.data);
                    break;
                case 'fx_update':
                    updateFXData(message.data);
                    break;
                case 'commodity_update':
                    updateCommodityData(message.data);
                    break;
                case 'prediction_update':
                    updatePredictionData(message.data);
                    break;
                case 'game_theory_update':
                    updateGameTheoryData(message.data);
                    break;
                case 'strategic_intelligence':
                    updateStrategicIntelligence(message.data);
                    break;
            }
        }
        
        function updateStrategicIntelligence(data) {
            if (!data) return;
            
            // 1. REVOLUTION RISK
            const revEl = document.getElementById('val-rev-risk');
            if (revEl && data.revRisk) {
                revEl.innerText = data.revRisk.level;
                revEl.style.color = data.revRisk.color;
                document.getElementById('widget-rev-risk').style.borderColor = data.revRisk.color;
                const revPct = Math.min((parseFloat(data.revRisk.score) / 3.0) * 100, 100);
                const meterEl = document.getElementById('meter-rev');
                if (meterEl) {
                    meterEl.style.width = `${revPct}%`;
                    meterEl.style.background = data.revRisk.color;
                }
            }
            
            // 2. LIAR'S POKER
            const liarEl = document.getElementById('val-liar');
            if (liarEl && data.liarsPoker) {
                liarEl.innerText = data.liarsPoker.label;
                liarEl.style.color = data.liarsPoker.color;
                document.getElementById('widget-liar').style.borderColor = data.liarsPoker.color;
            }
            
            // 3. PAPER VS ROCK (War Economy)
            const warEl = document.getElementById('val-war-eco');
            if (warEl && data.warEco) {
                warEl.innerText = data.warEco.label;
                warEl.style.color = data.warEco.color;
                document.getElementById('widget-war-eco').style.borderColor = data.warEco.color;
            }
            
            // 4. VASSAL STATE
            const vasEl = document.getElementById('val-vassal');
            if (vasEl && data.vassalState) {
                vasEl.innerText = data.vassalState.master;
                vasEl.style.color = data.vassalState.color;
                document.getElementById('widget-vassal').style.borderColor = data.vassalState.color;
            }
            
            // 5. MERCANTILISM COUNTER
            const fragEl = document.getElementById('val-frag');
            const fragHitsEl = document.getElementById('val-frag-hits');
            if (fragEl && data.fragScore) {
                fragEl.innerText = data.fragScore.level;
                fragEl.style.color = data.fragScore.color;
                if (fragHitsEl) {
                    fragHitsEl.innerText = `(${data.fragScore.hits} signals)`;
                }
            }

            // 6. DATA QUALITY WARNING
            let warningEl = document.getElementById('intel-data-warning');
            if (!warningEl) {
                // Create warning element if it doesn't exist
                const intelSection = document.querySelector('.strategic-intel-grid');
                if (intelSection && intelSection.parentNode) {
                    warningEl = document.createElement('div');
                    warningEl.id = 'intel-data-warning';
                    warningEl.style.cssText = 'margin-top:8px;padding:6px 8px;background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);border-radius:4px;font-size:0.7rem;color:#ef4444;display:none;text-align:center;';
                    intelSection.parentNode.insertBefore(warningEl, intelSection.nextSibling);
                }
            }
            if (warningEl && data.dataQuality) {
                if (data.dataQuality.usingFallbacks && data.dataQuality.warning) {
                    warningEl.textContent = 'âš ï¸ ' + data.dataQuality.warning;
                    warningEl.style.display = 'block';
                } else {
                    warningEl.style.display = 'none';
                }
            }
        }

        function handleInitialData(message) {
            if (message.market) {
                updateMarketData(message.market);
            }
            if (message.macro) {
                updateMacroData(message.macro);
            }
            if (message.fx) {
                updateFXData(message.fx);
            }
            if (message.commodities) {
                updateCommodityData(message.commodities);
            }
        }

        function handleNewCard(message) {
            const columnId = getColumnId(message.column);
            const column = document.getElementById(columnId);
            
            if (!column) return;

            const cardHtml = createCardHtml(message.data);
            
            // Insert cards AFTER pinned dashboards to keep them on top
            if (columnId === 'macroColumn') {
                const macroGrid = column.querySelector('.macro-grid-container');
                if (macroGrid) {
                    macroGrid.insertAdjacentHTML('afterend', cardHtml);
                } else {
                    column.insertAdjacentHTML('afterbegin', cardHtml);
                }
            } else if (columnId === 'commodityColumn') {
                const commodityDashboard = column.querySelector('.commodity-dashboard-container');
                if (commodityDashboard) {
                    commodityDashboard.insertAdjacentHTML('afterend', cardHtml);
                } else {
                    column.insertAdjacentHTML('afterbegin', cardHtml);
                }
            } else if (columnId === 'fxColumn') {
                const fxDashboard = column.querySelector('.fx-dashboard-container');
                const cbRates = column.querySelector('.cb-rates-container');
                const insertAfter = cbRates || fxDashboard;
                if (insertAfter) {
                    insertAfter.insertAdjacentHTML('afterend', cardHtml);
                } else {
                    column.insertAdjacentHTML('afterbegin', cardHtml);
                }
            } else if (columnId === 'predictionColumn') {
                const predDashboard = column.querySelector('#predictionsDashboard');
                if (predDashboard) {
                    predDashboard.insertAdjacentHTML('afterend', cardHtml);
                } else {
                    column.insertAdjacentHTML('afterbegin', cardHtml);
                }
            } else if (columnId === 'geoColumn') {
                const statecraftDashboard = column.querySelector('.game-theory-dashboard-container');
                if (statecraftDashboard) {
                    statecraftDashboard.insertAdjacentHTML('afterend', cardHtml);
                } else {
                    column.insertAdjacentHTML('afterbegin', cardHtml);
                }
            } else {
                column.insertAdjacentHTML('afterbegin', cardHtml);
            }

            // Only add to ticker if not excluded (opinion/analysis pieces filtered out)
            if (!message.data.excludeFromTicker) {
                addToNewsTicker(
                    message.data.headline, 
                    message.data.impact || 2,
                    formatAssets(message.data),
                    message.data.link || ''
                );
            }

            const cards = column.querySelectorAll('.card');
            if (cards.length > 12) {
                cards[cards.length - 1].remove();
            }

            column.scrollTop = 0;
        }

        function formatAssets(data) {
            if (data.probNudge && data.probNudge.length > 0) {
                return data.probNudge.map(p => 
                    `${p.label.toUpperCase()}${p.dir === 'up' ? 'â†‘' : 'â†“'}`
                ).join(' ');
            }
            return '';
        }

        function getColumnId(category) {
            const mapping = {
                'breaking': 'breakingColumn',
                'macro': 'macroColumn',
                'geo': 'geoColumn',
                'commodity': 'commodityColumn',
                'market': 'breakingColumn',
                'fx': 'fxColumn',
                'prediction': 'predictionColumn'
            };
            return mapping[category] || 'breakingColumn';
        }

        function getRiskEmoji(risk) {
            if (risk <= 30) return 'ðŸŸ¢'; // LOW
            if (risk <= 60) return 'ðŸŸ¡'; // MEDIUM
            if (risk <= 85) return 'ðŸŸ '; // HIGH
            return 'ðŸ”´'; // CRITICAL
        }

        function createCardHtml(data) {
            const impactDots = Array(3).fill(0).map((_, i) => 
                `<div class="impact-dot ${i < (data.impact || 2) ? 'active' : ''}"></div>`
            ).join('');

            const pubDateHtml = data.pubDate ? ` â€¢ ${data.pubDate}` : '';
            const sourceHtml = data.source ? 
                `<div class="card-source">ðŸ“¡ ${data.source}${data.verified ? ' âœ“' : ''}${pubDateHtml}</div>` : '';
            
            // Regime badge if detected
            const regimeHtml = data.regime ? 
                `<div class="regime-badge">ðŸ“Š ${data.regime} REGIME</div>` : '';
            
            const implicationsHtml = data.implications && data.implications.length > 0 ?
                `<ul class="card-implications">
                    ${data.implications.map(imp => `<li>${imp}</li>`).join('')}
                </ul>` : '';

            // Technical levels displayed as tripwires
            const tripwireHtml = data.tripwires && data.tripwires.length > 0 ? `
                <div class="tripwire-section">
                    <div class="tripwire-title">ðŸ“ KEY LEVELS</div>
                    ${data.tripwires.map(tw => `<div class="tripwire-item">${tw}</div>`).join('')}
                </div>
            ` : '';

            const probHtml = data.probNudge && data.probNudge.length > 0 ? `
                <div class="probability-nudge">
                    ${data.probNudge.map(p => `
                        <div class="prob-item">
                            <span>${p.label}</span>
                            <span class="prob-arrow ${p.dir === 'up' ? 'prob-up' : 'prob-down'}">
                                ${p.dir === 'up' ? 'â†‘' : 'â†“'}
                            </span>
                        </div>
                    `).join('')}
                </div>
            ` : '';

            // Next events section
            const nextEventsHtml = data.nextEvents && data.nextEvents.length > 0 ? `
                <div class="next-events">
                    <div class="next-events-title">ðŸ”” Watch Next</div>
                    ${data.nextEvents.map(event => `<div class="next-event-item">${event}</div>`).join('')}
                </div>
            ` : '';

            // Market Risk bar (backward compatible with old confidence field)
            const riskValue = data.marketRisk || data.confidence;
            const getRiskClass = (val) => {
                if (val <= 20) return 'risk-low';
                if (val <= 40) return 'risk-medium';
                if (val <= 60) return 'risk-elevated';
                if (val <= 80) return 'risk-high';
                return 'risk-critical';
            };
            const confidenceHtml = riskValue ? `
                <div class="confidence-bar">
                    <div class="confidence-label">Market Risk: ${riskValue}%</div>
                    <div class="confidence-track">
                        <div class="confidence-fill ${getRiskClass(riskValue)}" style="width: ${riskValue}%"></div>
                    </div>
                </div>
            ` : '';

            const filteredTags = data.tags ? data.tags.filter(tag => tag !== 'DEVELOPING') : [];
            
            // Build horizon tag
            const horizon = data.horizon || 'DAYS';
            const horizonClass = 'horizon-' + horizon.toLowerCase().replace(/\//g, '-');
            const horizonEmoji = {
                'NOW': 'ðŸ”´',
                'INTRADAY': 'ðŸŸ ', 
                'DAYS': 'ðŸŸ¡',
                'WEEKS': 'ðŸ”µ',
                'N/A': 'âšª'
            }[horizon] || 'ðŸŸ¡';
            const horizonTag = horizon ? `<span class="news-tag ${horizonClass}">${horizonEmoji} ${horizon}</span>` : '';
            
            const tagsHtml = (filteredTags.length > 0 || horizon) ? `
                <div class="news-tags">
                    ${horizonTag}
                    ${filteredTags.map(tag => {
                        const tagClass = tag.toLowerCase().replace(/[\s-]/g, '-');
                        const emoji = getTagEmoji(tag);
                        return `<span class="news-tag ${tagClass}">${emoji} ${tag}</span>`;
                    }).join('')}
                </div>
            ` : '';

            const cardId = 'card-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            
            cardDataStore[cardId] = {
                headline: data.headline,
                link: data.link || '',
                source: data.source || '',
                implications: data.implications || []
            };
            
            const displayHeadline = toTitleCase(data.headline);
            const headlineHtml = data.link 
                ? `<a href="${data.link}" target="_blank" rel="noopener noreferrer" class="card-headline">${displayHeadline}</a>`
                : `<div class="card-headline">${displayHeadline}</div>`;
            
            return `
                <div class="card" id="${cardId}">
                    <div class="card-timestamp">${data.time} UTC</div>
                    ${sourceHtml}
                    ${regimeHtml}
                    ${headlineHtml}
                    ${implicationsHtml}
                    <div class="card-meta">
                        <div class="meta-item deep-analysis-btn" onclick="analyzeHeadline('${cardId}')">
                            <span class="analysis-text">ðŸ§  GET DEEP AI ANALYSIS â†’</span>
                        </div>
                    </div>
                    ${tripwireHtml}
                    ${nextEventsHtml}
                    ${probHtml}
                    ${confidenceHtml}
                    ${tagsHtml}
                </div>
            `;
        }

        function getTagEmoji(tag) {
            const emojiMap = {
                'FLASH': 'âš¡',
                'SCHEDULED': 'ðŸ“…',
                'CONTEXT': 'ðŸ“Š',
                'RATES': 'ðŸ“ˆ',
                'EQUITIES': 'ðŸ“Š',
                'COMMODITIES': 'ðŸ›¢ï¸',
                'FX': 'ðŸ’±',
                'CREDIT': 'ðŸ’³',
                'MULTI-ASSET': 'ðŸŒ',
                'RISK-ON': 'ðŸŸ¢',
                'RISK-OFF': 'ðŸ”´',
                'NEUTRAL': 'âšª',
                'REFLATIONARY': 'ðŸ”¥',
                'STAGFLATIONARY': 'âš ï¸',
                'GOLDILOCKS': 'âœ¨',
                'DEFLATIONARY': 'â„ï¸'
            };
            return emojiMap[tag] || 'â€¢';
        }

        function updateMarketData(marketData) {
            updateMarketTicker(marketData);
        }

        // Central Bank Meeting Schedules - Update these after each meeting
        // Format: [month, day] pairs for the full year
        const cbMeetingSchedules = {
            fed: { 
                rate: '4.50%', 
                currency: 'USD',
                meetings2025: [[1,29],[3,19],[5,7],[6,18],[7,30],[9,17],[11,5],[12,17]],
                meetings2026: [[1,28],[3,18],[5,6],[6,17],[7,29],[9,16],[11,4],[12,16]]
            },
            ecb: { 
                rate: '2.75%', 
                currency: 'EUR',
                meetings2025: [[1,30],[3,6],[4,17],[6,5],[7,17],[9,11],[10,30],[12,18]],
                meetings2026: [[1,22],[3,5],[4,16],[6,4],[7,16],[9,10],[10,29],[12,17]]
            },
            boe: { 
                rate: '4.50%', 
                currency: 'GBP',
                meetings2025: [[2,6],[3,20],[5,8],[6,19],[8,7],[9,18],[11,6],[12,18]],
                meetings2026: [[2,5],[3,19],[5,7],[6,18],[8,6],[9,17],[11,5],[12,17]]
            },
            boj: { 
                rate: '0.50%', 
                currency: 'JPY',
                meetings2025: [[1,24],[3,14],[5,1],[6,17],[7,31],[9,19],[10,31],[12,19]],
                meetings2026: [[1,23],[3,13],[4,30],[6,16],[7,30],[9,18],[10,30],[12,18]]
            },
            rba: { 
                rate: '4.10%', 
                currency: 'AUD',
                meetings2025: [[2,18],[4,1],[5,20],[7,8],[8,12],[9,30],[11,4],[12,9]],
                meetings2026: [[2,17],[4,7],[5,19],[7,7],[8,11],[9,29],[11,3],[12,8]]
            }
        };

        function getNextCBMeeting(bank) {
            const now = new Date();
            const currentYear = now.getFullYear();
            const schedule = cbMeetingSchedules[bank];
            if (!schedule) return 'TBD';
            
            const meetings = currentYear === 2025 ? schedule.meetings2025 : 
                            currentYear === 2026 ? schedule.meetings2026 : schedule.meetings2026;
            
            for (const [month, day] of meetings) {
                const meetingDate = new Date(currentYear, month - 1, day);
                if (meetingDate >= now) {
                    const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
                    return `${monthNames[month - 1]} ${day}`;
                }
            }
            // If all meetings passed, get first of next year
            const nextYearMeetings = currentYear === 2025 ? schedule.meetings2026 : schedule.meetings2026;
            if (nextYearMeetings && nextYearMeetings.length > 0) {
                const [month, day] = nextYearMeetings[0];
                const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
                return `${monthNames[month - 1]} ${day}`;
            }
            return 'TBD';
        }

        function renderCentralBankRates() {
            const banks = [
                { id: 'fed', name: 'Fed' },
                { id: 'ecb', name: 'ECB' },
                { id: 'boe', name: 'BOE' },
                { id: 'boj', name: 'BOJ' },
                { id: 'rba', name: 'RBA' }
            ];
            
            return banks.map(bank => {
                const schedule = cbMeetingSchedules[bank.id];
                return `
                    <div class="cb-rate-item">
                        <div class="cb-rate-left">
                            <span class="cb-rate-bank">${bank.name}</span>
                            <span class="cb-rate-currency">(${schedule.currency})</span>
                        </div>
                        <div class="cb-rate-right">
                            <span class="cb-rate-value">${schedule.rate}</span>
                            <span class="cb-rate-next">â†’ ${getNextCBMeeting(bank.id)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMacroData(macroData) {
            const macroColumn = document.getElementById('macroColumn');
            
            if (!macroData.yields && !macroData.indicators) return;

            const yieldsHtml = macroData.yields ? macroData.yields.map(item => `
                <div class="macro-grid-item ${item.tripwireHit ? 'tripwire-hit' : ''}" onclick="openChart('${item.tvSymbol || ''}')" style="cursor: pointer;">
                    <div class="macro-item-left">
                        <div class="macro-item-label">${item.label}</div>
                        <div class="macro-item-value">${item.value}</div>
                    </div>
                    <div class="macro-item-right">
                        <div class="macro-item-change ${getMacroClass(item.dir)}">${item.change}</div>
                    </div>
                </div>
            `).join('') : '';

            const indicatorsHtml = macroData.indicators ? macroData.indicators.map(item => `
                <div class="macro-grid-item ${item.tripwireHit ? 'tripwire-hit' : ''}" onclick="${item.fredId ? `window.open('https://fred.stlouisfed.org/series/${item.fredId}', '_blank')` : ''}" style="cursor: pointer;">
                    <div class="macro-item-left">
                        <div class="macro-item-label">${item.label}</div>
                        <div class="macro-item-value">${item.value}</div>
                    </div>
                    <div class="macro-item-right">
                        <div class="macro-item-change ${getMacroClass(item.dir)}">${item.change}</div>
                    </div>
                </div>
            `).join('') : '';

            const cbRatesHtml = renderCentralBankRates();

            const existingGrid = macroColumn.querySelector('.macro-grid-container');
            const gridHtml = `
                <div class="macro-grid-container">
                    <div class="macro-dashboard-title">BASE LAYER</div>
                    <div class="macro-dashboard-subtitle">Yields â€¢ Liquidity</div>
                    <div class="macro-grid">
                        <div class="macro-grid-column">
                            ${yieldsHtml}
                        </div>
                        <div class="macro-grid-column">
                            ${indicatorsHtml}
                        </div>
                    </div>
                    <div class="cb-rates-section" style="margin-top:10px;padding-top:8px;border-top:1px solid rgba(255,255,255,0.08);">
                        <div class="cb-rates-title" style="font-size:0.7rem;font-weight:700;color:#3b82f6;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:6px;text-align:center;">CENTRAL BANK RATES</div>
                        <div id="cbRates">${cbRatesHtml}</div>
                    </div>
                    <div style="display:flex;align-items:center;gap:6px;margin-top:8px;padding:4px 8px;font-size:9px;color:#6a7585;border-top:1px solid rgba(255,255,255,0.05);">
                        <span>ðŸ“ˆ</span>
                        <span>Click yields for TradingView, indicators for FRED</span>
                    </div>
                    <div style="display:flex;align-items:center;justify-content:space-between;gap:6px;margin-top:6px;padding:4px 8px;font-size:9px;color:#6a7585;">
                        <div style="display:flex;align-items:center;gap:6px;">
                            <span style="display:inline-block;width:12px;height:3px;background:var(--accent-red);border-radius:1px;"></span>
                            <span>Tripwire breached</span>
                        </div>
                        <button class="know-more-btn" onclick="openRatesLegend()">
                            <span>KNOW MORE</span>
                        </button>
                    </div>
                </div>
            `;

            if (existingGrid) {
                existingGrid.outerHTML = gridHtml;
            } else {
                macroColumn.insertAdjacentHTML('afterbegin', gridHtml);
                macroColumn.scrollTop = 0;
            }
        }

        function getMacroClass(dir) {
            return dir === 'up' ? 'macro-up' : 
                   dir === 'down' ? 'macro-down' : 
                   'macro-neutral';
        }


        function updateFXData(fxData) {
            if (!fxData || (!fxData.macro && !fxData.geo && !fxData.commodity)) return;
            fxDataStore = fxData;

            const fxMacroContainer = document.getElementById('fxMacro');
            const fxGeoContainer = document.getElementById('fxGeo');
            const fxCommodityContainer = document.getElementById('fxCommodity');

            const renderFXPair = (pair) => `
                <div class="fx-pair-item" onclick="openChart('${sanitizeHTML(pair.tvSymbol || pair.label)}')">
                    <div class="fx-pair-left">
                        <div style="display:flex;align-items:center;gap:0.3rem;">
                            <div class="fx-pair-label">${sanitizeHTML(pair.label)}</div>
                            <div class="fx-pair-change ${getFXClass(pair.dir)}" style="font-size:0.65rem;">${sanitizeHTML(pair.change)}%</div>
                        </div>
                        <div style="display:flex;align-items:center;gap:0.2rem;">
                            <div class="fx-pair-price">${sanitizeHTML(pair.price)}</div>
                            <span class="${getFXClass(pair.dir)}" style="font-size:0.55rem;">${getFXArrow(pair.dir)}</span>
                        </div>
                    </div>
                </div>
            `;

            // Update MACRO PLUMBING (10 pairs)
            if (fxData.macro && fxMacroContainer) {
                fxMacroContainer.innerHTML = fxData.macro.map(renderFXPair).join('');
            }

            // Update GEOPOLITICS (10 pairs)
            if (fxData.geo && fxGeoContainer) {
                fxGeoContainer.innerHTML = fxData.geo.map(renderFXPair).join('');
            }

            // Update COMMODITIES (10 pairs)
            if (fxData.commodity && fxCommodityContainer) {
                fxCommodityContainer.innerHTML = fxData.commodity.map(renderFXPair).join('');
            }

            updateSuperTicker();
        }

        function getFXClass(dir) {
            return dir === 'up' ? 'fx-up' : 
                   dir === 'down' ? 'fx-down' : 
                   'fx-neutral';
        }

        function getFXArrow(dir) {
            return dir === 'up' ? 'â–²' : 
                   dir === 'down' ? 'â–¼' : 
                   'â†’';
        }

        let commodityDataStore = { metals: [], energy: [], agriculture: [] };

        function updateCommodityData(commodityData) {
            if (!commodityData) return;
            commodityDataStore = commodityData;

            const metalsContainer = document.getElementById('commodityMetals');
            const energyContainer = document.getElementById('commodityEnergy');
            const agricultureContainer = document.getElementById('commodityAgriculture');

            const renderCommodity = (item) => `
                <div class="commodity-item" onclick="openChart('${sanitizeHTML(item.tvSymbol || item.ticker || item.label)}')" style="cursor: pointer;">
                    <div class="commodity-item-left">
                        <div style="display:flex;align-items:center;gap:0.3rem;">
                            <div class="commodity-item-label">${sanitizeHTML(item.label)}</div>
                            <div class="commodity-item-change ${getCommodityClass(item.dir)}" style="font-size:0.65rem;">${sanitizeHTML(item.change)}%</div>
                        </div>
                        <div style="display:flex;align-items:center;gap:0.2rem;">
                            <div class="commodity-item-price">${sanitizeHTML(item.price)}</div>
                            <span class="${getCommodityClass(item.dir)}" style="font-size:0.55rem;">${getCommodityArrow(item.dir)}</span>
                        </div>
                    </div>
                </div>
            `;

            const sortAlpha = (arr) => [...arr].sort((a, b) => a.label.localeCompare(b.label));
            
            // Energy sort: WTI first, then alphabetical
            const sortEnergy = (arr) => {
                const wti = arr.filter(c => c.label === 'WTI');
                const rest = arr.filter(c => c.label !== 'WTI').sort((a, b) => a.label.localeCompare(b.label));
                return [...wti, ...rest];
            };

            if (commodityData.metals && metalsContainer) {
                metalsContainer.innerHTML = sortAlpha(commodityData.metals).map(renderCommodity).join('');
            }
            if (commodityData.energy && energyContainer) {
                energyContainer.innerHTML = sortEnergy(commodityData.energy).map(renderCommodity).join('');
            }
            if (commodityData.agriculture && agricultureContainer) {
                agricultureContainer.innerHTML = sortAlpha(commodityData.agriculture).map(renderCommodity).join('');
            }

            updateSuperTicker();
        }

        function getCommodityClass(dir) {
            return dir === 'up' ? 'commodity-up' : 
                   dir === 'down' ? 'commodity-down' : 
                   'commodity-neutral';
        }

        function getCommodityArrow(dir) {
            return dir === 'up' ? 'â–²' : 
                   dir === 'down' ? 'â–¼' : 
                   'â†’';
        }

        function getMarketClass(dir) {
            return dir === 'up' ? 'market-up' : 
                   dir === 'down' ? 'market-down' : 
                   'market-neutral';
        }

        // ========================================================================
        // PREDICTION MARKETS UPDATE
        // ========================================================================
        
        function updatePredictionData(data) {
            if (!data) return;
            
            const sentimentDashboard = document.getElementById('sentimentDashboard');
            const polymarketList = document.getElementById('polymarketList');
            
            // Update sentiment dashboard
            if (data.sentiment && sentimentDashboard) {
                const s = data.sentiment;
                sentimentDashboard.innerHTML = `
                    <div class="sentiment-grid">
                        <div class="sentiment-item">
                            <div class="sentiment-label">VIX REGIME</div>
                            <div class="sentiment-value" style="color: ${sanitizeHTML(s.vix.color)}">${sanitizeHTML(s.vix.regime)}</div>
                            <div class="sentiment-sub">${sanitizeHTML(s.vix.value)}</div>
                        </div>
                        <div class="sentiment-item">
                            <div class="sentiment-label">FEAR/GREED</div>
                            <div class="sentiment-value" style="color: ${sanitizeHTML(s.fearGreed.color)}">${sanitizeHTML(s.fearGreed.value)}</div>
                            <div class="sentiment-sub">${sanitizeHTML(s.fearGreed.label)}</div>
                        </div>
                        <div class="sentiment-item">
                            <div class="sentiment-label">2s10s CURVE</div>
                            <div class="sentiment-value" style="color: ${sanitizeHTML(s.curve.color)}">${sanitizeHTML(s.curve.signal)}</div>
                            <div class="sentiment-sub">${sanitizeHTML(s.curve.value)}</div>
                        </div>
                        <div class="sentiment-item">
                            <div class="sentiment-label">DOLLAR</div>
                            <div class="sentiment-value" style="color: ${sanitizeHTML(s.dollar.color)}">${sanitizeHTML(s.dollar.signal)}</div>
                            <div class="sentiment-sub">DXY ${sanitizeHTML(s.dollar.value)}</div>
                        </div>
                        <div class="sentiment-item">
                            <div class="sentiment-label">FED CUT ODDS</div>
                            <div class="sentiment-value" style="color: #a78bfa">${sanitizeHTML(s.rateCut.value)}</div>
                            <div class="sentiment-sub">Next Meeting</div>
                        </div>
                        <div class="sentiment-item">
                            <div class="sentiment-label">GOLD</div>
                            <div class="sentiment-value" style="color: ${sanitizeHTML(s.gold.color)}">${sanitizeHTML(s.gold.signal)}</div>
                            <div class="sentiment-sub">${sanitizeHTML(s.gold.value)}</div>
                        </div>
                        <div class="sentiment-item">
                            <div class="sentiment-label">OIL/WTI</div>
                            <div class="sentiment-value" style="color: ${sanitizeHTML(s.oil.color)}">${sanitizeHTML(s.oil.signal)}</div>
                            <div class="sentiment-sub">${sanitizeHTML(s.oil.value)}</div>
                        </div>
                        <div class="sentiment-item">
                            <div class="sentiment-label">CREDIT</div>
                            <div class="sentiment-value" style="color: ${sanitizeHTML(s.credit.color)}">${sanitizeHTML(s.credit.signal)}</div>
                            <div class="sentiment-sub">Score: ${sanitizeHTML(s.credit.value)}</div>
                        </div>
                    </div>
                `;
            }
            
            // Update Polymarket odds
            if (data.markets && polymarketList) {
                if (data.markets.length === 0) {
                    polymarketList.innerHTML = '<div class="polymarket-empty">Loading prediction markets...</div>';
                    return;
                }
                
                polymarketList.innerHTML = data.markets.map(market => {
                    const probNum = parseFloat(market.probability);
                    const probColor = probNum >= 70 ? '#22c55e' : probNum >= 50 ? '#eab308' : probNum >= 30 ? '#f97316' : '#ef4444';
                    const dirArrow = market.direction === 'up' ? 'â–²' : market.direction === 'down' ? 'â–¼' : '';
                    const categoryClass = sanitizeHTML(market.category.toLowerCase());

                    return `
                        <div class="polymarket-item" onclick="window.open('https://polymarket.com/', '_blank')">
                            <div class="polymarket-header">
                                <span class="polymarket-category cat-${categoryClass}">${sanitizeHTML(market.category)}</span>
                                <span class="polymarket-prob" style="color: ${probColor}">${sanitizeHTML(market.probability)}% ${dirArrow}</span>
                            </div>
                            <div class="polymarket-question">${sanitizeHTML(market.question)}</div>
                        </div>
                    `;
                }).join('');
            }
        }

        // ========================================================================
        // GAME THEORY ENGINE UI
        // ========================================================================
        
        // Store game data for analysis lookup
        const gameDataStore = {};
        
        function updateGameTheoryData(data) {
            if (!data || !data.games) return;
            
            const gameTheoryList = document.getElementById('gameTheoryList');
            if (!gameTheoryList) return;
            
            const games = Object.values(data.games);
            
            if (games.length === 0) {
                gameTheoryList.innerHTML = '<div class="game-theory-loading">No active games tracked</div>';
                return;
            }
            
            // Sort by status severity (red > yellow > green)
            const statusOrder = { red: 0, yellow: 1, green: 2 };
            games.sort((a, b) => (statusOrder[a.statusColor] || 2) - (statusOrder[b.statusColor] || 2));
            
            // Store game data for later lookup
            games.forEach(game => {
                gameDataStore[game.id] = game;
            });
            
            gameTheoryList.innerHTML = games.map(game => {
                const moveTypeClass = game.lastMove.type === 'DEFECT' ? 'move-type-defect' :
                                     game.lastMove.type === 'COOPERATE' ? 'move-type-cooperate' : 'move-type-signal';

                return `
                    <div class="game-card status-${sanitizeHTML(game.statusColor)}">
                        <div class="game-header">
                            <span class="game-title">${sanitizeHTML(game.emoji)} ${sanitizeHTML(game.title)}</span>
                            <span class="game-phase phase-${sanitizeHTML(game.phaseColor)}">${sanitizeHTML(game.currentPhase)}</span>
                        </div>
                        <div class="game-players">${game.players.map(p => sanitizeHTML(p)).join(' vs ')}</div>
                        <div class="game-last-move">
                            <div class="game-move-label">Last Move (${sanitizeHTML(game.lastMove.date)})</div>
                            <div class="game-move-text">
                                <strong>${sanitizeHTML(game.lastMove.player)}:</strong> ${sanitizeHTML(game.lastMove.action)}
                                <span class="game-move-type ${moveTypeClass}">${sanitizeHTML(game.lastMove.type)}</span>
                            </div>
                        </div>
                        <div class="game-equilibrium">
                            <span class="equilibrium-dot eq-${sanitizeHTML(game.statusColor)}"></span>
                            <span class="equilibrium-text" style="color: ${game.statusColor === 'green' ? '#22c55e' : game.statusColor === 'yellow' ? '#f59e0b' : '#ef4444'}">${sanitizeHTML(game.equilibriumStatus)}</span>
                        </div>
                        <div class="game-next-move">${sanitizeHTML(game.nextLikelyMove)}</div>
                        <div class="game-analyze-btn" onclick="analyzeGameConflict('${sanitizeHTML(game.id)}')">
                            <span class="game-analyze-btn-icon">ðŸ¤–</span>
                            <span>GET AI ANALYSIS â†’</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ========================================================================
        // GEMINI AI ANALYSIS MODAL
        // ========================================================================
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function manualRefresh() {
            const btn = document.querySelector('.refresh-btn');
            btn.classList.add('spinning');
            
            // Request immediate refresh from server
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type: 'refresh_request' }));
            }
            
            setTimeout(() => btn.classList.remove('spinning'), 500);
        }

        function analyzeGameConflict(gameId) {
            const game = gameDataStore[gameId];
            if (!game) {
                console.error('Game data not found for:', gameId);
                return;
            }

            const modal = document.getElementById('analysisModal');
            const modalHeadline = document.getElementById('modalHeadline');
            const modalBody = document.getElementById('modalBody');
            const modalSource = document.getElementById('modalSource');

            modalHeadline.textContent = `${game.emoji} ${game.title}`;
            modalSource.innerHTML = `<span class="modal-source-label">Players:</span>${game.players.map(p => sanitizeHTML(p)).join(' vs ')}`;
            modalBody.innerHTML = `
                <div class="modal-loading">
                    <div class="modal-spinner"></div>
                    <div class="modal-loading-text">Analyzing strategic conflict with Gemini AI...<br><span style="font-size: 0.85em; opacity: 0.8;">Generating comprehensive game theory analysis</span></div>
                    <div style="margin-top: 1.5rem; padding: 0.75rem; background: rgba(0,0,0,0.2); border-radius: 6px; max-width: 400px;">
                        <p style="font-size: 0.7rem; color: #6a7585; line-height: 1.4; text-align: center; margin: 0;">
                            <strong>DISCLAIMER:</strong> This is not financial advice. I am not a financial advisor. This content is for informational and educational purposes only. Investing involves risk, and you should always do your own due diligence (DYOR) and consult with a professional financial advisor before making any investment decisions.
                        </p>
                    </div>
                </div>
            `;

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';

            fetch('/api/analyze-game', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    gameId: game.id,
                    title: game.title,
                    emoji: game.emoji,
                    players: game.players,
                    currentPhase: game.currentPhase,
                    lastMove: game.lastMove,
                    equilibriumStatus: game.equilibriumStatus,
                    nextLikelyMove: game.nextLikelyMove
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.analysis) {
                    modalBody.innerHTML = `<div class="modal-analysis">${parseMarkdown(data.analysis)}</div>`;
                } else {
                    modalBody.innerHTML = `<div class="modal-error">${data.error || 'Failed to analyze. Please try again.'}</div>`;
                }
            })
            .catch(error => {
                console.error('Game analysis error:', error);
                modalBody.innerHTML = `<div class="modal-error">Network error. Please try again.</div>`;
            });
        }

        function analyzeHeadline(cardId) {
            const cardData = cardDataStore[cardId];
            if (!cardData) {
                console.error('Card data not found for:', cardId);
                return;
            }

            const headline = cardData.headline;
            const source = cardData.source;
            const implications = cardData.implications || [];

            const modal = document.getElementById('analysisModal');
            const modalHeadline = document.getElementById('modalHeadline');
            const modalBody = document.getElementById('modalBody');
            const modalSource = document.getElementById('modalSource');

            modalHeadline.textContent = headline;
            modalSource.innerHTML = source ? `<span class="modal-source-label">Source:</span>${source}` : '';
            modalBody.innerHTML = `
                <div class="modal-loading">
                    <div class="modal-spinner"></div>
                    <div class="modal-loading-text">Analyzing with Gemini AI...<br><span style="font-size: 0.85em; opacity: 0.8;">Something great is about to happen - just a moment!</span></div>
                    <div style="margin-top: 1.5rem; padding: 0.75rem; background: rgba(0,0,0,0.2); border-radius: 6px; max-width: 400px;">
                        <p style="font-size: 0.7rem; color: #6a7585; line-height: 1.4; text-align: center; margin: 0;">
                            <strong>DISCLAIMER:</strong> This is not financial advice. I am not a financial advisor. This content is for informational and educational purposes only. Investing involves risk, and you should always do your own due diligence (DYOR) and consult with a professional financial advisor before making any investment decisions.
                        </p>
                    </div>
                </div>
            `;

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';

            fetch('/api/analyze-headline', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ headline, source, implications })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.analysis) {
                    modalBody.innerHTML = `<div class="modal-analysis">${parseMarkdown(data.analysis)}</div>`;
                } else {
                    modalBody.innerHTML = `<div class="modal-error">${data.error || 'Failed to analyze. Please try again.'}</div>`;
                }
            })
            .catch(error => {
                console.error('Analysis error:', error);
                modalBody.innerHTML = `<div class="modal-error">Network error. Please try again.</div>`;
            });
        }

        function closeModal() {
            const modal = document.getElementById('analysisModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        document.getElementById('analysisModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                closeChart();
            }
        });

        // ========================================================================
        // TRADINGVIEW CHART POPUP
        // ========================================================================

        function openChart(tvSymbol) {
            const modal = document.getElementById('chartModal');
            modal.style.display = 'flex';
            
            // Clear previous chart
            document.getElementById('tradingview_widget').innerHTML = '';
            
            // Create TradingView widget
            new TradingView.widget({
                "width": "100%",
                "height": "100%",
                "symbol": tvSymbol,
                "interval": "D",
                "timezone": "Etc/UTC",
                "theme": "dark",
                "style": "1",
                "locale": "en",
                "toolbar_bg": "#131722",
                "enable_publishing": false,
                "allow_symbol_change": true,
                "save_image": false,
                "container_id": "tradingview_widget",
                "hide_top_toolbar": false,
                "hide_legend": false,
                "withdateranges": true,
                "studies": [
                    "MASimple@tv-basicstudies",
                    "RSI@tv-basicstudies"
                ]
            });
        }

        function closeChart(event) {
            document.getElementById('chartModal').style.display = 'none';
        }
        
        function stopChartPropagation(event) {
            event.stopPropagation();
        }

        function openInfoModal() {
            document.getElementById('infoModal').style.display = 'flex';
        }

        function closeInfoModal(event) {
            if (!event || event.target.id === 'infoModal') {
                document.getElementById('infoModal').style.display = 'none';
            }
        }

        // ESC key closes info modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeInfoModal();
            }
        });

        function searchSymbol() {
            const input = document.getElementById('symbolSearchInput');
            const symbol = input.value.trim().toUpperCase();
            if (symbol) {
                openChart(symbol);
                input.value = '';
                document.getElementById('tickerSearchPopup').classList.remove('active');
            }
        }

        (function() {
            const ticker = document.getElementById('marketTicker');
            const popup = document.getElementById('tickerSearchPopup');
            const input = document.getElementById('symbolSearchInput');
            let hoverTimeout;

            if (ticker && popup) {
                ticker.addEventListener('mouseenter', function() {
                    hoverTimeout = setTimeout(function() {
                        popup.classList.add('active');
                    }, 500);
                });

                ticker.addEventListener('mouseleave', function(e) {
                    clearTimeout(hoverTimeout);
                    if (!popup.contains(e.relatedTarget)) {
                        popup.classList.remove('active');
                    }
                });

                popup.addEventListener('mouseleave', function() {
                    popup.classList.remove('active');
                });

                if (input) {
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            searchSymbol();
                        }
                    });
                }
            }
        })();

        function parseMarkdown(text) {
            // Section headers like IMPACT, TRADE, 2ND ORDER, KEY LEVELS, TIMELINE, GAME THEORY
            const sectionHeaders = ['IMPACT', 'TRADE', '2ND ORDER', 'KEY LEVELS', 'TIMELINE', 'GAME THEORY', 'SUMMARY', 'RISK', 'OUTLOOK'];
            
            let result = text
                // First, detect standalone section headers (on their own line, possibly with ** around them)
                .replace(/^\*\*(IMPACT|TRADE|2ND ORDER|KEY LEVELS|TIMELINE|GAME THEORY|SUMMARY|RISK|OUTLOOK)\*\*:?$/gim, '<div class="analysis-section-header">$1</div>')
                .replace(/^(IMPACT|TRADE|2ND ORDER|KEY LEVELS|TIMELINE|GAME THEORY|SUMMARY|RISK|OUTLOOK):?$/gim, '<div class="analysis-section-header">$1</div>')
                // Bold text for assets and prices - make them stand out
                .replace(/\*\*(.+?)\*\*/g, '<strong class="asset-highlight">$1</strong>')
                .replace(/\*(.+?)\*/g, '<em>$1</em>')
                .replace(/^### (.+)$/gm, '<h3>$1</h3>')
                .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                .replace(/^# (.+)$/gm, '<h1>$1</h1>')
                .replace(/^\d+\. (.+)$/gm, '<li>$1</li>')
                .replace(/^- (.+)$/gm, '<li>$1</li>')
                .replace(/^\* (.+)$/gm, '<li>$1</li>')
                .replace(/(<li>.*<\/li>)/gs, function(match) {
                    if (match.includes('<ul>') || match.includes('<ol>')) return match;
                    return '<ul>' + match + '</ul>';
                })
                .replace(/<\/ul>\s*<ul>/g, '')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^(.+)$/gm, function(match) {
                    if (match.startsWith('<')) return match;
                    return match;
                });
            
            return result;
        }
    </script>

    <!-- TradingView Chart Modal -->
    <div id="chartModal" class="chart-modal-overlay" style="display: none;" onclick="closeChart(event)">
        <div class="chart-modal-content" onclick="event.stopPropagation()">
            <button class="chart-close-btn" onclick="closeChart(event)">Ã—</button>
            <div id="tradingview_widget"></div>
        </div>
    </div>

    <!-- TradingView Widget Library -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <!-- Info/Legend Modal -->
    <div id="infoModal" class="chart-modal-overlay" style="display: none;" onclick="closeInfoModal(event)">
        <div class="chart-modal-content" onclick="event.stopPropagation()" style="max-width: 700px;">
            <button class="chart-close-btn" onclick="closeInfoModal()" style="top: 10px; right: 10px; position: absolute;">Ã—</button>
            <div class="modal-title">ðŸ“– LEGEND & KEY</div>
            <div class="modal-analysis info-modal-scroll" style="max-height: 70vh; overflow-y: auto;">
                
                <h3 style="color: var(--accent-orange); margin-top: 0;">IMPACT DOTS (Ticker)</h3>
                <p>ðŸ”´ðŸ”´ðŸ”´ = <strong>HIGH IMPACT</strong> - Major market mover</p>
                <p>ðŸ”´ðŸ”´âšª = <strong>MEDIUM IMPACT</strong> - Notable event</p>
                <p>ðŸ”´âšªâšª = <strong>LOW IMPACT</strong> - Minor news</p>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: Fed rate decision = ðŸ”´ðŸ”´ðŸ”´, earnings beat = ðŸ”´ðŸ”´âšª</p>
                
                <h3 style="color: var(--accent-orange); margin-top: 1.5rem;">TRIPWIRE ALERTS (Rates Dashboard)</h3>
                <p style="display:flex;align-items:center;gap:8px;font-size:1.05em;"><span style="display:inline-block;width:16px;height:3px;background:var(--accent-red);border-radius:1px;flex-shrink:0;"></span> <strong>Threshold Breached</strong> - Indicator crossed a key level</p>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: U6 Rate >8% signals rising unemployment stress</p>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: SOFR >5.5% signals liquidity tightening</p>
                
                <h3 style="color: var(--accent-orange); margin-top: 1.5rem;">MARKET RISK</h3>
                <div class="legend-item"><span class="legend-icon">ðŸŸ¢</span><span class="legend-text"><strong>10-30%</strong> = LOW RISK - Boring news, won't move markets</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸŸ¡</span><span class="legend-text"><strong>30-60%</strong> = MEDIUM RISK - Watch, might matter</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸŸ </span><span class="legend-text"><strong>60-85%</strong> = HIGH RISK - Markets reacting, pay attention</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ”´</span><span class="legend-text"><strong>85-100%</strong> = CRITICAL RISK - Flash alert, all hands on deck</span></div>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: CPI surprise = 75%, routine earnings = 25%</p>
                
                <h3 style="color: var(--accent-orange); margin-top: 1.5rem;">HORIZON (Time to Impact)</h3>
                <div class="legend-item"><span class="legend-icon">âš¡</span><span class="legend-text"><strong>NOW</strong> = Immediate impact, act now!</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ“…</span><span class="legend-text"><strong>DAYS</strong> = Coming days, plan ahead</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ“†</span><span class="legend-text"><strong>WEEKS</strong> = Longer term, structural shift</span></div>
                <div class="legend-item"><span class="legend-icon">âž–</span><span class="legend-text"><strong>N/A</strong> = Not market-relevant</span></div>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: Fed pivot = NOW, GDP revision = DAYS, trade deal talks = WEEKS</p>
                
                <h3 style="color: var(--accent-orange); margin-top: 1.5rem;">REGIME INDICATORS</h3>
                <div class="legend-item"><span class="legend-icon">ðŸŒŸ</span><span class="legend-text"><strong>GOLDILOCKS</strong> = Growthâ†‘ Inflationâ†“<br><em>Buy: Stocks, Tech, extend duration</em></span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ”¥</span><span class="legend-text"><strong>REFLATIONARY</strong> = Growthâ†‘ Inflationâ†‘<br><em>Buy: Commodities, Value, cyclicals</em></span></div>
                <div class="legend-item"><span class="legend-icon">âš ï¸</span><span class="legend-text"><strong>STAGFLATION</strong> = Growthâ†“ Inflationâ†‘<br><em>Buy: Gold, TIPS, commodity producers only</em></span></div>
                <div class="legend-item"><span class="legend-icon">â„ï¸</span><span class="legend-text"><strong>DEFLATIONARY</strong> = Growthâ†“ Inflationâ†“<br><em>Buy: Cash, Treasuries, USD, JPY</em></span></div>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: Strong jobs + falling CPI = GOLDILOCKS, weak PMI + high oil = STAGFLATION</p>
                
                <h3 style="color: var(--accent-orange); margin-top: 1.5rem;">DIRECTION</h3>
                <div class="legend-item"><span class="legend-icon">ðŸŸ¢</span><span class="legend-text"><strong>RISK-ON</strong> = Buy risk assets (stocks, commodities, EM)</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ”´</span><span class="legend-text"><strong>RISK-OFF</strong> = Sell risk assets, buy safe havens</span></div>
                <div class="legend-item"><span class="legend-icon">âšª</span><span class="legend-text"><strong>NEUTRAL</strong> = Mixed signals, wait and see</span></div>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: Dovish Fed = RISK-ON, war escalation = RISK-OFF</p>
                
                <h3 style="color: var(--accent-orange); margin-top: 1.5rem;">GAME THEORY PATTERNS</h3>
                <div class="legend-item"><span class="legend-icon">â›“ï¸</span><span class="legend-text"><strong>Prisoner's Dilemma</strong> = Escalation spiral risk (tariffs, retaliation)</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ”</span><span class="legend-text"><strong>Chicken Game</strong> = Brinkmanship, high accident risk</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ¤</span><span class="legend-text"><strong>Coordination Game</strong> = Collective action multiplies impact (G7/G20)</span></div>
                <div class="legend-item"><span class="legend-icon">âš”ï¸</span><span class="legend-text"><strong>Zero-Sum Conflict</strong> = Winner-take-all confrontation</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸŽ­</span><span class="legend-text"><strong>Reputation Game</strong> = Credibility stakes, precedent-setting</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ“¡</span><span class="legend-text"><strong>Signaling Game</strong> = Forward guidance, market expectation shaping</span></div>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: US-China tariffs = Prisoner's Dilemma, Taiwan Strait = Chicken Game</p>
                
                <h3 style="color: var(--accent-orange); margin-top: 1.5rem;">ASSET TAGS</h3>
                <div class="legend-item"><span class="legend-icon">ðŸ’±</span><span class="legend-text"><strong>FX</strong> = Currency markets affected</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ¥‡</span><span class="legend-text"><strong>GOLD/SILVER</strong> = Precious metals</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ›¢ï¸</span><span class="legend-text"><strong>OIL/NATGAS</strong> = Energy commodities</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ“ˆ</span><span class="legend-text"><strong>BONDS</strong> = Fixed income markets</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ“Š</span><span class="legend-text"><strong>EQUITIES</strong> = Stock markets</span></div>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: BOJ rate hike = FX + BONDS, Strait of Hormuz tension = OIL</p>
                
                <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                    <p style="font-size: 0.75rem; color: #6a7585; line-height: 1.5; text-align: center;">
                        <strong>DISCLAIMER:</strong> This is not financial advice. I am not a financial advisor. This content is for informational and educational purposes only. Investing involves risk, and you should always do your own due diligence (DYOR) and consult with a professional financial advisor before making any investment decisions.
                    </p>
                </div>
                
            </div>
        </div>
    </div>

    <!-- Game Theory Legend Modal -->
    <div id="gameLegendModal" class="chart-modal-overlay" style="display: none;" onclick="closeGameLegend(event)">
        <div class="chart-modal-content" onclick="event.stopPropagation()" style="max-width: 700px; border-color: #9333ea;">
            <button class="chart-close-btn" onclick="closeGameLegend()" style="top: 15px; right: 15px; position: absolute; color: #a855f7;">Ã—</button>
            <div class="modal-title" style="color: #a855f7; padding: 0.5rem 0;">GAME THEORY LEGEND</div>
            <div class="modal-analysis info-modal-scroll">
                
                <h3 style="color: #a855f7; margin-top: 0;">WHAT IS THE ACTIVE GAMES TRACKER?</h3>
                <p style="line-height: 1.6;">A living game theory engine that monitors 20 global strategic conflicts in real-time. AI scans news every 30 minutes to detect "moves" - actions by key players that shift the equilibrium of each game. Think of it as a chess board for geopolitics and macro.</p>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: US announces new chip export controls â†’ "DEFECT" move in US-China Tech War</p>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">EQUILIBRIUM STATUS</h3>
                <div class="legend-item"><span class="legend-icon">ðŸŸ¢</span><span class="legend-text"><strong>STABLE</strong> = Nash equilibrium holding - both sides have found a balance where neither benefits from changing strategy. Low volatility expected.</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸŸ¡</span><span class="legend-text"><strong>SHIFTING</strong> = Players repositioning - one or more actors considering a strategy change. Watch for moves that could tip the balance.</span></div>
                <div class="legend-item"><span class="legend-icon">ðŸ”´</span><span class="legend-text"><strong>UNSTABLE</strong> = Equilibrium breaking down - no stable outcome, high probability of sudden moves. Maximum volatility risk.</span></div>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: Taiwan Strait = ðŸ”´ UNSTABLE when military exercises announced, ðŸŸ¢ STABLE during diplomatic summits</p>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">PHASE PROGRESSION</h3>
                <div class="legend-item"><span class="legend-icon">1ï¸âƒ£</span><span class="legend-text"><strong>SETUP</strong> = Initial positioning phase. Stakes being defined, alliances forming, red lines being drawn. Markets largely ignore.</span></div>
                <div class="legend-item"><span class="legend-icon">2ï¸âƒ£</span><span class="legend-text"><strong>ESCALATION</strong> = Tensions rising with tit-for-tat moves. Each side responds to the other. Markets start pricing risk.</span></div>
                <div class="legend-item"><span class="legend-icon">3ï¸âƒ£</span><span class="legend-text"><strong>BRINKMANSHIP</strong> = Red lines being tested. High accident risk, miscalculation possible. Markets on edge, VIX elevated.</span></div>
                <div class="legend-item"><span class="legend-icon">4ï¸âƒ£</span><span class="legend-text"><strong>CONFLICT</strong> = Open confrontation. Maximum market impact, safe haven flows, sector dislocations.</span></div>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: Russia-Ukraine moved SETUP (2014) â†’ ESCALATION (2021) â†’ BRINKMANSHIP (Jan 2022) â†’ CONFLICT (Feb 2022)</p>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">MOVE CLASSIFICATION</h3>
                <div class="legend-item"><span class="legend-icon" style="color:#ef4444;">ðŸ”´</span><span class="legend-text"><strong>DEFECT</strong> = Aggressive/competitive action that breaks cooperation. Sanctions, tariffs, military moves, export bans. Typically risk-off.</span></div>
                <div class="legend-item"><span class="legend-icon" style="color:#22c55e;">ðŸŸ¢</span><span class="legend-text"><strong>COOPERATE</strong> = De-escalation or collaborative action. Diplomatic outreach, deal-making, tension reduction. Typically risk-on.</span></div>
                <div class="legend-item"><span class="legend-icon" style="color:#3b82f6;">ðŸ”µ</span><span class="legend-text"><strong>SIGNAL</strong> = Communication without concrete action. Rhetoric, warnings, posturing. Tests opponent's resolve without commitment.</span></div>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Example: China restricts rare earth exports = DEFECT, Biden-Xi phone call = SIGNAL, trade deal signed = COOPERATE</p>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">GAME THEORY PATTERNS (Detailed)</h3>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #f59e0b;">
                    <div style="font-weight: 700; color: #f59e0b; margin-bottom: 4px;">ðŸ” CHICKEN GAME (Game of Brinkmanship)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Two players accelerate toward collision. First to "swerve" loses face but avoids disaster. Neither wants to back down, but collision destroys both.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Market:</strong> De-escalation = massive relief rally. Collision = crash. Watch for last-minute deals.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Example:</strong> Taiwan Strait tensions, US debt ceiling standoffs, Cuban Missile Crisis</p>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #ef4444;">
                    <div style="font-weight: 700; color: #ef4444; margin-bottom: 4px;">â›“ï¸ PRISONER'S DILEMMA (Escalation Trap)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Both sides would be better off cooperating, but each has an incentive to defect. Leads to suboptimal outcomes where both lose.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Market:</strong> Watch for defection spirals - once one side defects, retaliation follows. Tariff wars are classic examples.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Example:</strong> US-China trade war, OPEC production cuts (cheating incentive), arms races</p>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #22c55e;">
                    <div style="font-weight: 700; color: #22c55e; margin-bottom: 4px;">ðŸ¤ COORDINATION GAME (Focal Point)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Multiple equilibria exist - players benefit from coordinating on the same choice, but must agree which one. Success depends on finding a "focal point."</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Market:</strong> Clear statements from leaders create focal points. G7/G20 communiquÃ©s, OPEC+ agreements.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Example:</strong> Currency intervention coordination, climate accords, sanctions coalitions</p>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #8b5cf6;">
                    <div style="font-weight: 700; color: #8b5cf6; margin-bottom: 4px;">âš”ï¸ ZERO-SUM CONFLICT (Winner Take All)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">One side's gain is exactly the other's loss. No win-win possible. Pure competition with no room for mutual benefit.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Market:</strong> Territory disputes, market share wars. Clear winners and losers. Sector rotation based on who's winning.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Example:</strong> Russia-Ukraine territory, South China Sea islands, semiconductor market share</p>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #3b82f6;">
                    <div style="font-weight: 700; color: #3b82f6; margin-bottom: 4px;">ðŸ“¡ SIGNALING GAME (Credibility Test)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Actions reveal private information. Players send signals to influence beliefs. Costly signals are more credible than cheap talk.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Market:</strong> Central bank forward guidance, diplomatic warnings. Watch if words match actions.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Example:</strong> Fed dot plots, China military exercises, nuclear tests as capability signals</p>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #ec4899;">
                    <div style="font-weight: 700; color: #ec4899; margin-bottom: 4px;">ðŸŽ­ REPUTATION GAME (Precedent Setting)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Current actions affect future expectations. Players sacrifice short-term gains to build long-term credibility. Backing down once makes future threats less credible.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Market:</strong> Watch for "red line" enforcement. If crossed without consequence, future threats are discounted.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Example:</strong> Fed credibility on inflation, US security guarantees, sanctions enforcement</p>
                </div>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">THE 20 ACTIVE GAMES</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; font-size: 0.85rem; color: #94a3b8; padding: 8px 0;">
                    <div>â€¢ US-China Tech War</div>
                    <div>â€¢ Strait of Hormuz</div>
                    <div>â€¢ Fed vs Markets</div>
                    <div>â€¢ OPEC vs Shale</div>
                    <div>â€¢ Taiwan Strait</div>
                    <div>â€¢ Russia-Ukraine</div>
                    <div>â€¢ Iran-Israel Shadow War</div>
                    <div>â€¢ EU Energy Security</div>
                    <div>â€¢ ECB vs Inflation</div>
                    <div>â€¢ US Tariff War</div>
                    <div>â€¢ India-Pakistan Kashmir</div>
                    <div>â€¢ Sudan Civil War</div>
                    <div>â€¢ North Korea Nuclear</div>
                    <div>â€¢ Syria Power Vacuum</div>
                    <div>â€¢ Russia Shadow Fleet</div>
                    <div>â€¢ BRICS De-Dollarization</div>
                    <div>â€¢ Arctic Resource Race</div>
                    <div>â€¢ South China Sea</div>
                    <div>â€¢ Venezuela Crisis</div>
                    <div>â€¢ Iran Regime Stability</div>
                </div>
                
                <div style="margin-top: 2rem; padding: 1rem; border-top: 1px solid rgba(147, 51, 234, 0.2); background: rgba(147, 51, 234, 0.05); border-radius: 6px;">
                    <p style="font-size: 0.8rem; color: #a78bfa; line-height: 1.6; text-align: center; margin: 0;">
                        <strong>HOW TO USE:</strong> Track equilibrium status for early warning signals. When games shift from GREEN to YELLOW to RED, expect increased volatility. DEFECT moves typically trigger risk-off; COOPERATE moves trigger relief rallies. Phase progression helps time entries.
                    </p>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1rem; border: 1px solid rgba(147, 51, 234, 0.3); background: rgba(0,0,0,0.3); border-radius: 6px;">
                    <p style="font-size: 0.75rem; color: #6a7585; line-height: 1.5; text-align: center; margin: 0;">
                        <strong>DISCLAIMER:</strong> This is not financial advice. I am not a financial advisor. This content is for informational and educational purposes only. Investing involves risk, and you should always do your own due diligence (DYOR) and consult with a professional financial advisor before making any investment decisions.
                    </p>
                </div>
                
            </div>
        </div>
    </div>

    <!-- Strategic Intelligence Legend Modal -->
    <div id="intelLegendModal" class="chart-modal-overlay" style="display: none;" onclick="closeIntelLegend(event)">
        <div class="chart-modal-content" onclick="event.stopPropagation()" style="max-width: 700px; border-color: #9333ea;">
            <button class="chart-close-btn" onclick="closeIntelLegend()" style="top: 15px; right: 15px; position: absolute; color: #a855f7;">Ã—</button>
            <div class="modal-title" style="color: #a855f7; padding: 0.5rem 0;">STRATEGIC INTELLIGENCE LEGEND</div>
            <div class="modal-analysis info-modal-scroll">
                
                <h3 style="color: #a855f7; margin-top: 0;">WHAT IS STRATEGIC INTELLIGENCE?</h3>
                <p style="line-height: 1.6;">Five real-time macro indicators that track systemic geopolitical and economic risks. These are "second-order" signals that most traders miss - they detect regime shifts before they hit headlines.</p>
                <p style="margin-left:24px;color:#6a7585;font-size:0.95em;">Updated every 60 seconds using live market data.</p>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">THE 5 METRICS</h3>
                
                <div id="intel-rev-risk" style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #ef4444;">
                    <div style="font-weight: 700; color: #ef4444; margin-bottom: 4px;">REVOLUTION RISK (Bread + Fuel Index)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Formula: (Wheat/550 + Oil/70) Ã— (DXY/100). Tracks the classic triggers of social unrest - food and energy costs, amplified by dollar strength crushing EM purchasing power.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Levels:</strong> STABLE (green) < 1.5 | RISING (yellow) 1.5-2.0 | ELEVATED (orange) 2.0-2.5 | CRITICAL (red) > 2.5</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> CRITICAL readings preceded Arab Spring (2011), Sri Lanka collapse (2022), and Egypt protests (2023). Watch EM FX, defense stocks.</p>
                    <p style="margin: 8px 0 0 0; color: #94a3b8; font-size: 0.85rem;"><strong>Why it matters:</strong> When bread and fuel become unaffordable, revolutions follow. The Arab Spring started with a Tunisian fruit vendor. Sri Lanka's government fell when people couldn't afford cooking gas. This index captures the economic preconditions for political instability.</p>
                </div>
                
                <div id="intel-liar" style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #f59e0b;">
                    <div style="font-weight: 700; color: #f59e0b; margin-bottom: 4px;">LIAR'S POKER (Narrative vs Money)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Compares Fear & Greed sentiment against Polymarket war odds. When narrative diverges from what money is actually betting on, someone is lying.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Levels:</strong> REALITY (aligned) | WATCH (drifting) | HOPIUM (sentiment too bullish vs bets) | FEAR PORN (sentiment too bearish vs bets)</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> HOPIUM = retail overexposed, smart money hedging. FEAR PORN = contrarian buy opportunity. REALITY = trend intact.</p>
                    <p style="margin: 8px 0 0 0; color: #94a3b8; font-size: 0.85rem;"><strong>Why it matters:</strong> Media narratives often diverge from where real money is flowing. When CNN says "markets are calm" but prediction markets show rising war odds, someone's lying. This metric catches the gap between the story and the bets.</p>
                </div>
                
                <div id="intel-paper-rock" style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #3b82f6;">
                    <div style="font-weight: 700; color: #3b82f6; margin-bottom: 4px;">PAPER VS ROCK (Financialization Ratio)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Formula: SPX / (Gold + OilÃ—30 + CopperÃ—500). Measures whether the world is rotating into financial assets (Paper) or hard assets (Rock).</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Levels:</strong> FINANCIALIZED (blue, high) = Risk-on, QE regime | TRANSITIONING = Rotation happening | WAR ECONOMY (red, low) = Hard assets winning</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> WAR ECONOMY readings = overweight commodities, gold, defense. PEAK PAPER = mean reversion risk, reduce equity exposure.</p>
                    <p style="margin: 8px 0 0 0; color: #94a3b8; font-size: 0.85rem;"><strong>Why it matters:</strong> In peaceful times, financial assets outperform. In wartime or stagflation, hard assets win. This ratio tells you which regime we're in. Post-WWII was all Paper. The 1970s were all Rock. We may be transitioning again.</p>
                </div>
                
                <div id="intel-mercantilism" style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #22c55e;">
                    <div style="font-weight: 700; color: #22c55e; margin-bottom: 4px;">MERCANTILISM COUNTER (Trade Fragmentation)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Scans recent headlines for keywords: tariff, sanction, ban, blockade, friend-shoring, decouple. Quantifies the speed of deglobalization.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Levels:</strong> OPEN TRADE (0-2 signals) | FRICTION (3-5) | FRACTURING (6-9) | TRADE WAR (10+)</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> Rising mercantilism = inflation, supply chain plays, domestic manufacturing. Favor onshoring beneficiaries.</p>
                    <p style="margin: 8px 0 0 0; color: #94a3b8; font-size: 0.85rem;"><strong>Why it matters:</strong> Globalization is reversing. Every "sanction" headline, every "friend-shoring" announcement, every "decouple" speech adds friction to the system. This counter tracks how fast we're moving from free trade back to mercantilism - and the investment implications are profound.</p>
                </div>
                
                <div id="intel-vassal" style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #a855f7;">
                    <div style="font-weight: 700; color: #a855f7; margin-bottom: 4px;">VASSAL STATE DETECTOR (Currency Correlation)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Tracks KRW (Korean Won) correlation with USD vs CNH. Korea is the geopolitical bellwether - as it goes, so goes the Pacific order.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Levels:</strong> US SPHERE (KRW tracks USD) | NEUTRAL (uncorrelated) | CHINA SPHERE (KRW tracks CNH)</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> Shifts toward CHINA SPHERE = Asia decoupling from dollar system. Watch for BRICS momentum, gold accumulation.</p>
                    <p style="margin: 8px 0 0 0; color: #94a3b8; font-size: 0.85rem;"><strong>Why it matters:</strong> South Korea is the ultimate swing state - economically tied to China, security-guaranteed by the US. When KRW starts tracking CNH more than USD, it signals a tectonic shift in the Pacific order. This is the canary in the coal mine for de-dollarization.</p>
                </div>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">INTERPRETING THE SIGNALS</h3>
                <div style="background: rgba(168, 85, 247, 0.1); border-radius: 6px; padding: 12px; border: 1px solid rgba(168, 85, 247, 0.2);">
                    <div class="legend-item"><span class="legend-icon" style="color: #ef4444; font-weight: 700;">RED</span><span class="legend-text"><strong>Multiple Red Signals</strong> = Systemic risk rising. Reduce exposure, favor defensive positioning.</span></div>
                    <div class="legend-item"><span class="legend-icon" style="color: #f59e0b; font-weight: 700;">YELLOW</span><span class="legend-text"><strong>Mixed Signals</strong> = Transition phase. Watch for confirmation before major moves.</span></div>
                    <div class="legend-item"><span class="legend-icon" style="color: #22c55e; font-weight: 700;">GREEN</span><span class="legend-text"><strong>All Green</strong> = Risk-on environment. Trend following works, carry trades attractive.</span></div>
                    <div class="legend-item"><span class="legend-icon" style="color: #a855f7; font-weight: 700;">DIVERGE</span><span class="legend-text"><strong>Divergences</strong> = Most valuable. When one metric screams while others are calm, dig deeper.</span></div>
                </div>
                
                <div style="margin-top: 2rem; padding: 1rem; border-top: 1px solid rgba(147, 51, 234, 0.2); background: rgba(147, 51, 234, 0.05); border-radius: 6px;">
                    <p style="font-size: 0.8rem; color: #a78bfa; line-height: 1.6; text-align: center; margin: 0;">
                        <strong>HOW TO USE:</strong> These are early warning indicators, not trade signals. When multiple metrics shift together, expect regime change within 1-3 months. Use alongside Game Theory Dashboard for complete geopolitical picture.
                    </p>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1rem; border: 1px solid rgba(147, 51, 234, 0.3); background: rgba(0,0,0,0.3); border-radius: 6px;">
                    <p style="font-size: 0.75rem; color: #6a7585; line-height: 1.5; text-align: center; margin: 0;">
                        <strong>DISCLAIMER:</strong> This is not financial advice. I am not a financial advisor. This content is for informational and educational purposes only. Investing involves risk, and you should always do your own due diligence (DYOR) and consult with a professional financial advisor before making any investment decisions.
                    </p>
                </div>
                
            </div>
        </div>
    </div>

    <!-- Individual Intel Widget Modals -->
    <!-- Revolution Risk Deep Dive Modal -->
    <div id="revRiskModal" class="chart-modal-overlay" style="display: none;" onclick="closeIntelModal('revRiskModal', event)">
        <div class="chart-modal-content" onclick="event.stopPropagation()" style="max-width: 650px; border-color: #ef4444;">
            <button class="chart-close-btn" onclick="closeIntelModal('revRiskModal')" style="top: 15px; right: 15px; position: absolute; color: #ef4444;">x</button>
            <div class="modal-title" style="color: #ef4444; padding: 0.5rem 0;">REVOLUTION RISK INDEX</div>
            <div class="modal-analysis info-modal-scroll">
                <p style="color: #94a3b8; font-size: 0.85rem; margin-bottom: 1rem;"><em>Bread + Fuel Index - Tracking the Economic Preconditions of Social Unrest</em></p>
                
                <h3 style="color: #ef4444; margin-top: 0;">THE FORMULA</h3>
                <div style="background: rgba(239, 68, 68, 0.1); padding: 12px; border-radius: 6px; font-family: monospace; text-align: center; margin-bottom: 1rem;">
                    Revolution Risk = (Wheat / 550 + WTI Oil / 70) x (DXY / 100)
                </div>
                <p style="line-height: 1.6;">This formula captures the three forces that historically precede social upheaval: <strong>food costs</strong> (wheat), <strong>energy costs</strong> (oil), and <strong>currency strength</strong> (DXY amplifies EM pain).</p>
                
                <h3 style="color: #ef4444; margin-top: 1.5rem;">WHY THESE INPUTS?</h3>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #fca5a5;">
                    <div style="font-weight: 700; color: #fca5a5; margin-bottom: 4px;">WHEAT (Bread Proxy)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Bread is the foundational staple. When wheat prices spike, food inflation cascades through economies. The $550/bushel normalization reflects the 10-year average. Above that = stress.</p>
                </div>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #fca5a5;">
                    <div style="font-weight: 700; color: #fca5a5; margin-bottom: 4px;">WTI CRUDE OIL (Fuel Proxy)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Energy powers everything - transport, heating, cooking, manufacturing. The $70/barrel normalization reflects the post-shale equilibrium. Above that = inflation accelerates.</p>
                </div>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #fca5a5;">
                    <div style="font-weight: 700; color: #fca5a5; margin-bottom: 4px;">DXY (Dollar Multiplier)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Commodities price in USD. When the dollar strengthens, EM countries must pay more in local currency for the same food and fuel. This crushes purchasing power for billions.</p>
                </div>
                
                <h3 style="color: #ef4444; margin-top: 1.5rem;">RISK LEVELS</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div style="background: rgba(34, 197, 94, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #22c55e;">
                        <strong style="color: #22c55e;">STABLE (< 1.5)</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Normal conditions. No elevated unrest risk.</p>
                    </div>
                    <div style="background: rgba(234, 179, 8, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #eab308;">
                        <strong style="color: #eab308;">RISING (1.5 - 2.0)</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Pressure building. Monitor EM stress.</p>
                    </div>
                    <div style="background: rgba(249, 115, 22, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #f97316;">
                        <strong style="color: #f97316;">ELEVATED (2.0 - 2.5)</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Danger zone. Social tensions likely rising.</p>
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #ef4444;">
                        <strong style="color: #ef4444;">CRITICAL (> 2.5)</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Revolution territory. Historical precedent for regime change.</p>
                    </div>
                </div>
                
                <h3 style="color: #ef4444; margin-top: 1.5rem;">HISTORICAL PRECEDENTS</h3>
                <ul style="color: #94a3b8; line-height: 1.8; padding-left: 1.5rem;">
                    <li><strong>Arab Spring (2011)</strong> - Wheat prices doubled in 6 months. Tunisia, Egypt, Libya, Syria all fell.</li>
                    <li><strong>Sri Lanka Collapse (2022)</strong> - Fuel shortages led to PM fleeing the country by helicopter.</li>
                    <li><strong>Egypt Protests (2023)</strong> - Bread price subsidies cut, currency devalued. Riots followed.</li>
                    <li><strong>French Revolution (1789)</strong> - The original "let them eat cake" moment. Bread prices had doubled.</li>
                </ul>
                
                <h3 style="color: #ef4444; margin-top: 1.5rem;">TRADE IMPLICATIONS</h3>
                <div style="background: rgba(239, 68, 68, 0.1); padding: 12px; border-radius: 6px; border: 1px solid rgba(239, 68, 68, 0.3);">
                    <p style="margin: 0; line-height: 1.6;"><strong>When CRITICAL:</strong> Long defense stocks (LMT, RTX, NOC), short EM FX (ZAR, TRY, EGP), long gold as flight-to-safety. Consider food security plays (ADM, BG, MOS).</p>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1rem; border: 1px solid rgba(239, 68, 68, 0.3); background: rgba(0,0,0,0.3); border-radius: 6px;">
                    <p style="font-size: 0.75rem; color: #6a7585; line-height: 1.5; text-align: center; margin: 0;">
                        <strong>DISCLAIMER:</strong> This is not financial advice. This content is for informational and educational purposes only. Always do your own research.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Liar's Poker Deep Dive Modal -->
    <div id="liarModal" class="chart-modal-overlay" style="display: none;" onclick="closeIntelModal('liarModal', event)">
        <div class="chart-modal-content" onclick="event.stopPropagation()" style="max-width: 650px; border-color: #f59e0b;">
            <button class="chart-close-btn" onclick="closeIntelModal('liarModal')" style="top: 15px; right: 15px; position: absolute; color: #f59e0b;">x</button>
            <div class="modal-title" style="color: #f59e0b; padding: 0.5rem 0;">LIAR'S POKER</div>
            <div class="modal-analysis info-modal-scroll">
                <p style="color: #94a3b8; font-size: 0.85rem; margin-bottom: 1rem;"><em>Narrative vs Money - Detecting When Someone Is Lying</em></p>
                
                <h3 style="color: #f59e0b; margin-top: 0;">THE CONCEPT</h3>
                <p style="line-height: 1.6;">Media narratives and market positioning often diverge. When CNN says "markets are calm" but prediction markets are pricing in escalation, <strong>someone is lying</strong>. This metric catches the gap between the story being told and where money is actually flowing.</p>
                
                <h3 style="color: #f59e0b; margin-top: 1.5rem;">THE INPUTS</h3>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #fbbf24;">
                    <div style="font-weight: 700; color: #fbbf24; margin-bottom: 4px;">FEAR & GREED INDEX (Narrative Proxy)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">CNN's Fear & Greed captures retail sentiment and media tone. It reflects what people <em>feel</em> based on headlines they consume. Range: 0 (Extreme Fear) to 100 (Extreme Greed).</p>
                </div>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #fbbf24;">
                    <div style="font-weight: 700; color: #fbbf24; margin-bottom: 4px;">POLYMARKET WAR ODDS (Money Proxy)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Prediction markets where people bet real money on outcomes. If war odds are rising but sentiment says "greed," smart money sees something retail doesn't.</p>
                </div>
                
                <h3 style="color: #f59e0b; margin-top: 1.5rem;">THE SIGNALS</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div style="background: rgba(34, 197, 94, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #22c55e;">
                        <strong style="color: #22c55e;">REALITY</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Narrative aligns with money. No divergence. Trend is authentic.</p>
                    </div>
                    <div style="background: rgba(234, 179, 8, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #eab308;">
                        <strong style="color: #eab308;">WATCH</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Slight drift forming. Could normalize or widen.</p>
                    </div>
                    <div style="background: rgba(147, 51, 234, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #9333ea;">
                        <strong style="color: #9333ea;">HOPIUM</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Sentiment too bullish vs bets. Retail overexposed, smart money hedging.</p>
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #ef4444;">
                        <strong style="color: #ef4444;">FEAR PORN</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Sentiment too bearish vs bets. Contrarian buy opportunity.</p>
                    </div>
                </div>
                
                <h3 style="color: #f59e0b; margin-top: 1.5rem;">EXAMPLES IN THE WILD</h3>
                <ul style="color: #94a3b8; line-height: 1.8; padding-left: 1.5rem;">
                    <li><strong>Jan 2022:</strong> "Inflation is transitory" narrative while bonds were getting crushed. HOPIUM signal - inflation was real.</li>
                    <li><strong>Oct 2022:</strong> "Recession imminent" headlines while Polymarket showed recovery bets. FEAR PORN signal - market bottomed.</li>
                    <li><strong>Feb 2024:</strong> "War spreading" media frenzy but war odds falling. FEAR PORN signal - de-escalation coming.</li>
                </ul>
                
                <h3 style="color: #f59e0b; margin-top: 1.5rem;">TRADE IMPLICATIONS</h3>
                <div style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: 6px; border: 1px solid rgba(245, 158, 11, 0.3);">
                    <p style="margin: 0; line-height: 1.6;"><strong>HOPIUM:</strong> Reduce long exposure, add hedges. Retail is the exit liquidity.<br><strong>FEAR PORN:</strong> Contrarian entry point. Buy what everyone fears when money says otherwise.</p>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1rem; border: 1px solid rgba(245, 158, 11, 0.3); background: rgba(0,0,0,0.3); border-radius: 6px;">
                    <p style="font-size: 0.75rem; color: #6a7585; line-height: 1.5; text-align: center; margin: 0;">
                        <strong>DISCLAIMER:</strong> This is not financial advice. This content is for informational and educational purposes only. Always do your own research.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Paper vs Rock Deep Dive Modal -->
    <div id="paperRockModal" class="chart-modal-overlay" style="display: none;" onclick="closeIntelModal('paperRockModal', event)">
        <div class="chart-modal-content" onclick="event.stopPropagation()" style="max-width: 650px; border-color: #3b82f6;">
            <button class="chart-close-btn" onclick="closeIntelModal('paperRockModal')" style="top: 15px; right: 15px; position: absolute; color: #3b82f6;">x</button>
            <div class="modal-title" style="color: #3b82f6; padding: 0.5rem 0;">PAPER VS ROCK</div>
            <div class="modal-analysis info-modal-scroll">
                <p style="color: #94a3b8; font-size: 0.85rem; margin-bottom: 1rem;"><em>Financialization Ratio - Are We in a Paper Economy or War Economy?</em></p>
                
                <h3 style="color: #3b82f6; margin-top: 0;">THE FORMULA</h3>
                <div style="background: rgba(59, 130, 246, 0.1); padding: 12px; border-radius: 6px; font-family: monospace; text-align: center; margin-bottom: 1rem;">
                    Paper/Rock = S&P 500 / (Gold + Oil x 30 + Copper x 500)
                </div>
                <p style="line-height: 1.6;">This ratio measures whether capital is flowing into <strong>financial assets</strong> (Paper: stocks, bonds, derivatives) or <strong>hard assets</strong> (Rock: commodities, gold, real things). The answer determines the entire investment regime.</p>
                
                <h3 style="color: #3b82f6; margin-top: 1.5rem;">THE MACRO REGIMES</h3>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #60a5fa;">
                    <div style="font-weight: 700; color: #60a5fa; margin-bottom: 4px;">FINANCIALIZED (High Ratio)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">QE regime. Central banks suppress volatility, liquidity floods into financial assets. Stocks beat commodities. Tech outperforms energy. This was 2010-2020.</p>
                </div>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #f59e0b;">
                    <div style="font-weight: 700; color: #f59e0b; margin-bottom: 4px;">TRANSITIONING (Mid Ratio)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Regime shift in progress. Rotation from growth to value, from tech to commodities. High volatility, unclear winners. This is the messy middle.</p>
                </div>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #ef4444;">
                    <div style="font-weight: 700; color: #ef4444; margin-bottom: 4px;">WAR ECONOMY (Low Ratio)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Hard assets dominate. Inflation, conflict, deglobalization favor real things over paper claims. Commodities crush stocks. This was the 1970s and 1940s.</p>
                </div>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #a855f7;">
                    <div style="font-weight: 700; color: #a855f7; margin-bottom: 4px;">PEAK PAPER (Extreme High)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Financialization has gone too far. Mean reversion risk is elevated. The system is fragile. Dot-com 2000, 2007 housing bubble vibes.</p>
                </div>
                
                <h3 style="color: #3b82f6; margin-top: 1.5rem;">HISTORICAL CONTEXT</h3>
                <ul style="color: #94a3b8; line-height: 1.8; padding-left: 1.5rem;">
                    <li><strong>1945-1965:</strong> Post-WWII financialization. Paper wins as global trade expands.</li>
                    <li><strong>1968-1982:</strong> Stagflation era. Rock crushes Paper. Gold up 24x, stocks flat for 15 years.</li>
                    <li><strong>1982-2000:</strong> Disinflation bull market. Paper wins again. Stocks up 10x.</li>
                    <li><strong>2000-2011:</strong> Commodities supercycle. Rock outperforms. Oil, gold, copper all surge.</li>
                    <li><strong>2011-2020:</strong> QE infinity. Paper dominates. FAANG crushes energy.</li>
                    <li><strong>2020-???:</strong> Are we transitioning again? Watch this ratio.</li>
                </ul>
                
                <h3 style="color: #3b82f6; margin-top: 1.5rem;">TRADE IMPLICATIONS</h3>
                <div style="background: rgba(59, 130, 246, 0.1); padding: 12px; border-radius: 6px; border: 1px solid rgba(59, 130, 246, 0.3);">
                    <p style="margin: 0; line-height: 1.6;"><strong>WAR ECONOMY:</strong> Long commodities (XLE, GLD, COPX), defense (ITA), short growth (QQQ). Value over growth.<br><strong>FINANCIALIZED:</strong> Long growth, long duration, short commodities. Momentum works.</p>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1rem; border: 1px solid rgba(59, 130, 246, 0.3); background: rgba(0,0,0,0.3); border-radius: 6px;">
                    <p style="font-size: 0.75rem; color: #6a7585; line-height: 1.5; text-align: center; margin: 0;">
                        <strong>DISCLAIMER:</strong> This is not financial advice. This content is for informational and educational purposes only. Always do your own research.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mercantilism Counter Deep Dive Modal -->
    <div id="mercantilismModal" class="chart-modal-overlay" style="display: none;" onclick="closeIntelModal('mercantilismModal', event)">
        <div class="chart-modal-content" onclick="event.stopPropagation()" style="max-width: 650px; border-color: #22c55e;">
            <button class="chart-close-btn" onclick="closeIntelModal('mercantilismModal')" style="top: 15px; right: 15px; position: absolute; color: #22c55e;">x</button>
            <div class="modal-title" style="color: #22c55e; padding: 0.5rem 0;">MERCANTILISM COUNTER</div>
            <div class="modal-analysis info-modal-scroll">
                <p style="color: #94a3b8; font-size: 0.85rem; margin-bottom: 1rem;"><em>Trade Fragmentation Scanner - Tracking the Death of Globalization</em></p>
                
                <h3 style="color: #22c55e; margin-top: 0;">THE CONCEPT</h3>
                <p style="line-height: 1.6;">For 40 years, globalization was the dominant paradigm - free trade, open borders, integrated supply chains. That era is ending. This counter tracks how fast we're reverting to <strong>mercantilism</strong> - the 17th century system where nations prioritize domestic production over global trade.</p>
                
                <h3 style="color: #22c55e; margin-top: 1.5rem;">WHAT WE SCAN FOR</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-bottom: 1rem;">
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 8px; border-radius: 4px; text-align: center; font-size: 0.85rem; font-weight: 600; color: #22c55e;">TARIFF</div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 8px; border-radius: 4px; text-align: center; font-size: 0.85rem; font-weight: 600; color: #22c55e;">SANCTION</div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 8px; border-radius: 4px; text-align: center; font-size: 0.85rem; font-weight: 600; color: #22c55e;">BAN</div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 8px; border-radius: 4px; text-align: center; font-size: 0.85rem; font-weight: 600; color: #22c55e;">BLOCKADE</div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 8px; border-radius: 4px; text-align: center; font-size: 0.85rem; font-weight: 600; color: #22c55e;">FRIEND-SHORING</div>
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 8px; border-radius: 4px; text-align: center; font-size: 0.85rem; font-weight: 600; color: #22c55e;">DECOUPLE</div>
                </div>
                <p style="line-height: 1.6; color: #6a7585;">Each headline containing these keywords represents friction being added to the global trading system.</p>
                
                <h3 style="color: #22c55e; margin-top: 1.5rem;">FRAGMENTATION LEVELS</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div style="background: rgba(34, 197, 94, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #22c55e;">
                        <strong style="color: #22c55e;">OPEN TRADE (0-2)</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Normal headline noise. Globalization intact.</p>
                    </div>
                    <div style="background: rgba(234, 179, 8, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #eab308;">
                        <strong style="color: #eab308;">FRICTION (3-5)</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Elevated tensions. Supply chains adapting.</p>
                    </div>
                    <div style="background: rgba(249, 115, 22, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #f97316;">
                        <strong style="color: #f97316;">FRACTURING (6-9)</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Serious fragmentation. Regional blocs forming.</p>
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #ef4444;">
                        <strong style="color: #ef4444;">TRADE WAR (10+)</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.8rem; color: #6a7585;">Full mercantilism. Expect inflation, supply shocks.</p>
                    </div>
                </div>
                
                <h3 style="color: #22c55e; margin-top: 1.5rem;">INVESTMENT IMPLICATIONS</h3>
                <ul style="color: #94a3b8; line-height: 1.8; padding-left: 1.5rem;">
                    <li><strong>Rising mercantilism = inflation:</strong> More friction = higher costs = higher prices</li>
                    <li><strong>Onshoring beneficiaries:</strong> US manufacturing (CAT, DE), construction (VMC, MLM)</li>
                    <li><strong>Supply chain rewiring:</strong> Mexico nearshoring (EWW), Vietnam (VNM)</li>
                    <li><strong>Commodity volatility:</strong> Fragmented supply = price swings. Favor producers.</li>
                    <li><strong>Losers:</strong> Global logistics (FDX, UPS long-term), pure exporters, assembly hubs</li>
                </ul>
                
                <h3 style="color: #22c55e; margin-top: 1.5rem;">THE BIG PICTURE</h3>
                <div style="background: rgba(34, 197, 94, 0.1); padding: 12px; border-radius: 6px; border: 1px solid rgba(34, 197, 94, 0.3);">
                    <p style="margin: 0; line-height: 1.6;">We are living through the end of the post-1980 globalization era. This counter helps you track the speed of that transition. The faster it moves, the more inflationary and volatile markets become.</p>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1rem; border: 1px solid rgba(34, 197, 94, 0.3); background: rgba(0,0,0,0.3); border-radius: 6px;">
                    <p style="font-size: 0.75rem; color: #6a7585; line-height: 1.5; text-align: center; margin: 0;">
                        <strong>DISCLAIMER:</strong> This is not financial advice. This content is for informational and educational purposes only. Always do your own research.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Vassal State Detector Deep Dive Modal -->
    <div id="vassalModal" class="chart-modal-overlay" style="display: none;" onclick="closeIntelModal('vassalModal', event)">
        <div class="chart-modal-content" onclick="event.stopPropagation()" style="max-width: 650px; border-color: #a855f7;">
            <button class="chart-close-btn" onclick="closeIntelModal('vassalModal')" style="top: 15px; right: 15px; position: absolute; color: #a855f7;">x</button>
            <div class="modal-title" style="color: #a855f7; padding: 0.5rem 0;">VASSAL STATE DETECTOR</div>
            <div class="modal-analysis info-modal-scroll">
                <p style="color: #94a3b8; font-size: 0.85rem; margin-bottom: 1rem;"><em>Currency Correlation Analysis - Tracking the Great Power Realignment</em></p>
                
                <h3 style="color: #a855f7; margin-top: 0;">THE CONCEPT</h3>
                <p style="line-height: 1.6;">In a multipolar world, currencies reveal allegiances. We track the <strong>Korean Won (KRW)</strong> because South Korea is the ultimate swing state - economically tied to China, security-guaranteed by the US. Where KRW correlates tells us which pole is winning.</p>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">WHY SOUTH KOREA?</h3>
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #c084fc;">
                    <div style="font-weight: 700; color: #c084fc; margin-bottom: 4px;">THE PIVOT STATE</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">South Korea is the 10th largest economy. Samsung, Hyundai, SK Hynix are global players. China is Korea's largest trading partner. The US guarantees Korea's security. This tension makes KRW the perfect barometer.</p>
                </div>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">THE METHODOLOGY</h3>
                <p style="line-height: 1.6;">We calculate the <strong>Pearson correlation coefficient</strong> between KRW and both USD and CNH (offshore yuan) over rolling windows. Whichever correlation is stronger indicates which sphere of influence Korea is drifting toward.</p>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">THE SIGNALS</h3>
                <div style="display: grid; grid-template-columns: 1fr; gap: 8px;">
                    <div style="background: rgba(59, 130, 246, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong style="color: #3b82f6;">US SPHERE</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.85rem; color: #6a7585;">KRW tracks USD more closely. Dollar system intact. US security umbrella holding. Traditional risk-on/risk-off dynamics apply.</p>
                    </div>
                    <div style="background: rgba(168, 85, 247, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #a855f7;">
                        <strong style="color: #a855f7;">NEUTRAL</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.85rem; color: #6a7585;">KRW uncorrelated with either. Transition period. Maximum uncertainty. Watch for policy shifts.</p>
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.15); padding: 10px; border-radius: 4px; border-left: 3px solid #ef4444;">
                        <strong style="color: #ef4444;">CHINA SPHERE</strong>
                        <p style="margin: 4px 0 0 0; font-size: 0.85rem; color: #6a7585;">KRW tracks CNH more closely. De-dollarization accelerating. Asia realigning. Major geopolitical shift in progress.</p>
                    </div>
                </div>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">WHAT A SHIFT MEANS</h3>
                <ul style="color: #94a3b8; line-height: 1.8; padding-left: 1.5rem;">
                    <li><strong>Reserve currency implications:</strong> If Korea drifts to China, other Asian nations may follow</li>
                    <li><strong>BRICS momentum:</strong> More countries considering alternatives to dollar system</li>
                    <li><strong>Gold accumulation:</strong> Central banks hedge against dollar decline</li>
                    <li><strong>US Treasury demand:</strong> Foreign buying may decrease, yields may rise</li>
                    <li><strong>Regional trade:</strong> More bilateral currency agreements, less USD settlement</li>
                </ul>
                
                <h3 style="color: #a855f7; margin-top: 1.5rem;">TRADE IMPLICATIONS</h3>
                <div style="background: rgba(168, 85, 247, 0.1); padding: 12px; border-radius: 6px; border: 1px solid rgba(168, 85, 247, 0.3);">
                    <p style="margin: 0; line-height: 1.6;"><strong>CHINA SPHERE:</strong> Long gold (GLD, PHYS), long EM ex-China, short US Treasuries duration. Watch for BRICS currency developments.<br><strong>US SPHERE:</strong> Traditional correlations hold. Risk-on = USD down, risk-off = USD up.</p>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1rem; border: 1px solid rgba(168, 85, 247, 0.3); background: rgba(0,0,0,0.3); border-radius: 6px;">
                    <p style="font-size: 0.75rem; color: #6a7585; line-height: 1.5; text-align: center; margin: 0;">
                        <strong>DISCLAIMER:</strong> This is not financial advice. This content is for informational and educational purposes only. Always do your own research.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Rates Dashboard Legend Modal -->
    <div id="ratesLegendModal" class="chart-modal-overlay" style="display: none;" onclick="closeRatesLegend(event)">
        <div class="chart-modal-content" onclick="event.stopPropagation()" style="max-width: 700px; border-color: #3b82f6;">
            <button class="chart-close-btn" onclick="closeRatesLegend()" style="top: 15px; right: 15px; position: absolute; color: #3b82f6;">Ã—</button>
            <div class="modal-title" style="color: #3b82f6; padding: 0.5rem 0;">BASE LAYER LEGEND</div>
            <div class="modal-analysis info-modal-scroll">
                
                <h3 style="color: #3b82f6; margin-top: 0;">WHY THESE 8 INDICATORS MATTER</h3>
                <p style="line-height: 1.6;">These 8 metrics form the core plumbing of global financial markets. They tell you whether money is flowing freely, where stress is building, and what the Fed's next move might be. Master these, and you'll read the market's pulse before most traders.</p>
                
                <h3 style="color: #3b82f6; margin-top: 1.5rem;">TREASURY YIELDS</h3>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #60a5fa;">
                    <div style="font-weight: 700; color: #60a5fa; margin-bottom: 4px;">US 2Y (2-Year Treasury Yield)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">The market's best guess at Fed policy for the next 2 years. Moves faster than any other yield because it's directly tied to rate expectations.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Watch for:</strong> 2Y spiking = market expects hawkish Fed. 2Y crashing = recession fears, rate cut bets surging.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> 2Y above 10Y = inverted curve = recession warning (historically 100% accurate within 6-18 months).</p>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #60a5fa;">
                    <div style="font-weight: 700; color: #60a5fa; margin-bottom: 4px;">US 5Y (5-Year Treasury Yield)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">The "belly" of the curve. Balances near-term Fed policy with longer-term growth expectations. Most sensitive to inflation expectations.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Watch for:</strong> 5Y breakevens (vs TIPS) reveal inflation expectations. If 5Y nominal rises but breakevens flat = real rates rising = risk-off.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> 5Y often leads 10Y moves. Watch 5s30s spread for curve steepening/flattening bets.</p>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #60a5fa;">
                    <div style="font-weight: 700; color: #60a5fa; margin-bottom: 4px;">US 10Y (10-Year Treasury Yield)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">THE global benchmark. Sets mortgage rates, corporate borrowing costs, and equity valuations. Every asset in the world is priced off this.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Watch for:</strong> Key levels: 4% = psychological, 4.5% = pain for equities, 5% = danger zone. Each 50bp move reshapes portfolios.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> 10Y rising + stocks rising = healthy. 10Y rising + stocks falling = tightening financial conditions, risk-off.</p>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #60a5fa;">
                    <div style="font-weight: 700; color: #60a5fa; margin-bottom: 4px;">US 30Y (30-Year Treasury Yield)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Long-duration barometer. Reflects fiscal sustainability concerns, inflation expectations, and term premium demands. Pension funds and insurers live here.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Watch for:</strong> 30Y above 5% = fiscal alarm bells. Steepening 2s30s = curve normalizing (often precedes easing cycle).</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> 30Y selling off while 2Y stable = "bear steepener" = fiscal concerns or foreign selling (China/Japan).</p>
                </div>
                
                <h3 style="color: #3b82f6; margin-top: 1.5rem;">INFLATION & LABOR</h3>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #22c55e;">
                    <div style="font-weight: 700; color: #22c55e; margin-bottom: 4px;">TRUFLATION (Real-Time Inflation Index)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Daily blockchain-verified inflation reading from 10M+ data points. Leads official CPI by 30-45 days. The future of inflation tracking.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Watch for:</strong> Divergence from CPI = trading opportunity. If Truflation falling while CPI sticky, bond rally coming.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> Truflation below 3% = Fed's target zone. Above 4% = hawkish pressure. Currently at 2.84% = near target.</p>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #f59e0b;">
                    <div style="font-weight: 700; color: #f59e0b; margin-bottom: 4px;">U6 RATE (Broad Unemployment)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">The REAL unemployment rate. Includes part-time workers wanting full-time and discouraged workers. Shows true labor market slack.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Watch for:</strong> U6 above 8% = labor market stress (tripwire). Gap between U3 and U6 widening = hidden weakness.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> U6 rising while U3 stable = cracks forming. Fed watches this closely for "dual mandate" calibration.</p>
                </div>
                
                <h3 style="color: #3b82f6; margin-top: 1.5rem;">MONEY MARKETS (The Plumbing)</h3>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #a855f7;">
                    <div style="font-weight: 700; color: #a855f7; margin-bottom: 4px;">FED RRP (Reverse Repo Facility)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">Where excess cash parks overnight at the Fed. High RRP = too much liquidity chasing safety. Draining RRP = liquidity leaving the system.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Watch for:</strong> RRP dropping toward zero = liquidity stress ahead. QT is "working." May force Fed to pause balance sheet runoff.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> RRP collapse + reserves falling = repo market stress risk (flashback to Sept 2019). Watch for funding spikes.</p>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 12px; margin-bottom: 10px; border-left: 3px solid #ec4899;">
                    <div style="font-weight: 700; color: #ec4899; margin-bottom: 4px;">SOFR (Secured Overnight Financing Rate)</div>
                    <p style="margin: 0; font-size: 0.9rem; line-height: 1.5;">The new LIBOR. Trillions in derivatives, loans, and mortgages tied to this rate. Shows real cost of overnight secured lending.</p>
                    <p style="margin: 8px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Watch for:</strong> SOFR spiking above Fed Funds = funding stress. Gap widening = banks hoarding reserves. Red flag.</p>
                    <p style="margin: 4px 0 0 0; color: #6a7585; font-size: 0.85rem;"><strong>Trade signal:</strong> SOFR = 3.64%, Fed RRP = 3.50% â†’ healthy spread. If SOFR > 4% while Fed at 3.5% = plumbing problem.</p>
                </div>
                
                <h3 style="color: #3b82f6; margin-top: 1.5rem;">HOW TO READ THEM TOGETHER</h3>
                <div style="background: rgba(59, 130, 246, 0.1); border-radius: 6px; padding: 12px; border: 1px solid rgba(59, 130, 246, 0.2);">
                    <div class="legend-item"><span class="legend-icon">ðŸ“ˆ</span><span class="legend-text"><strong>Bull Steepener</strong> = 2Y falling faster than 10Y â†’ Fed cutting, growth concerns â†’ Long bonds, short dollar</span></div>
                    <div class="legend-item"><span class="legend-icon">ðŸ“‰</span><span class="legend-text"><strong>Bear Flattener</strong> = 2Y rising faster than 10Y â†’ Fed hiking expectations â†’ Risk-off, USD strength</span></div>
                    <div class="legend-item"><span class="legend-icon">âš ï¸</span><span class="legend-text"><strong>Curve Inversion</strong> = 2Y > 10Y â†’ Recession signal (6-18 months lead time) â†’ Reduce risk exposure</span></div>
                    <div class="legend-item"><span class="legend-icon">ðŸ”´</span><span class="legend-text"><strong>Funding Stress</strong> = SOFR spiking, RRP draining â†’ Liquidity crisis brewing â†’ Watch for Fed intervention</span></div>
                    <div class="legend-item"><span class="legend-icon">ðŸŸ¢</span><span class="legend-text"><strong>Goldilocks</strong> = Yields stable, Truflation ~2-3%, U6 < 8% â†’ Risk-on, carry trades work</span></div>
                </div>
                
                <div style="margin-top: 2rem; padding: 1rem; border-top: 1px solid rgba(59, 130, 246, 0.2); background: rgba(59, 130, 246, 0.05); border-radius: 6px;">
                    <p style="font-size: 0.8rem; color: #60a5fa; line-height: 1.6; text-align: center; margin: 0;">
                        <strong>PRO TIP:</strong> The yield curve is a movie, not a snapshot. Track direction of change (+bp/-bp) more than absolute levels. A 4% 10Y rising is different from 4% and falling. Context is everything.
                    </p>
                </div>
                
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                    <p style="font-size: 0.75rem; color: #6a7585; line-height: 1.5; text-align: center;">
                        <strong>DISCLAIMER:</strong> This is not financial advice. These indicators are educational context for understanding macro conditions. Always do your own research and consult professionals before trading.
                    </p>
                </div>
                
            </div>
        </div>
    </div>

    <script>
        function openGameLegend() {
            document.getElementById('gameLegendModal').style.display = 'flex';
            document.getElementById('gameLegendModal').style.justifyContent = 'center';
            document.getElementById('gameLegendModal').style.alignItems = 'flex-start';
            document.getElementById('gameLegendModal').style.paddingTop = '3rem';
            document.body.style.overflow = 'hidden';
        }
        
        function closeGameLegend(event) {
            if (!event || event.target.id === 'gameLegendModal' || event.target.classList.contains('chart-close-btn')) {
                document.getElementById('gameLegendModal').style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        
        function openIntelLegend() {
            document.getElementById('intelLegendModal').style.display = 'flex';
            document.getElementById('intelLegendModal').style.justifyContent = 'center';
            document.getElementById('intelLegendModal').style.alignItems = 'flex-start';
            document.getElementById('intelLegendModal').style.paddingTop = '3rem';
            document.body.style.overflow = 'hidden';
        }
        
        function closeIntelLegend(event) {
            if (!event || event.target.id === 'intelLegendModal' || event.target.classList.contains('chart-close-btn')) {
                document.getElementById('intelLegendModal').style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        
        function openIntelLegendSection(sectionId) {
            openIntelLegend();
            setTimeout(() => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    section.style.animation = 'highlight-pulse 1.5s ease-out';
                    setTimeout(() => { section.style.animation = ''; }, 1500);
                }
            }, 100);
        }
        
        function openIntelDetailModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            document.getElementById(modalId).style.justifyContent = 'center';
            document.getElementById(modalId).style.alignItems = 'flex-start';
            document.getElementById(modalId).style.paddingTop = '3rem';
            document.body.style.overflow = 'hidden';
        }
        
        function closeIntelModal(modalId, event) {
            if (!event || event.target.id === modalId || event.target.classList.contains('chart-close-btn')) {
                document.getElementById(modalId).style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        
        function openRatesLegend() {
            document.getElementById('ratesLegendModal').style.display = 'flex';
            document.getElementById('ratesLegendModal').style.justifyContent = 'center';
            document.getElementById('ratesLegendModal').style.alignItems = 'flex-start';
            document.getElementById('ratesLegendModal').style.paddingTop = '3rem';
            document.body.style.overflow = 'hidden';
        }
        
        function closeRatesLegend(event) {
            if (!event || event.target.id === 'ratesLegendModal' || event.target.classList.contains('chart-close-btn')) {
                document.getElementById('ratesLegendModal').style.display = 'none';
                document.body.style.overflow = '';
            }
        }
    </script>

</body>
</html>
